[2025-05-12 개발 현황 메모]
=================================

1. AI 이미지 생성 기능 수정 작업
-------------------------
• DALL-E 3 모델을 사용하여 고품질 급식 이미지 자동 생성 구현
• Netlify Function 타임아웃 장애 해결
  - generate-meal-image 함수의 타임아웃 값을 30초로 설정
  - 499 오류(서버 응답 대기 중 연결 끊김) 해결
• 메뉴 항목 처리 개선
  - 메뉴를 자동으로 밥, 국/찌, 반찬으로 분류하는 로직 구현
  - 한국어 프롬프트 개선으로 반찬 배치 지정 명확화
• 사용자 ID 처리 개선
  - profiles 테이블 참조 대신 클라이언트에서 전송된 user_id 사용
  - 재배포 후 최신 코드 적용

2. 현재 상황 및 추가 테스트 필요 사항
-------------------------
• DALL-E 3에서 GPT-4o 이미지 생성 모델(gpt-image-1)로 변경
  - 토큰 사용량을 줄이기 위해 프롬프트 간소화
  - response_format 파라미터 제거 (지원하지 않는 파라미터로 인한 오류 해결)
  - Netlify에 재배포 후 이미지 생성 품질 및 정확도 테스트 필요
• AI 이미지 생성이 작동하지만 메뉴 항목 반영이 전체적으로 필요
  - 한국어 프롬프트와 메뉴 분류 로직이 적용된 상태
  - 실제 메뉴가 반영되어 이미지 생성되는지 추가 테스트 필요
  - 기늘리는 시간이 길어졌으니 사용자에게 UI로 피드백 제공 개선 고려

3. 향후 로드맵
-------------------------
• 이미지 생성 성능 및 품질 모니터링
  - 실제 급식 메뉴와 생성된 이미지 일치도 확인


4. 급식 이미지 알림 리팩토링 (2025-05-12 작업)
-------------------------
• is_shared 필드 제거
  - meal_images 테이블에서 is_shared 컬럼 제거 (중복 데이터)
  - 모든 코드에서 is_shared 참조를 status='approved'로 대체

• 트리거 함수 수정
  - send_notification_on_meal_image_confirmed: status='confirmed'에서 'approved'로 변경
  - send_notification_on_ai_meal_image: source='ai' AND status='approved' 기준으로 설정
  - 메시지 내용 유지 (수동 이미지: '님이 직접 찍은 급식사진 등록')
  - AI 이미지: '님이 AI로 생성한 급식이미지 등록'

• 백엔드 함수 수정
  - 모든 Netlify 함수에서 직접 알림 생성 코드 제거
  - verify-meal-image.js와 auto-generate-meal-images.js에서 알림 코드 제거
  - 트리거 기반 알림 시스템으로 완전 통합

• 현재 상태
  - 변경사항 개발 완료 및 수배발 이후 테스트 필요
  - 실제 환경에서 알림 동작 확인 필요
  - 생성 시간 개선(현재 15~25초 정도 소요)
• UI/UX 개선
  - 이미지 생성 중 로딩 표시 개선
  - 생성 이미지 품질 피드백 기능 추가 고려

4. 사용 원칙 / 주의사항
-----------------------
• 이미 정상 작동하는 기능은 수정 금지 (사용자 정책)
• 테스트 코드는 작성하지 않음, 프로덕션 직접 테스트
• 항상 프로덕션 환경(Netlify) 기준으로 확인

5. 재시작 체크리스트
---------------------
1) `npm install` (패키지 변동 시)
2) `.env.local` 가 존재하는지 확인 (Supabase 키 등)
3) `npm run dev` 로 로컬 확인 후 Netlify 배포

메모 끝 – 내일 시작 시 이 파일을 먼저 읽고 이어서 작업할 것.
