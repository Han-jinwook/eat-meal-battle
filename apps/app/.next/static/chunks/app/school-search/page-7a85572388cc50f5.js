(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[681],{906:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var r=t(4568),a=t(7620),l=t(2942),o=t(1525);function n(){let e=(0,l.useRouter)(),s=(0,o.U)(),[t,n]=(0,a.useState)(""),[i,d]=(0,a.useState)([]),[c,u]=(0,a.useState)(null),[m,h]=(0,a.useState)({grade:"",classNumber:""}),[g,b]=(0,a.useState)(!1),[f,p]=(0,a.useState)(""),[N,x]=(0,a.useState)(null),[_,S]=(0,a.useState)(!1),[v,C]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{let{data:{user:t}}=await s.auth.getUser();x(t),t||(p("로그인이 필요합니다"),setTimeout(()=>{e.push("/login")},2e3))})()},[e,s.auth]);let j=async()=>{if(!t.trim())return void p("검색어를 입력해주세요");b(!0),p("");try{let e,s=window.location.origin;e=s.includes("lunbat.com")||s.includes("netlify")?"".concat(s,"/.netlify/functions/schools?keyword=").concat(encodeURIComponent(t)):"".concat(s,"/api/schools?keyword=").concat(encodeURIComponent(t)),console.log("학교 검색 API 요청 URL:",e);let r=await fetch(e);if(!r.ok)throw console.error("학교 검색 API 응답 오류:",r.status,r.statusText),Error("학교 검색에 실패했습니다");let a=await r.json();d(a.schools||[]),b(!1)}catch(e){p("학교 검색 중 오류가 발생했습니다"),d([]),b(!1)}},y=e=>{u(e),d([]),n("")},w=e=>{let{name:s,value:t}=e.target;h(e=>({...e,[s]:t}))},k=async()=>{if(!N)return void p("로그인이 필요합니다");if(!c)return void p("학교를 선택해주세요");if(!m.grade)return void p("학년을 선택해주세요");if(!m.classNumber)return void p("반을 선택해주세요");S(!0),p("");try{let{data:t,error:r}=await s.from("school_infos").select("*").eq("user_id",N.id).single();if(r&&"PGRST116"!==r.code)throw r;let a={user_id:N.id,school_code:c.SD_SCHUL_CODE,school_name:c.SCHUL_NM,school_type:c.SCHUL_KND_SC_NM,region:c.LCTN_SC_NM,address:c.ORG_RDNMA,office_code:c.ATPT_OFCDC_SC_CODE,grade:m.grade,class_number:m.classNumber,updated_at:new Date().toISOString()};if(t){let{error:e}=await s.from("school_infos").update(a).eq("user_id",N.id);if(e)throw e}else{let{error:e}=await s.from("school_infos").insert([a]);if(e)throw e}C(!0),S(!1),setTimeout(()=>{e.push("/")},2e3)}catch(e){console.error("학교 정보 저장 오류:",e),p(e.message||"학교 정보 저장 중 오류가 발생했습니다"),S(!1)}};return(0,r.jsxs)("div",{className:"max-w-lg mx-auto p-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"학교 설정"}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("form",{onSubmit:e=>{e.preventDefault(),j()},children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("input",{type:"text",value:t,onChange:e=>n(e.target.value),className:"flex-grow p-2 border rounded-l",placeholder:"학교 이름 입력 (2글자 이상)"}),(0,r.jsx)("button",{type:"submit",disabled:g,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 rounded-r disabled:bg-gray-400",children:"검색"})]})})}),i.length>0&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"검색 결과"}),(0,r.jsx)("ul",{className:"border rounded divide-y",children:i.map(e=>(0,r.jsxs)("li",{className:"p-3 cursor-pointer hover:bg-gray-100 ".concat((null==c?void 0:c.SD_SCHUL_CODE)===e.SD_SCHUL_CODE?"bg-blue-50":""),onClick:()=>y(e),children:[(0,r.jsx)("div",{className:"font-medium",children:e.SCHUL_NM}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[e.LCTN_SC_NM," | ",e.SCHUL_KND_SC_NM]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.ORG_RDNMA})]},e.SD_SCHUL_CODE))})]}),c&&(0,r.jsxs)("div",{className:"mb-6 p-4 border rounded bg-gray-50",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"선택한 학교"}),(0,r.jsx)("div",{className:"font-medium",children:c.SCHUL_NM}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[c.LCTN_SC_NM," | ",c.SCHUL_KND_SC_NM]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-4",children:c.ORG_RDNMA}),(0,r.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"grade",className:"block text-sm font-medium text-gray-700 mb-1",children:"학년"}),(0,r.jsxs)("select",{id:"grade",name:"grade",value:m.grade,onChange:w,className:"w-full p-2 border rounded",children:[(0,r.jsx)("option",{value:"",children:"선택하세요"}),(()=>{if(!c)return[1,2,3];let e=c.SCHUL_KND_SC_NM;return"초등학교"===e?[1,2,3,4,5,6]:("중학교"===e||e.includes("고등학교"),[1,2,3])})().map(e=>(0,r.jsxs)("option",{value:e,children:[e,"학년"]},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"classNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"반"}),(0,r.jsxs)("select",{id:"classNumber",name:"classNumber",value:m.classNumber,onChange:w,className:"w-full p-2 border rounded",children:[(0,r.jsx)("option",{value:"",children:"선택하세요"}),Array.from({length:15},(e,s)=>s+1).map(e=>(0,r.jsxs)("option",{value:e,children:[e,"반"]},e))]})]})]})]}),c&&(0,r.jsxs)("div",{className:"mt-6",children:[v?(0,r.jsxs)("div",{className:"p-4 bg-green-100 border border-green-400 text-green-700 rounded mb-4",children:[(0,r.jsx)("p",{className:"font-medium",children:"학교 정보가 성공적으로 저장되었습니다!"}),(0,r.jsx)("p",{className:"text-sm mt-1",children:"잠시 후 메인 페이지로 이동합니다..."})]}):(0,r.jsx)("button",{onClick:k,disabled:_,className:"w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",children:_?"저장 중...":"정보 저장하기"}),f&&(0,r.jsx)("div",{className:"mt-3 p-3 bg-red-100 border border-red-400 text-red-700 rounded text-sm",children:f})]})]})}},1525:(e,s,t)=>{"use strict";t.d(s,{U:()=>o});var r=t(4175);let a=null,l=()=>!0,o=()=>{if(a)return a;if(!l())return console.debug("서버 환경에서 Supabase 클라이언트 호출 - 제한된 기능"),{auth:{getSession:()=>({data:{session:null}}),getUser:()=>({data:{user:null}}),signOut:()=>Promise.resolve({error:null})},from:()=>({select:()=>({eq:()=>({single:()=>Promise.resolve({data:null,error:null}),data:[],error:null})})})};let e="https://izkumvvlkrkgiuuczffp.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc";try{return a=(0,r.kT)(e,s,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",localStorage:l()?window.localStorage:void 0},global:{fetch:function(){for(var e,t,r,a=arguments.length,l=Array(a),o=0;o<a;o++)l[o]=arguments[o];let n=String(l[0]instanceof URL?l[0].toString():l[0]),i=["/meal_images","/profiles","/menu_item_ratings","/school_infos","/quiz","/comment_likes"].some(e=>n.includes(e)||n.includes("school_infos")||n.includes("/quiz"));if(n.includes("/rest/v1/")){let e=(null==(r=l[1])?void 0:r.headers)||{};l[1]={...l[1],headers:{...e,apikey:s,Authorization:"Bearer ".concat(s),Accept:"application/json"}}}return!n.includes("/rest/v1/")||i||(null==(e=l[1])?void 0:e.headers)&&Object.entries((null==(t=l[1])?void 0:t.headers)||{}).some(e=>{let[s,t]=e;return"apikey"===s.toLowerCase()||"authorization"===s.toLowerCase()})?n.includes("/comment_likes")?(l[1]||(l[1]={}),l[1].headers||(l[1].headers={}),l[1].headers.Accept="application/json",l[1].headers["Content-Type"]="application/json",fetch(...l).then(e=>200!==e.status?(console.debug("comment_likes 요청 응답 코드 ".concat(e.status," 수정 처리")),new Response(JSON.stringify({data:[]}),{status:200,headers:{"Content-Type":"application/json"}})):e).catch(e=>(console.debug("좋아요 요청 처리 오류 포착:",e),new Response(JSON.stringify({data:[]}),{status:200})))):fetch(...l).catch(e=>{if(404===e.status)return new Response(JSON.stringify({error:"Not found",quiet:!0}),{status:404});throw e}):(console.debug("권한 없는 Supabase REST API 요청 차단:",n),Promise.resolve(new Response(JSON.stringify({message:"No API key found in request",hint:"No 'apikey' request header or url param was found."}),{status:401})))}}})}catch(t){return console.debug("Supabase 클라이언트 초기화 중 오류 발생 (무시됨)"),a=(0,r.kT)(e,s)}}},7192:(e,s,t)=>{Promise.resolve().then(t.bind(t,906))}},e=>{var s=s=>e(e.s=s);e.O(0,[838,587,315,358],()=>s(7192)),_N_E=e.O()}]);