(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{931:(e,t,n)=>{"use strict";function r(e){let{reason:t,children:n}=e;return n}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}}),n(3159)},1039:(e,t,n)=>{"use strict";n.d(t,{default:()=>a.a});var r=n(7684),a=n.n(r)},1525:(e,t,n)=>{"use strict";n.d(t,{$k:()=>l,UU:()=>s});var r=n(4175);let a=null,o=()=>!0,s=()=>{if(a)return a;if(!o())return console.debug("서버 환경에서 Supabase 클라이언트 호출 - 제한된 기능"),{auth:{getSession:()=>({data:{session:null}}),getUser:()=>({data:{user:null}}),signOut:()=>Promise.resolve({error:null}),signInWithOAuth:()=>Promise.resolve({data:null,error:Error("서버 환경에서는 OAuth 불가")})},from:()=>({select:()=>({eq:()=>({single:()=>Promise.resolve({data:null,error:null}),data:[],error:null})})})};let e="https://izkumvvlkrkgiuuczffp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc";try{return a=(0,r.kT)(e,t,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},cookies:{get(e){if("undefined"!=typeof document){var t;let n="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===n.length)return null==(t=n.pop())?void 0:t.split(";").shift()}},set(e,t,n){if("undefined"!=typeof document){let r="".concat(e,"=").concat(t);(null==n?void 0:n.maxAge)&&(r+="; max-age=".concat(n.maxAge)),(null==n?void 0:n.path)&&(r+="; path=".concat(n.path)),(null==n?void 0:n.domain)&&(r+="; domain=".concat(n.domain)),(null==n?void 0:n.secure)&&(r+="; secure"),(null==n?void 0:n.httpOnly)&&(r+="; httponly"),(null==n?void 0:n.sameSite)&&(r+="; samesite=".concat(n.sameSite)),document.cookie=r}},remove(e,t){if("undefined"!=typeof document){let n="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 GMT");(null==t?void 0:t.path)&&(n+="; path=".concat(t.path)),(null==t?void 0:t.domain)&&(n+="; domain=".concat(t.domain)),document.cookie=n}}},global:{fetch:function(){for(var e,n,r,a=arguments.length,o=Array(a),s=0;s<a;s++)o[s]=arguments[s];let i=String(o[0]instanceof URL?o[0].toString():o[0]),l=["/meal_images","/profiles","/menu_item_ratings","/school_infos","/quiz","/comment_likes"].some(e=>i.includes(e)||i.includes("school_infos")||i.includes("/quiz"));if(i.includes("/rest/v1/")){let e=(null==(r=o[1])?void 0:r.headers)||{};o[1]={...o[1],headers:{...e,apikey:t,Authorization:"Bearer ".concat(t),Accept:"application/json"}}}return!i.includes("/rest/v1/")||l||(null==(e=o[1])?void 0:e.headers)&&Object.entries((null==(n=o[1])?void 0:n.headers)||{}).some(e=>{let[t,n]=e;return"apikey"===t.toLowerCase()||"authorization"===t.toLowerCase()})?i.includes("/comment_likes")?(o[1]||(o[1]={}),o[1].headers||(o[1].headers={}),o[1].headers.Accept="application/json",o[1].headers["Content-Type"]="application/json",fetch(...o).then(e=>200!==e.status?(console.debug("comment_likes 요청 응답 코드 ".concat(e.status," 수정 처리")),new Response(JSON.stringify({data:[]}),{status:200,headers:{"Content-Type":"application/json"}})):e).catch(e=>(console.debug("좋아요 요청 처리 오류 포착:",e),new Response(JSON.stringify({data:[]}),{status:200})))):fetch(...o).catch(e=>{if(404===e.status)return new Response(JSON.stringify({error:"Not found",quiet:!0}),{status:404});throw e}):(console.debug("권한 없는 Supabase REST API 요청 차단:",i),Promise.resolve(new Response(JSON.stringify({message:"No API key found in request",hint:"No 'apikey' request header or url param was found."}),{status:401})))}}})}catch(n){return console.debug("Supabase 클라이언트 초기화 중 오류 발생 (무시됨)"),a=(0,r.kT)(e,t)}},i=async()=>{try{let e=s();await e.auth.signOut();{let e=[];for(let t=0;t<localStorage.length;t++){let n=localStorage.key(t);n&&(n.startsWith("sb-")||n.includes("supabase"))&&e.push(n)}e.forEach(e=>localStorage.removeItem(e)),sessionStorage.clear(),document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+new Date().toUTCString()+";path=/")})}a=null,console.debug("세션 완전 정리 완료")}catch(e){console.debug("세션 정리 중 오류 (무시됨):",e)}},l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=s();console.log("\uD83D\uDD0D 로그인 시도 환경 정보:",{url:"https://izkumvvlkrkgiuuczffp.supabase.co",provider:e,userAgent:navigator.userAgent,cookiesEnabled:navigator.cookieEnabled,localStorage:"undefined"!=typeof localStorage,currentUrl:window.location.href});for(let r=1;r<=t;r++)try{console.log("\uD83D\uDE80 로그인 시도 ".concat(r,"/").concat(t," 시작")),r>1&&(console.log("\uD83E\uDDF9 이전 세션 정리 중..."),await i(),await new Promise(e=>setTimeout(e,1e3)));let{data:a}=await n.auth.getSession();console.log("\uD83D\uDCCA 현재 세션 상태:",a.session?"있음":"없음");let{data:o,error:s}=await n.auth.signInWithOAuth({provider:e,options:{redirectTo:"".concat(window.location.origin,"/auth/callback"),queryParams:{access_type:"offline",prompt:"consent"}}});if(console.log("✅ OAuth 요청 결과:",{data:o,error:s}),s)throw s;return{data:o,error:null}}catch(n){if(console.error("❌ 로그인 시도 ".concat(r,"/").concat(t," 실패:"),{error:n,errorMessage:null==n?void 0:n.message,errorCode:null==n?void 0:n.status,timestamp:new Date().toISOString()}),r===t)return{data:null,error:n};let e=1e3*Math.pow(2,r);console.log("⏳ ".concat(e,"ms 대기 후 재시도...")),await new Promise(t=>setTimeout(t,e))}}},2644:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let r=n(4568),a=n(7620),o=n(931);function s(e){return{default:e&&"default"in e?e.default:e}}n(4289);let i={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},l=function(e){let t={...i,...e},n=(0,a.lazy)(()=>t.loader().then(s)),l=t.loading;function c(e){let s=l?(0,r.jsx)(l,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,c=i?a.Suspense:a.Fragment,u=t.ssr?(0,r.jsxs)(r.Fragment,{children:[null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(o.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(c,{...i?{fallback:s}:{},children:u})}return c.displayName="LoadableComponent",c}},3139:()=>{},3334:(e,t,n)=>{Promise.resolve().then(n.bind(n,8558)),Promise.resolve().then(n.bind(n,9220)),Promise.resolve().then(n.bind(n,7584)),Promise.resolve().then(n.t.bind(n,4703,23)),Promise.resolve().then(n.t.bind(n,7573,23)),Promise.resolve().then(n.t.bind(n,3139,23)),Promise.resolve().then(n.bind(n,5317))},4289:(e,t,n)=>{"use strict";function r(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return r}}),n(4568),n(7509),n(9669),n(2252)},4703:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_5cfdac",variable:"__variable_5cfdac"}},6035:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return r}});let r=(0,n(9113).createAsyncLocalStorage)()},7573:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}},7584:(e,t,n)=>{"use strict";n.d(t,{_:()=>l,default:()=>i});var r=n(4568),a=n(7620),o=n(4175);let s=(0,a.createContext)({supabase:(0,o.kT)("https://izkumvvlkrkgiuuczffp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc"),session:null});function i(e){let{children:t,session:n}=e,[i]=(0,a.useState)(()=>(0,o.kT)("https://izkumvvlkrkgiuuczffp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc"));return(0,r.jsx)(s.Provider,{value:{supabase:i,session:n},children:t})}let l=()=>{let e=(0,a.useContext)(s);if(void 0===e)throw Error("useSupabase must be used inside SupabaseProvider");return e}},7684:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let r=n(1510)._(n(2644));function a(e,t){var n;let a={};"function"==typeof e&&(a.loader=e);let o={...a,...t};return(0,r.default)({...o,modules:null==(n=o.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8558:(e,t,n)=>{"use strict";n.d(t,{default:()=>o});var r=n(4568);let a=(0,n(1039).default)(()=>Promise.all([n.e(423),n.e(517)]).then(n.bind(n,8517)),{loadableGenerated:{webpack:()=>[8517]},ssr:!1});function o(){return(0,r.jsx)(a,{})}},9113:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{bindSnapshot:function(){return s},createAsyncLocalStorage:function(){return o},createSnapshot:function(){return i}});let n=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class r{disable(){throw n}getStore(){}run(){throw n}exit(){throw n}enterWith(){throw n}static bind(e){return e}}let a="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function o(){return a?new a:new r}function s(e){return a?a.bind(e):r.bind(e)}function i(){return a?a.snapshot():function(e,...t){return e(...t)}}},9220:(e,t,n)=>{"use strict";n.d(t,{default:()=>d});var r=n(4568),a=n(7261),o=n.n(a),s=n(2942),i=n(1525),l=n(7620);function c(){let[e,t]=(0,l.useState)(!1),[n,a]=(0,l.useState)(0),[s,c]=(0,l.useState)([]),[u,d]=(0,l.useState)(!1),f=(0,i.UU)(),h=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{h.current&&!h.current.contains(e.target)&&t(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,l.useEffect)(()=>{(async()=>{try{d(!0);let{data:{session:e}}=await f.auth.getSession();if(!(null==e?void 0:e.user))return;let{data:t,error:n}=await f.from("notification_recipients").select("\n            id,\n            notification_id,\n            is_read,\n            read_at,\n            created_at,\n            notification:notification_id (id, title, message, related_type, related_id, sender_id, school_code, created_at)\n          ").eq("recipient_id",e.user.id).order("created_at",{ascending:!1}).limit(10);if(n)return void console.error("알림 조회 오류:",n);let r=(null==t?void 0:t.map(e=>({id:e.id,notification_id:e.notification_id,is_read:e.is_read,read_at:e.read_at,created_at:e.created_at,...e.notification})))||[];c(r);let o=r.filter(e=>!e.is_read)||[];a(o.length)}catch(e){console.error("알림 데이터 로딩 오류:",e)}finally{d(!1)}})();let e=(async()=>{let{data:{session:e}}=await f.auth.getSession();if(!(null==e?void 0:e.user))return;let t=f.channel("notifications-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"notification_recipients",filter:"recipient_id=eq.".concat(e.user.id)},e=>{(async()=>{try{let{data:t,error:n}=await f.from("notifications").select("*").eq("id",e.new.notification_id).single();if(n||!t)return;let r={id:e.new.id,notification_id:e.new.notification_id,is_read:!1,created_at:e.new.created_at,...t};c(e=>[r,...e].slice(0,10)),a(e=>e+1)}catch(e){console.error("새 알림 조회 오류:",e)}})()}).subscribe();return()=>{t.unsubscribe()}})();return()=>{e&&e.then(e=>{"function"==typeof e&&e()})}},[f]);let m=async e=>{try{if(console.log("알림 읽음 처리 시도:",{notificationId:e}),!s.find(t=>t.notification_id===e))return void console.warn("읽음 처리할 알림을 찾을 수 없습니다.");c(t=>t.map(t=>t.notification_id===e?{...t,is_read:!0}:t)),a(e=>Math.max(0,e-1));let{data:{session:t}}=await f.auth.getSession(),n={"Content-Type":"application/json"};(null==t?void 0:t.access_token)&&(n.Authorization="Bearer ".concat(t.access_token));let r=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;try{let o=new AbortController,s=setTimeout(()=>o.abort(),5e3);try{let i=await fetch("/.netlify/functions/notifications-read",{method:"POST",headers:n,body:JSON.stringify({notificationId:e}),signal:o.signal});if(clearTimeout(s),i.ok){let e=await i.json();console.log("알림 읽음 처리 API 성공:",e);return}if(i.status>=500&&t<a)return console.warn("API 호출 실패 (".concat(i.status,"), ").concat(t+1,"번째 재시도...")),await new Promise(e=>setTimeout(e,1e3)),r(t+1,a);console.warn("API 호출 실패지만 UI는 업데이트됨:",i.status)}catch(e){if(clearTimeout(s),("AbortError"===e.name||"TypeError"===e.name)&&t<a)return console.warn("API 호출 시간 초과, ".concat(t+1,"번째 재시도...")),await new Promise(e=>setTimeout(e,1e3)),r(t+1,a);throw e}}catch(e){console.error("알림 읽음 시도 중 오류:",e)}};await r()}catch(e){console.error("알림 상태 업데이트 오류:",e)}},p=async()=>{try{var e;let{data:{session:t}}=await f.auth.getSession();if(!(null==t||null==(e=t.user)?void 0:e.id))return void console.error("사용자 세션을 찾을 수 없습니다.");let n=s.filter(e=>!e.is_read);if(0===n.length)return;let{error:r}=await f.from("notification_recipients").update({is_read:!0,read_at:new Date().toISOString()}).eq("recipient_id",t.user.id).eq("is_read",!1);if(r)throw console.error("모든 알림 읽음 처리 실패:",r),Error("모든 알림 읽음 처리 실패");c(e=>e.map(e=>({...e,is_read:!0}))),a(0)}catch(e){console.error("알림 일괄 업데이트 오류:",e)}},g=e=>{let t=new Date(e),n=Math.floor((new Date().getTime()-t.getTime())/1e3);return n<60?"방금 전":n<3600?"".concat(Math.floor(n/60),"분 전"):n<86400?"".concat(Math.floor(n/3600),"시간 전"):n<604800?"".concat(Math.floor(n/86400),"일 전"):"".concat(t.getFullYear(),".").concat(String(t.getMonth()+1).padStart(2,"0"),".").concat(String(t.getDate()).padStart(2,"0"))},v=e=>{switch(e){case"meal_image":return(0,r.jsx)("svg",{className:"w-5 h-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})});case"comment":return(0,r.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})});default:return(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}};return(0,r.jsxs)("div",{className:"relative",ref:h,children:[(0,r.jsxs)("button",{onClick:()=>t(!e),className:"relative p-1 rounded-full text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500","aria-label":"알림",children:[(0,r.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),n>0&&(0,r.jsx)("span",{className:"absolute top-0 right-0 block h-4 w-4 rounded-full bg-red-500 text-white text-xs font-bold flex items-center justify-center transform translate-x-1/2 -translate-y-1/4",children:n>9?"9+":n})]}),e&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-80 sm:w-96 bg-white rounded-md shadow-lg z-50 overflow-hidden",children:[(0,r.jsxs)("div",{className:"border-b px-4 py-2 flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"알림"}),n>0&&(0,r.jsx)("button",{onClick:p,className:"text-xs text-blue-600 hover:text-blue-800 cursor-pointer",children:"모두 읽음 표시"})]}),(0,r.jsx)("div",{className:"max-h-96 overflow-y-auto",children:u?(0,r.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-400 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"알림을 불러오는 중..."]}):s.length>0?s.map(e=>(0,r.jsx)("div",{className:"p-4 border-b ".concat(e.is_read?"bg-white":"bg-blue-50"," hover:bg-gray-50"),children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mr-3",children:v(e.related_type)}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)(o(),{href:"/?notification=".concat(e.related_id),onClick:()=>{e.is_read||m(e.notification_id),t(!1)},className:"block",children:[(0,r.jsx)("p",{className:"text-sm ".concat(e.is_read?"font-normal":"font-medium"," text-gray-900"),children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-500 truncate",children:e.message}),(0,r.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:g(e.created_at)})]})}),!e.is_read&&(0,r.jsx)("button",{onClick:()=>m(e.notification_id),className:"ml-2 text-gray-400 hover:text-gray-600","aria-label":"읽음 표시",children:(0,r.jsx)("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})},e.id)):(0,r.jsx)("div",{className:"p-4 text-center text-gray-500",children:"새로운 알림이 없습니다."})})]})]})}let u=[{label:"급식",href:"/"},{label:"퀴즈",href:"/quiz"},{label:"배틀",href:"/battle"},{label:"랭킹",href:"/ranking"}];function d(){let e=(0,i.UU)(),t=(0,s.usePathname)(),n=(0,s.useRouter)(),a=(0,s.useSearchParams)(),[d,f]=(0,l.useState)(null),h=(0,l.useRef)(null),[m,p]=(0,l.useState)(null);return(0,l.useEffect)(()=>{(async()=>{let{data:{session:t}}=await e.auth.getSession();f((null==t?void 0:t.user)||null)})();let{data:t}=e.auth.onAuthStateChange((e,t)=>{f((null==t?void 0:t.user)||null)});return()=>{null==t||t.subscription.unsubscribe()}},[e]),(0,l.useEffect)(()=>{(async()=>{if(null==d?void 0:d.id){let{data:n,error:r}=await e.from("users").select("nickname").eq("id",d.id).single();if(!r&&n)p(n.nickname);else{var t;p((null==(t=d.user_metadata)?void 0:t.name)||null)}}else p(null)})()},[null==d?void 0:d.id,e]),(0,r.jsx)("header",{className:"sticky top-0 z-40 border-b bg-white/70 backdrop-blur supports-[backdrop-filter]:bg-white/40",children:(0,r.jsxs)("div",{className:"mx-auto flex max-w-screen-xl items-center justify-between px-4 py-2 sm:px-6 lg:px-8",children:[(0,r.jsx)(o(),{href:"/",className:"text-lg sm:text-xl font-bold text-gray-900",children:"뭐먹지?"}),(0,r.jsx)("nav",{className:"flex overflow-x-auto gap-3 sm:gap-6 px-1 py-1 -mx-1 scrollbar-hide",children:u.map(e=>{let n=null==a?void 0:a.get("date"),s=n?"".concat(e.href,"?date=").concat(n):e.href;return(0,r.jsx)(o(),{href:s,className:"text-xs sm:text-sm font-medium whitespace-nowrap px-2 py-1 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors ".concat("/"===e.href?"/"===t?"bg-indigo-50 text-indigo-600":"text-gray-700":t.startsWith(e.href)?"bg-indigo-50 text-indigo-600":"text-gray-700"),children:e.label},e.href)})}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[d&&(0,r.jsx)(c,{}),(0,r.jsx)("div",{className:"relative",ref:h,children:d?(0,r.jsx)("button",{onClick:()=>n.push("/profile"),className:"relative h-8 w-8 overflow-hidden rounded-full border border-gray-300 bg-white hover:border-indigo-500 transition-colors",children:(()=>{var e;let t=null==(e=d.user_metadata)?void 0:e.avatar_url;if(t&&t.startsWith("http://")&&console.log("Profile image URL changed to HTTPS:",t=t.replace("http://","https://")),t)return(0,r.jsx)("img",{src:t,alt:m||"User Avatar",className:"h-full w-full object-cover",onError:e=>{e.currentTarget.style.display="none";let t=e.currentTarget.parentElement;t&&m&&(t.classList.add("flex","items-center","justify-center","bg-slate-300"),t.textContent=m.charAt(0).toUpperCase())}});if(!m)return(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-gray-200",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})});{let e=m.charAt(0).toUpperCase();return(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-slate-300 text-slate-700 text-sm font-semibold",children:e})}})()}):(0,r.jsxs)(o(),{href:"/login",className:"flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})}),"로그인"]})})]})]})})}},9669:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return r.workAsyncStorageInstance}});let r=n(6035)}},e=>{var t=t=>e(e.s=t);e.O(0,[392,838,261,317,587,315,358],()=>t(3334)),_N_E=e.O()}]);