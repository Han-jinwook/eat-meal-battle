(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[602],{1525:(e,t,s)=>{"use strict";s.d(t,{U:()=>o});var n=s(4175);let r=null,a=()=>!0,o=()=>{if(r)return r;if(!a())return console.debug("서버 환경에서 Supabase 클라이언트 호출 - 제한된 기능"),{auth:{getSession:()=>({data:{session:null}}),getUser:()=>({data:{user:null}}),signOut:()=>Promise.resolve({error:null})},from:()=>({select:()=>({eq:()=>({single:()=>Promise.resolve({data:null,error:null}),data:[],error:null})})})};let e="https://izkumvvlkrkgiuuczffp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc";try{return r=(0,n.kT)(e,t,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",localStorage:a()?window.localStorage:void 0},global:{fetch:function(){for(var e,s,n,r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];let l=String(a[0]instanceof URL?a[0].toString():a[0]),i=["/meal_images","/profiles","/menu_item_ratings","/school_infos","/quiz","/comment_likes"].some(e=>l.includes(e)||l.includes("school_infos")||l.includes("/quiz"));if(l.includes("/rest/v1/")){let e=(null==(n=a[1])?void 0:n.headers)||{};a[1]={...a[1],headers:{...e,apikey:t,Authorization:"Bearer ".concat(t),Accept:"application/json"}}}return!l.includes("/rest/v1/")||i||(null==(e=a[1])?void 0:e.headers)&&Object.entries((null==(s=a[1])?void 0:s.headers)||{}).some(e=>{let[t,s]=e;return"apikey"===t.toLowerCase()||"authorization"===t.toLowerCase()})?l.includes("/comment_likes")?(a[1]||(a[1]={}),a[1].headers||(a[1].headers={}),a[1].headers.Accept="application/json",a[1].headers["Content-Type"]="application/json",fetch(...a).then(e=>200!==e.status?(console.debug("comment_likes 요청 응답 코드 ".concat(e.status," 수정 처리")),new Response(JSON.stringify({data:[]}),{status:200,headers:{"Content-Type":"application/json"}})):e).catch(e=>(console.debug("좋아요 요청 처리 오류 포착:",e),new Response(JSON.stringify({data:[]}),{status:200})))):fetch(...a).catch(e=>{if(404===e.status)return new Response(JSON.stringify({error:"Not found",quiet:!0}),{status:404});throw e}):(console.debug("권한 없는 Supabase REST API 요청 차단:",l),Promise.resolve(new Response(JSON.stringify({message:"No API key found in request",hint:"No 'apikey' request header or url param was found."}),{status:401})))}}})}catch(s){return console.debug("Supabase 클라이언트 초기화 중 오류 발생 (무시됨)"),r=(0,n.kT)(e,t)}}},1794:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var n=s(4568),r=s(7620),a=s(2942),o=s(7261),l=s.n(o),i=s(1525);function c(){let e=(0,i.U)(),t=(0,a.useRouter)(),[s,o]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null),[u,h]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1),[b,g]=(0,r.useState)(null),[w,j]=(0,r.useState)(null),[y,N]=(0,r.useState)([]),[v,_]=(0,r.useState)(null),[S,k]=(0,r.useState)(!1),[z,C]=(0,r.useState)(!1),[I,q]=(0,r.useState)(""),A=async()=>{try{o(!0),q("");let{data:{session:s}}=await e.auth.getSession();if(!s)return void t.push("/login");let n=await fetch("/api/quiz",{headers:{Authorization:"Bearer ".concat(s.access_token)}});if(!n.ok){404===n.status?q("오늘의 퀴즈가 아직 준비되지 않았습니다."):q("퀴즈를 불러오는 중 오류가 발생했습니다."),o(!1);return}let r=await n.json();if(r.error){q(r.error),o(!1);return}r.quiz&&(d(r.quiz),f(r.alreadyAnswered||!1),C(!1),r.alreadyAnswered&&void 0!==r.isCorrect?x({isCorrect:r.isCorrect,correctAnswer:void 0!==r.quiz.correct_answer?r.quiz.correct_answer:0,message:r.isCorrect?"정답입니다!":"틀렸습니다."}):g(Date.now())),o(!1)}catch(e){console.error("퀴즈 로딩 중 오류:",e),q("퀴즈를 불러오는 중 오류가 발생했습니다."),o(!1)}},J=async s=>{if(!z&&!p&&c&&null===u)try{C(!0),h(s);let n=Date.now(),r=b?Math.round((n-b)/1e3):10;j(r);let{data:{session:a}}=await e.auth.getSession();if(!a)return void t.push("/login");let o=await fetch("/api/quiz/answer",{method:"POST",headers:{Authorization:"Bearer ".concat(a.access_token),"Content-Type":"application/json"},body:JSON.stringify({quiz_id:c.id,selected_option:s,answer_time:r})}),l=await o.json();if(l.error){q(l.error),C(!1);return}x(l),f(!0),l.isCorrect&&(k(!0),setTimeout(()=>k(!1),3e3)),O()}catch(e){console.error("답변 제출 중 오류:",e),q("답변을 제출하는 중 오류가 발생했습니다.")}finally{C(!1)}},O=async()=>{try{let{data:{session:s}}=await e.auth.getSession();if(!s)return void t.push("/login");let n=await fetch("/api/quiz/champions",{headers:{Authorization:"Bearer ".concat(s.access_token)}});if(!n.ok)return void console.error("장원 목록 가져오기 실패:",n.status);let r=await n.json();if(r.error)return void console.error("장원 목록 에러:",r.error);if(r.champions){N(r.champions);let{data:{user:t}}=await e.auth.getUser();if(t){let e=r.champions.findIndex(e=>e.user_id===t.id);_(-1!==e?e+1:null)}}}catch(e){console.error("장원 목록 가져오기 중 오류:",e)}};return((0,r.useEffect)(()=>{A(),O()},[]),s)?(0,n.jsxs)("main",{className:"flex min-h-[60vh] flex-col items-center justify-center p-8 text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"퀴즈를 불러오는 중입니다..."})]}):I?(0,n.jsxs)("main",{className:"flex min-h-[60vh] flex-col items-center justify-center p-8 text-center",children:[(0,n.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded max-w-md",children:[(0,n.jsx)("p",{className:"font-bold",children:"오류 발생"}),(0,n.jsx)("p",{children:I})]}),(0,n.jsx)("button",{onClick:A,className:"mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"새로고침"})]}):c?(0,n.jsxs)("main",{className:"flex min-h-[80vh] flex-col items-center p-4 md:p-8 max-w-4xl mx-auto",children:[(0,n.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n    @keyframes confetti-fall {\n      0% { transform: translateY(-100vh) rotate(0deg); }\n      100% { transform: translateY(100vh) rotate(720deg); }\n    }\n    \n    .confetti-container {\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      z-index: 50;\n      overflow: hidden;\n    }\n    \n    .confetti {\n      position: absolute;\n      width: 10px;\n      height: 10px;\n      top: -10px;\n      opacity: 0.8;\n      animation: confetti-fall 3s linear forwards;\n    }\n    \n    .option-button {\n      transition: all 0.3s ease;\n    }\n    \n    .option-button:hover:not(:disabled) {\n      transform: scale(1.02);\n    }\n    \n    .option-button:active:not(:disabled) {\n      transform: scale(0.98);\n    }\n    \n    .option-dimmed {\n      opacity: 0.6;\n    }\n  "}}),S&&(0,n.jsx)("div",{className:"confetti-container",children:[...Array(50)].map((e,t)=>(0,n.jsx)("div",{className:"confetti",style:{left:"".concat(100*Math.random(),"%"),animationDelay:"".concat(3*Math.random(),"s"),backgroundColor:"hsl(".concat(360*Math.random(),", 80%, 60%)")}},t))}),(0,n.jsxs)("div",{className:"w-full max-w-2xl",children:[(0,n.jsxs)("div",{className:"mb-6 text-center",children:[(0,n.jsx)("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:"오늘의 급식 퀴즈"}),(0,n.jsx)("p",{className:"text-gray-600",children:new Date(c.meal_date).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})}),c.explanation&&p&&(0,n.jsxs)("div",{className:"mt-4 px-3 py-1 rounded-lg text-sm border border-blue-400 bg-blue-50 text-blue-700",children:["해설: ",c.explanation]})]}),(0,n.jsxs)("div",{className:"mb-6 p-4 bg-amber-50 rounded-lg shadow-sm",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"오늘의 메뉴"}),(0,n.jsx)("ul",{className:"list-disc list-inside",children:c.menu_items.map((e,t)=>(0,n.jsx)("li",{className:"text-gray-700",children:e},t))})]}),(0,n.jsxs)("div",{className:"mb-6 p-6 bg-white rounded-lg shadow-md",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:c.question}),(0,n.jsx)("div",{className:"space-y-3",children:c.options.map((e,t)=>(0,n.jsx)("button",{onClick:()=>J(t),disabled:p||z,className:"w-full p-4 text-left rounded-lg transition-all transform hover:scale-102 border option-button\n                  ".concat(u===t?(null==m?void 0:m.isCorrect)?"bg-green-100 border-green-500":"bg-red-100 border-red-500":void 0!==c.correct_answer&&c.correct_answer===t?"bg-green-100 border-green-500":"bg-gray-50 border-gray-200 hover:bg-gray-100","\n                  ").concat(p&&u!==t&&t!==(void 0!==c.correct_answer?c.correct_answer:null==m?void 0:m.correctAnswer)?"option-dimmed":""),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"w-8 h-8 flex items-center justify-center rounded-full bg-blue-500 text-white mr-3",children:t+1}),(0,n.jsx)("span",{children:e})]})},t))}),(m||p&&void 0!==c.correct_answer)&&(0,n.jsxs)("div",{className:"mt-6 p-4 rounded-lg ".concat((null==m?void 0:m.isCorrect)||u===c.correct_answer?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:[(0,n.jsx)("p",{className:"font-bold text-lg",children:(null==m?void 0:m.message)||(u===c.correct_answer?"정답입니다!":"틀렸습니다.")}),null!==w&&(0,n.jsxs)("p",{className:"text-sm mt-1",children:["응답 시간: ",w,"초"]}),void 0!==c.correct_answer&&u!==c.correct_answer&&(0,n.jsxs)("p",{className:"mt-2",children:["정답: ",c.options[c.correct_answer]]})]})]}),(0,n.jsxs)("div",{className:"mt-8 p-6 bg-white rounded-lg shadow-md",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:"이달의 퀴즈 장원"}),0===y.length?(0,n.jsx)("p",{className:"text-gray-600 text-center py-4",children:"아직 장원 기록이 없습니다."}):(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100",children:[(0,n.jsx)("th",{className:"px-4 py-2 text-left",children:"순위"}),(0,n.jsx)("th",{className:"px-4 py-2 text-left",children:"이름"}),(0,n.jsx)("th",{className:"px-4 py-2 text-right",children:"정답률"}),(0,n.jsx)("th",{className:"px-4 py-2 text-right",children:"평균 응답시간"})]})}),(0,n.jsx)("tbody",{children:y.map((e,t)=>(0,n.jsxs)("tr",{className:"border-t ".concat(v===t+1?"bg-blue-50":""),children:[(0,n.jsx)("td",{className:"px-4 py-3",children:0===t?"\uD83E\uDD47":1===t?"\uD83E\uDD48":2===t?"\uD83E\uDD49":"".concat(t+1,"위")}),(0,n.jsxs)("td",{className:"px-4 py-3 flex items-center",children:[e.users.avatar_url&&(0,n.jsx)("img",{src:e.users.avatar_url,alt:"프로필",className:"w-6 h-6 rounded-full mr-2"}),e.users.nickname||"사용자"]}),(0,n.jsxs)("td",{className:"px-4 py-3 text-right",children:[e.correct_count,"/",e.total_count," (",Math.round(e.correct_count/e.total_count*100),"%)"]}),(0,n.jsxs)("td",{className:"px-4 py-3 text-right",children:[e.avg_answer_time.toFixed(1),"초"]})]},e.id))})]})}),null===v&&p&&(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-4 text-center",children:"더 많은 퀴즈에 참여하여 장원 목록에 이름을 올려보세요!"})]})]})]}):(0,n.jsxs)("main",{className:"flex min-h-[60vh] flex-col items-center justify-center p-8 text-center",children:[(0,n.jsxs)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded max-w-md",children:[(0,n.jsx)("p",{className:"font-bold",children:"퀴즈가 없습니다"}),(0,n.jsx)("p",{children:"오늘의 퀴즈가 아직 준비되지 않았습니다. 나중에 다시 시도해주세요."})]}),(0,n.jsx)(l(),{href:"/",className:"mt-4 text-blue-500 hover:text-blue-700 font-bold",children:"홈으로 돌아가기"})]})}},3370:(e,t,s)=>{Promise.resolve().then(s.bind(s,1794))}},e=>{var t=t=>e(e.s=t);e.O(0,[838,261,587,315,358],()=>t(3370)),_N_E=e.O()}]);