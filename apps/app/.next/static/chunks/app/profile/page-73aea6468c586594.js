(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{1525:(e,s,a)=>{"use strict";a.d(s,{U:()=>r});var l=a(4175);let t=null,n=()=>!0,r=()=>{if(t)return t;if(!n())return console.debug("서버 환경에서 Supabase 클라이언트 호출 - 제한된 기능"),{auth:{getSession:()=>({data:{session:null}}),getUser:()=>({data:{user:null}}),signOut:()=>Promise.resolve({error:null})},from:()=>({select:()=>({eq:()=>({single:()=>Promise.resolve({data:null,error:null}),data:[],error:null})})})};let e="https://izkumvvlkrkgiuuczffp.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc";try{return t=(0,l.kT)(e,s,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",localStorage:n()?window.localStorage:void 0},global:{fetch:function(){for(var e,a,l,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];let c=String(n[0]instanceof URL?n[0].toString():n[0]),i=["/meal_images","/profiles","/menu_item_ratings","/school_infos","/quiz","/comment_likes"].some(e=>c.includes(e)||c.includes("school_infos")||c.includes("/quiz"));if(c.includes("/rest/v1/")){let e=(null==(l=n[1])?void 0:l.headers)||{};n[1]={...n[1],headers:{...e,apikey:s,Authorization:"Bearer ".concat(s),Accept:"application/json"}}}return!c.includes("/rest/v1/")||i||(null==(e=n[1])?void 0:e.headers)&&Object.entries((null==(a=n[1])?void 0:a.headers)||{}).some(e=>{let[s,a]=e;return"apikey"===s.toLowerCase()||"authorization"===s.toLowerCase()})?c.includes("/comment_likes")?(n[1]||(n[1]={}),n[1].headers||(n[1].headers={}),n[1].headers.Accept="application/json",n[1].headers["Content-Type"]="application/json",fetch(...n).then(e=>200!==e.status?(console.debug("comment_likes 요청 응답 코드 ".concat(e.status," 수정 처리")),new Response(JSON.stringify({data:[]}),{status:200,headers:{"Content-Type":"application/json"}})):e).catch(e=>(console.debug("좋아요 요청 처리 오류 포착:",e),new Response(JSON.stringify({data:[]}),{status:200})))):fetch(...n).catch(e=>{if(404===e.status)return new Response(JSON.stringify({error:"Not found",quiet:!0}),{status:404});throw e}):(console.debug("권한 없는 Supabase REST API 요청 차단:",c),Promise.resolve(new Response(JSON.stringify({message:"No API key found in request",hint:"No 'apikey' request header or url param was found."}),{status:401})))}}})}catch(a){return console.debug("Supabase 클라이언트 초기화 중 오류 발생 (무시됨)"),t=(0,l.kT)(e,s)}}},7074:(e,s,a)=>{Promise.resolve().then(a.bind(a,8736))},8736:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>d});var l=a(4568),t=a(7620),n=a(1525),r=a(2942),c=a(7261),i=a.n(c);function d(){var e;let[s,a]=(0,t.useState)(null),[c,d]=(0,t.useState)(null),[o,m]=(0,t.useState)(!0),[x,h]=(0,t.useState)(null),[u,p]=(0,t.useState)(!1),[g,f]=(0,t.useState)(null),[j,N]=(0,t.useState)(null),y=(0,r.useRouter)(),b=(0,n.U)();(0,t.useEffect)(()=>{(async()=>{try{m(!0);let{data:{user:e},error:s}=await b.auth.getUser();if(s)throw console.error("사용자 인증 에러:",s),s;if(e){console.log("인증된 사용자 정보:",e),a(e),f("loading");let{data:s,error:l}=await b.from("users").select("*").eq("id",e.id).single();if(l)console.error("사용자 프로필 조회 에러:",l),f("error"),"PGRST116"!==l.code&&h("DB 조회 에러: ".concat(l.message));else if(s){console.log("사용자 DB 프로필:",s),d(s),f("success");let{data:a,error:l}=await b.from("school_infos").select("*").eq("user_id",e.id).single();!l&&a&&N(a)}else f("error"),h("사용자 데이터를 찾을 수 없습니다. DB에 저장되지 않았을 수 있습니다.")}else y.push("/login")}catch(e){console.error("프로필 로딩 에러:",e),h(e.message||"사용자 정보를 불러오는 중 오류가 발생했습니다.")}finally{m(!1)}})()},[b,y]);let v=async()=>{try{let{error:e}=await b.auth.signOut();if(e)throw e;y.push("/")}catch(e){h(e.message||"로그아웃 중 오류가 발생했습니다")}},w=async()=>{if(confirm("정말로 계정을 삭제하시겠습니까? \n\n이 작업은 되돌릴 수 없으며, 모든 계정 데이터가 영구적으로 삭제됩니다."))try{p(!0),h(null),console.log("회원 탈퇴 시작..."),console.log("회원 탈퇴 API 호출");let e=await fetch("/api/delete-account",{method:"POST",headers:{"Content-Type":"application/json"}}),s=await e.json();if(console.log("API 응답:",s),!e.ok)throw Error(s.error||"계정 삭제 중 API 오류가 발생했습니다.");console.log("로그아웃 처리 시작...");let{error:a}=await b.auth.signOut();if(a)throw console.error("로그아웃 오류:",a),Error("로그아웃 오류: ".concat(a.message));alert("회원 탈퇴가 성공적으로 완료되었습니다."),y.push("/")}catch(e){console.error("계정 삭제 중 오류 발생:",e),h(e.message||"계정 삭제 중 오류가 발생했습니다.")}finally{p(!1)}};return o?(0,l.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"mb-4 h-12 w-12 animate-spin rounded-full border-4 border-indigo-600 border-t-transparent mx-auto"}),(0,l.jsx)("p",{className:"text-gray-600",children:"로딩 중..."})]})}):x?(0,l.jsx)("div",{className:"flex min-h-screen items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"w-full max-w-md rounded-lg bg-red-50 p-6 text-center",children:[(0,l.jsx)("p",{className:"text-red-700",children:x}),(0,l.jsx)("button",{onClick:()=>y.push("/"),className:"mt-4 rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:"홈으로 돌아가기"})]})}):(0,l.jsx)("div",{className:"flex min-h-screen flex-col p-4",children:(0,l.jsxs)("div",{className:"mx-auto w-full max-w-3xl space-y-8",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold",children:"내 프로필"}),(0,l.jsx)(i(),{href:"/",className:"rounded-md bg-gray-200 px-4 py-2 text-gray-700 hover:bg-gray-300",children:"홈으로"})]}),(0,l.jsxs)("div",{className:"rounded-lg bg-white p-6 shadow-md",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"사용자 정보"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"이메일"}),(0,l.jsx)("span",{className:"font-medium",children:(null==s?void 0:s.email)||"이메일 없음"})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"계정 제공자"}),(0,l.jsx)("span",{className:"font-medium capitalize",children:(null==s||null==(e=s.app_metadata)?void 0:e.provider)||"알 수 없음"})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"계정 생성일"}),(0,l.jsx)("span",{className:"font-medium",children:(null==s?void 0:s.created_at)?new Date(s.created_at).toLocaleString("ko-KR"):"알 수 없음"})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"계정 ID"}),(0,l.jsx)("span",{className:"font-mono text-xs text-gray-600",children:null==s?void 0:s.id})]})]})]}),(0,l.jsxs)("div",{className:"rounded-lg bg-white p-6 shadow-md",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"DB 사용자 데이터"}),"loading"===g&&(0,l.jsxs)("div",{className:"p-4 text-center",children:[(0,l.jsx)("div",{className:"inline-block h-6 w-6 animate-spin rounded-full border-2 border-indigo-600 border-t-transparent"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"데이터베이스 정보 가져오는 중..."})]}),"error"===g&&(0,l.jsxs)("div",{className:"p-4 bg-red-50 rounded-md text-red-700 text-sm",children:[(0,l.jsx)("p",{children:"데이터베이스에서 사용자 정보를 가져오는 중 오류가 발생했습니다."}),(0,l.jsx)("p",{children:"문제가 지속되면 관리자에게 문의하세요."})]}),"success"===g&&c&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(c).map(e=>{let[s,a]=e;return(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:s}),(0,l.jsx)("span",{className:"font-mono text-xs break-all",children:"object"==typeof a?JSON.stringify(a):String(a)})]},s)})}),(0,l.jsx)("div",{className:"mt-4 p-3 bg-green-50 rounded-md text-green-700 text-sm",children:(0,l.jsx)("p",{className:"font-semibold",children:"✔ 사용자 데이터가 Supabase DB에 성공적으로 저장되어 있습니다!"})})]}),"success"===g&&!c&&(0,l.jsx)("div",{className:"p-4 bg-yellow-50 rounded-md text-yellow-700 text-sm",children:(0,l.jsx)("p",{children:"데이터베이스에 사용자 정보가 없습니다. 트리거가 정상적으로 동작하지 않았을 수 있습니다."})})]}),(0,l.jsxs)("div",{className:"rounded-lg bg-white p-6 shadow-md",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-bold",children:"학교 정보"}),(0,l.jsx)(i(),{href:"/school-search",className:"rounded-md bg-green-600 px-3 py-1 text-sm text-white hover:bg-green-700",children:j?"학교 정보 수정":"학교 정보 설정"})]}),j?(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"학교명"}),(0,l.jsx)("span",{className:"font-medium",children:j.school_name})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"학교 유형"}),(0,l.jsx)("span",{className:"font-medium",children:j.school_type})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"지역"}),(0,l.jsx)("span",{className:"font-medium",children:j.region})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"주소"}),(0,l.jsx)("span",{className:"font-medium text-sm",children:j.address})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"학년"}),(0,l.jsxs)("span",{className:"font-medium",children:[j.grade,"학년"]})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"반"}),(0,l.jsxs)("span",{className:"font-medium",children:[j.class_number,"반"]})]})]})}):(0,l.jsxs)("div",{className:"p-4 bg-yellow-50 rounded-md",children:[(0,l.jsx)("p",{className:"text-yellow-700 text-sm",children:"아직 학교 정보가 업로드 되지 않았습니다."}),(0,l.jsx)(i(),{href:"/school-search",className:"mt-2 inline-block px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700",children:"학교 정보 설정하기"})]})]}),(0,l.jsxs)("div",{className:"rounded-lg bg-white p-6 shadow-md",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"계정 관리"}),(0,l.jsxs)("div",{className:"flex flex-col space-y-4 sm:flex-row sm:space-x-4 sm:space-y-0",children:[(0,l.jsx)("button",{onClick:v,className:"rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:"로그아웃"}),(0,l.jsx)("button",{onClick:w,disabled:u,className:"rounded-md bg-red-600 px-4 py-2 text-white hover:bg-red-700 disabled:opacity-50",children:u?"삭제 중...":"회원 탈퇴"})]}),u&&(0,l.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 rounded-md",children:(0,l.jsx)("p",{className:"text-yellow-700 text-sm",children:"회원 탈퇴 처리 중... 잠시만 기다려주세요."})})]})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[838,261,587,315,358],()=>s(7074)),_N_E=e.O()}]);