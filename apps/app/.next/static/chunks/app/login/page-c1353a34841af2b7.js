(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{1525:(e,s,t)=>{"use strict";t.d(s,{U:()=>r});var o=t(4175);let a=null,n=()=>!0,r=()=>{if(a)return a;if(!n())return console.debug("서버 환경에서 Supabase 클라이언트 호출 - 제한된 기능"),{auth:{getSession:()=>({data:{session:null}}),getUser:()=>({data:{user:null}}),signOut:()=>Promise.resolve({error:null})},from:()=>({select:()=>({eq:()=>({single:()=>Promise.resolve({data:null,error:null}),data:[],error:null})})})};let e="https://izkumvvlkrkgiuuczffp.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc";try{return a=(0,o.kT)(e,s,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",localStorage:n()?window.localStorage:void 0},global:{fetch:function(){for(var e,t,o,a=arguments.length,n=Array(a),r=0;r<a;r++)n[r]=arguments[r];let l=String(n[0]instanceof URL?n[0].toString():n[0]),c=["/meal_images","/profiles","/menu_item_ratings","/school_infos","/quiz","/comment_likes"].some(e=>l.includes(e)||l.includes("school_infos")||l.includes("/quiz"));if(l.includes("/rest/v1/")){let e=(null==(o=n[1])?void 0:o.headers)||{};n[1]={...n[1],headers:{...e,apikey:s,Authorization:"Bearer ".concat(s),Accept:"application/json"}}}return!l.includes("/rest/v1/")||c||(null==(e=n[1])?void 0:e.headers)&&Object.entries((null==(t=n[1])?void 0:t.headers)||{}).some(e=>{let[s,t]=e;return"apikey"===s.toLowerCase()||"authorization"===s.toLowerCase()})?l.includes("/comment_likes")?(n[1]||(n[1]={}),n[1].headers||(n[1].headers={}),n[1].headers.Accept="application/json",n[1].headers["Content-Type"]="application/json",fetch(...n).then(e=>200!==e.status?(console.debug("comment_likes 요청 응답 코드 ".concat(e.status," 수정 처리")),new Response(JSON.stringify({data:[]}),{status:200,headers:{"Content-Type":"application/json"}})):e).catch(e=>(console.debug("좋아요 요청 처리 오류 포착:",e),new Response(JSON.stringify({data:[]}),{status:200})))):fetch(...n).catch(e=>{if(404===e.status)return new Response(JSON.stringify({error:"Not found",quiet:!0}),{status:404});throw e}):(console.debug("권한 없는 Supabase REST API 요청 차단:",l),Promise.resolve(new Response(JSON.stringify({message:"No API key found in request",hint:"No 'apikey' request header or url param was found."}),{status:401})))}}})}catch(t){return console.debug("Supabase 클라이언트 초기화 중 오류 발생 (무시됨)"),a=(0,o.kT)(e,s)}}},3274:(e,s,t)=>{Promise.resolve().then(t.bind(t,4332))},4332:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var o=t(4568),a=t(7620),n=t(1525),r=t(2942),l=t(7261),c=t.n(l);function i(){let[e,s]=(0,a.useState)(!1),[t,l]=(0,a.useState)(null),i=(0,r.useRouter)(),u=(0,r.useSearchParams)(),d=(0,n.U)();(0,a.useEffect)(()=>{let e=u.get("error");"auth"===e?l("인증 오류가 발생했습니다. 다시 시도해주세요."):"server_error"===e&&l("서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요."),(async()=>{let{data:{session:e}}=await d.auth.getSession();e&&i.push("/")})()},[i,u,d]);let h=async()=>{try{s(!0),l(null),console.log("구글 로그인 시도 중...");let e=window.location.origin,t=e.includes("localhost")?"http://localhost:3001/auth/callback":"".concat(e,"/auth/callback");console.log("리디렉션 URL:",t),await d.auth.signOut(),Object.keys(localStorage).forEach(e=>{(e.includes("supabase")||e.includes("google")||e.includes("oauth"))&&localStorage.removeItem(e)});let o=Math.random().toString(36).substring(2,15),{data:a,error:n}=await d.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(t,"?state=").concat(o,"&t=").concat(Date.now()),skipBrowserRedirect:!1,queryParams:{access_type:"offline",prompt:"select_account consent",include_granted_scopes:"false"}}});if(n)throw console.error("구글 로그인 오류:",n),n;console.log("로그인 성공, 리다이렉트 완료:",a)}catch(e){console.error("로그인 시도 중 오류:",e),l(e.message||"구글 로그인 중 오류가 발생했습니다."),s(!1)}},g=async()=>{try{s(!0),l(null),console.log("카카오 로그인 시도 중...");let e=window.location.origin,t=e.includes("localhost")?"http://localhost:3001/auth/callback":"".concat(e,"/auth/callback");console.log("리디렉션 URL:",t),await d.auth.signOut(),Object.keys(localStorage).forEach(e=>{(e.includes("supabase")||e.includes("kakao")||e.includes("oauth"))&&localStorage.removeItem(e)});let o=Math.random().toString(36).substring(2,15),{data:a,error:n}=await d.auth.signInWithOAuth({provider:"kakao",options:{redirectTo:"".concat(t,"?state=").concat(o,"&t=").concat(Date.now()),skipBrowserRedirect:!1,queryParams:{prompt:"login consent",scope:"profile_nickname,profile_image,account_email"}}});if(n)throw console.error("카카오 로그인 오류:",n),n;console.log("로그인 성공, 리다이렉트 완료:",a)}catch(e){console.error("로그인 시도 중 오류:",e),l(e.message||"카카오 로그인 중 오류가 발생했습니다."),s(!1)}};return(0,o.jsx)("div",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:(0,o.jsxs)("div",{className:"w-full max-w-md space-y-8 rounded-lg bg-white p-6 shadow-md",children:[(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold",children:"급식배틀"}),(0,o.jsx)("p",{className:"mt-2 text-gray-600",children:"소셜 계정으로 로그인하세요"})]}),t&&(0,o.jsx)("div",{className:"rounded-md bg-red-50 p-4 text-sm text-red-700",children:t}),(0,o.jsxs)("div",{className:"mt-8 space-y-4",children:[(0,o.jsxs)("button",{onClick:h,disabled:e,className:"flex w-full items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:[(0,o.jsx)("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{d:"M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.254-3.138C18.189 1.186 15.479 0 12.24 0c-6.635 0-12 5.365-12 12s5.365 12 12 12c6.926 0 11.52-4.869 11.52-11.726 0-.788-.085-1.39-.189-1.989H12.24z",fill:"#4285F4"})}),e?"로그인 중...":"Google로 로그인"]}),(0,o.jsxs)("button",{onClick:g,disabled:e,className:"flex w-full items-center justify-center rounded-md border border-gray-300 bg-[#FEE500] px-4 py-2 text-gray-900 shadow-sm hover:bg-[#F3D900] focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 disabled:opacity-50",children:[(0,o.jsx)("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",fill:"none",children:(0,o.jsx)("path",{d:"M12 3C7.03125 3 3 6.03125 3 9.75C3 12.3125 4.71875 14.5312 7.21875 15.5625L6.46875 18.5625C6.40625 18.7812 6.625 18.9688 6.84375 18.8438L10.6562 16.2812C11.0938 16.3438 11.5312 16.375 12 16.375C16.9688 16.375 21 13.3438 21 9.625C21 5.90625 16.9688 3 12 3Z",fill:"black"})}),e?"로그인 중...":"카카오로 로그인"]}),(0,o.jsxs)("div",{className:"text-xs text-gray-500 mt-4 p-2 bg-gray-100 rounded",children:[(0,o.jsxs)("p",{children:["\uD83D\uDCA1 ",(0,o.jsx)("strong",{children:"알림:"})," 로그인 시 항상 2차 인증과 필수 정보 동의 화면을 보시려면:"]}),(0,o.jsxs)("ul",{className:"list-disc pl-5 mt-1",children:[(0,o.jsx)("li",{children:"브라우저의 개인정보 보호 모드(시크릿 창)에서 로그인을 시도해 보세요."}),(0,o.jsx)("li",{children:"또는 브라우저 설정에서 쿠키와 사이트 데이터를 삭제한 후 시도해 보세요."})]})]})]}),(0,o.jsx)("div",{className:"mt-4 text-center text-sm text-gray-600",children:(0,o.jsx)(c(),{href:"/",className:"text-indigo-600 hover:text-indigo-500",children:"홈으로 돌아가기"})})]})})}function u(){return(0,o.jsx)(a.Suspense,{fallback:(0,o.jsx)("div",{className:"p-4 text-center",children:"로딩 중..."}),children:(0,o.jsx)(i,{})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[838,261,587,315,358],()=>s(3274)),_N_E=e.O()}]);