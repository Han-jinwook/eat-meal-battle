(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{1525:(e,t,o)=>{"use strict";o.d(t,{$k:()=>i,UU:()=>l});var s=o(4175);let n=null,a=()=>!0,l=()=>{if(n)return n;if(!a())return console.debug("서버 환경에서 Supabase 클라이언트 호출 - 제한된 기능"),{auth:{getSession:()=>({data:{session:null}}),getUser:()=>({data:{user:null}}),signOut:()=>Promise.resolve({error:null}),signInWithOAuth:()=>Promise.resolve({data:null,error:Error("서버 환경에서는 OAuth 불가")})},from:()=>({select:()=>({eq:()=>({single:()=>Promise.resolve({data:null,error:null}),data:[],error:null})})})};let e="https://izkumvvlkrkgiuuczffp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc";try{return n=(0,s.kT)(e,t,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},cookies:{get(e){if("undefined"!=typeof document){var t;let o="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===o.length)return null==(t=o.pop())?void 0:t.split(";").shift()}},set(e,t,o){if("undefined"!=typeof document){let s="".concat(e,"=").concat(t);(null==o?void 0:o.maxAge)&&(s+="; max-age=".concat(o.maxAge)),(null==o?void 0:o.path)&&(s+="; path=".concat(o.path)),(null==o?void 0:o.domain)&&(s+="; domain=".concat(o.domain)),(null==o?void 0:o.secure)&&(s+="; secure"),(null==o?void 0:o.httpOnly)&&(s+="; httponly"),(null==o?void 0:o.sameSite)&&(s+="; samesite=".concat(o.sameSite)),document.cookie=s}},remove(e,t){if("undefined"!=typeof document){let o="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 GMT");(null==t?void 0:t.path)&&(o+="; path=".concat(t.path)),(null==t?void 0:t.domain)&&(o+="; domain=".concat(t.domain)),document.cookie=o}}},global:{fetch:function(){for(var e,o,s,n=arguments.length,a=Array(n),l=0;l<n;l++)a[l]=arguments[l];let r=String(a[0]instanceof URL?a[0].toString():a[0]),i=["/meal_images","/profiles","/menu_item_ratings","/school_infos","/quiz","/comment_likes"].some(e=>r.includes(e)||r.includes("school_infos")||r.includes("/quiz"));if(r.includes("/rest/v1/")){let e=(null==(s=a[1])?void 0:s.headers)||{};a[1]={...a[1],headers:{...e,apikey:t,Authorization:"Bearer ".concat(t),Accept:"application/json"}}}return!r.includes("/rest/v1/")||i||(null==(e=a[1])?void 0:e.headers)&&Object.entries((null==(o=a[1])?void 0:o.headers)||{}).some(e=>{let[t,o]=e;return"apikey"===t.toLowerCase()||"authorization"===t.toLowerCase()})?r.includes("/comment_likes")?(a[1]||(a[1]={}),a[1].headers||(a[1].headers={}),a[1].headers.Accept="application/json",a[1].headers["Content-Type"]="application/json",fetch(...a).then(e=>200!==e.status?(console.debug("comment_likes 요청 응답 코드 ".concat(e.status," 수정 처리")),new Response(JSON.stringify({data:[]}),{status:200,headers:{"Content-Type":"application/json"}})):e).catch(e=>(console.debug("좋아요 요청 처리 오류 포착:",e),new Response(JSON.stringify({data:[]}),{status:200})))):fetch(...a).catch(e=>{if(404===e.status)return new Response(JSON.stringify({error:"Not found",quiet:!0}),{status:404});throw e}):(console.debug("권한 없는 Supabase REST API 요청 차단:",r),Promise.resolve(new Response(JSON.stringify({message:"No API key found in request",hint:"No 'apikey' request header or url param was found."}),{status:401})))}}})}catch(o){return console.debug("Supabase 클라이언트 초기화 중 오류 발생 (무시됨)"),n=(0,s.kT)(e,t)}},r=async()=>{try{let e=l();await e.auth.signOut();{let e=[];for(let t=0;t<localStorage.length;t++){let o=localStorage.key(t);o&&(o.startsWith("sb-")||o.includes("supabase"))&&e.push(o)}e.forEach(e=>localStorage.removeItem(e)),sessionStorage.clear(),document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+new Date().toUTCString()+";path=/")})}n=null,console.debug("세션 완전 정리 완료")}catch(e){console.debug("세션 정리 중 오류 (무시됨):",e)}},i=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,o=l();console.log("\uD83D\uDD0D 로그인 시도 환경 정보:",{url:"https://izkumvvlkrkgiuuczffp.supabase.co",provider:e,userAgent:navigator.userAgent,cookiesEnabled:navigator.cookieEnabled,localStorage:"undefined"!=typeof localStorage,currentUrl:window.location.href});for(let s=1;s<=t;s++)try{console.log("\uD83D\uDE80 로그인 시도 ".concat(s,"/").concat(t," 시작")),s>1&&(console.log("\uD83E\uDDF9 이전 세션 정리 중..."),await r(),await new Promise(e=>setTimeout(e,1e3)));let{data:n}=await o.auth.getSession();console.log("\uD83D\uDCCA 현재 세션 상태:",n.session?"있음":"없음");let{data:a,error:l}=await o.auth.signInWithOAuth({provider:e,options:{redirectTo:"".concat(window.location.origin,"/auth/callback"),queryParams:{access_type:"offline",prompt:"consent"}}});if(console.log("✅ OAuth 요청 결과:",{data:a,error:l}),l)throw l;return{data:a,error:null}}catch(o){if(console.error("❌ 로그인 시도 ".concat(s,"/").concat(t," 실패:"),{error:o,errorMessage:null==o?void 0:o.message,errorCode:null==o?void 0:o.status,timestamp:new Date().toISOString()}),s===t)return{data:null,error:o};let e=1e3*Math.pow(2,s);console.log("⏳ ".concat(e,"ms 대기 후 재시도...")),await new Promise(t=>setTimeout(t,e))}}},3274:(e,t,o)=>{Promise.resolve().then(o.bind(o,4332))},4332:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>u});var s=o(4568),n=o(7620),a=o(1525),l=o(2942),r=o(7261),i=o.n(r);function c(){let[e,t]=(0,n.useState)(!1),[o,r]=(0,n.useState)(null),c=(0,l.useRouter)(),u=(0,l.useSearchParams)(),d=(0,a.UU)();(0,n.useEffect)(()=>{let e=u.get("error");"auth"===e?r("인증 오류가 발생했습니다. 다시 시도해주세요."):"server_error"===e&&r("서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요."),(async()=>{try{let{data:{session:e}}=await d.auth.getSession();console.log("현재 세션 상태:",e?"로그인됨":"로그인되지 않음"),e&&c.push("/")}catch(e){console.error("세션 확인 중 오류:",e)}})()},[c,u,d]);let h=async()=>{try{t(!0),r(null),console.log("구글 로그인 시도 중...");let{data:e,error:o}=await (0,a.$k)("google");if(o)throw console.error("구글 로그인 오류:",o),o;console.log("로그인 성공, 리다이렉트 완료:",e)}catch(e){console.error("로그인 시도 중 오류:",e),r(e.message||"구글 로그인 중 오류가 발생했습니다."),t(!1)}},m=async()=>{try{t(!0),r(null),console.log("카카오 로그인 시도 중...");let e=window.location.origin,o="".concat(e,"/auth/callback");console.log("현재 도메인:",e),console.log("카카오 리디렉션 URL:",o);let{data:s,error:n}=await d.auth.signInWithOAuth({provider:"kakao",options:{redirectTo:o,queryParams:{scope:"profile_nickname,profile_image,account_email"}}});if(n)throw console.error("카카오 로그인 오류:",n),n;console.log("로그인 성공, 리다이렉트 완료:",s)}catch(e){console.error("로그인 시도 중 오류:",e),r(e.message||"카카오 로그인 중 오류가 발생했습니다."),t(!1)}};return(0,s.jsx)("div",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-md space-y-8 rounded-lg bg-white p-6 shadow-md",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"급식배틀"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"소셜 계정으로 로그인하세요"})]}),o&&(0,s.jsx)("div",{className:"rounded-md bg-red-50 p-4 text-sm text-red-700",children:o}),(0,s.jsxs)("div",{className:"mt-8 space-y-4",children:[(0,s.jsxs)("button",{onClick:h,disabled:e,className:"flex w-full items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:[(0,s.jsx)("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12.24 10.285V14.4h6.806c-.275 1.765-2.056 5.174-6.806 5.174-4.095 0-7.439-3.389-7.439-7.574s3.345-7.574 7.439-7.574c2.33 0 3.891.989 4.785 1.849l3.254-3.138C18.189 1.186 15.479 0 12.24 0c-6.635 0-12 5.365-12 12s5.365 12 12 12c6.926 0 11.52-4.869 11.52-11.726 0-.788-.085-1.39-.189-1.989H12.24z",fill:"#4285F4"})}),e?"로그인 중...":"Google로 로그인"]}),(0,s.jsxs)("button",{onClick:m,disabled:e,className:"flex w-full items-center justify-center rounded-md border border-gray-300 bg-[#FEE500] px-4 py-2 text-gray-900 shadow-sm hover:bg-[#F3D900] focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 disabled:opacity-50",children:[(0,s.jsx)("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 3C7.03125 3 3 6.03125 3 9.75C3 12.3125 4.71875 14.5312 7.21875 15.5625L6.46875 18.5625C6.40625 18.7812 6.625 18.9688 6.84375 18.8438L10.6562 16.2812C11.0938 16.3438 11.5312 16.375 12 16.375C16.9688 16.375 21 13.3438 21 9.625C21 5.90625 16.9688 3 12 3Z",fill:"black"})}),e?"로그인 중...":"카카오로 로그인"]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-4 p-2 bg-gray-100 rounded",children:[(0,s.jsxs)("p",{children:[" ",(0,s.jsx)("strong",{children:"알림:"})," 로그인 시 항상 2차 인증과 필수 정보 동의 화면을 보시려면:"]}),(0,s.jsxs)("ul",{className:"list-disc pl-5 mt-1",children:[(0,s.jsx)("li",{children:"브라우저의 개인정보 보호 모드(시크릿 창)에서 로그인을 시도해 보세요."}),(0,s.jsx)("li",{children:"또는 브라우저 설정에서 쿠키와 사이트 데이터를 삭제한 후 시도해 보세요."})]})]})]}),(0,s.jsx)("div",{className:"mt-4 text-center text-sm text-gray-600",children:(0,s.jsx)(i(),{href:"/",className:"text-indigo-600 hover:text-indigo-500",children:"홈으로 돌아가기"})})]})})}function u(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)("div",{className:"p-4 text-center",children:"로딩 중..."}),children:(0,s.jsx)(c,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[838,261,587,315,358],()=>t(3274)),_N_E=e.O()}]);