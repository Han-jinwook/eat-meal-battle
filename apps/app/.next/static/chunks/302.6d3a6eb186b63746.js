(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{3522:()=>{},4275:(e,t,s)=>{"use strict";e.exports=s(8650).style},4302:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>_});var r=s(4568),n=s(4275),a=s.n(n),o=s(7620),l=s(2942),i=s(8670),c=s(6202),d=s(4175),u=s(5317);let h=(0,d.kT)("https://izkumvvlkrkgiuuczffp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc"),m=e=>{let{currentQuizDate:t,onDateSelect:s,onRefreshNeeded:n}=e,[a,l]=(0,o.useState)(new Date(2025,5,1)),[i,d]=(0,o.useState)([]),[u,m]=(0,o.useState)([]),[x,g]=(0,o.useState)(!1),[p,_]=(0,o.useState)(!0),[f,y]=(0,o.useState)({}),[b,j]=(0,o.useState)({correct:0,total:0}),[v,w]=(0,o.useState)({correct:0,total:0,month:0}),{userSchool:S}=(0,c.A)();(0,o.useEffect)(()=>{let e=a.getFullYear(),t={};2025===e&&(t["2025-01-01"]="신정",t["2025-01-28"]="설날연휴",t["2025-01-29"]="설날",t["2025-01-30"]="설날연휴",t["2025-03-01"]="삼일절",t["2025-05-05"]="어린이날",t["2025-05-06"]="대체공휴일",t["2025-06-06"]="현충일",t["2025-08-15"]="광복절",t["2025-09-16"]="추석연휴",t["2025-09-17"]="추석",t["2025-09-18"]="추석연휴",t["2025-10-03"]="개천절",t["2025-10-09"]="한글날",t["2025-12-25"]="크리스마스"),y(t)},[a]);let N=async(e,t)=>{if(S){_(!0);try{let s=await h.auth.getSession();if(!s.data.session)return;let r=new Date(e,t,1),n=new Date(e,t+1,0),a=e=>{let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(r)};console.log("퀴즈 결과 조회 범위:",{시작일:a(r),종료일:a(n)});let{data:o,error:l}=await h.from("quiz_results").select("\n          quiz_id,\n          selected_option,\n          is_correct,\n          meal_quizzes!inner(meal_date)\n        ").eq("user_id",s.data.session.user.id).gte("meal_quizzes.meal_date",a(r)).lte("meal_quizzes.meal_date",a(n));if(l)return void console.error("퀴즈 결과 조회 오류:",l);console.log("조회된 퀴즈 결과:",o);let i=[],c=new Date(r);for(;c<=n;){let e=a(c),t=null==o?void 0:o.find(t=>t.meal_quizzes.meal_date===e);i.push({date:e,is_correct:(null==t?void 0:t.is_correct)||!1,has_quiz:!!t}),c.setDate(c.getDate()+1)}console.log("처리된 퀴즈 결과:",i),d(i);let u=D(i,e,t);m(u)}catch(e){console.error("데이터 조회 오류:",e)}finally{_(!1)}}},D=(e,t,s)=>{let r=[],n=new Date(t,s,1),a=new Date(t,s+1,0),o=1,l=new Date(n),i=l.getDay();for(l.setDate(l.getDate()-(0===i?6:i-1));l<=a;){let t=new Date(l);t.setDate(t.getDate()+6);let n=0,a=0;for(let r=new Date(l);r<=t;r.setDate(r.getDate()+1)){let t=r.getDay();if(t>=1&&t<=5&&r.getMonth()===s){let t="".concat(r.getFullYear(),"-").concat(String(r.getMonth()+1).padStart(2,"0"),"-").concat(String(r.getDate()).padStart(2,"0")),s=e.find(e=>e.date===t);s&&s.has_quiz&&(a++,s.is_correct&&n++)}}if(r.push({week:o,earned:a>=3&&n===a,total_correct:n,total_available:a}),o++,l.setDate(l.getDate()+7),o>6)break}return r},z=async(e,t)=>{try{let s=await h.auth.getSession();if(!s.data.session||!S)return;let r=new Date;r.getFullYear(),r.getMonth();let n=t+1,a=h.from("quiz_champions").select("correct_count, total_count").eq("user_id",s.data.session.user.id).eq("year",e).eq("month",n),{data:o,error:l}=await a.single();if(l||!o){console.log("월별 통계 데이터 없음:",e,n),j({correct:0,total:0});return}j({correct:o.correct_count,total:o.total_count})}catch(e){console.error("월별 통계 조회 오류:",e),j({correct:0,total:0})}},C=async(e,t)=>{try{let s=await h.auth.getSession();if(!s.data.session||!S)return;let r=t+1,{data:n,error:a}=await h.from("quiz_champions").select("correct_count, total_count").eq("user_id",s.data.session.user.id).eq("year",e).eq("month",r).single();if(a||!n){console.log("이전 월별 통계 데이터 없음:",e,r),w({correct:0,total:0,month:r});return}w({correct:n.correct_count,total:n.total_count,month:r})}catch(e){console.error("이전 월별 통계 조회 오류:",e),w({correct:0,total:0,month:t+1})}};(0,o.useEffect)(()=>{if(S){let e=a.getFullYear(),t=a.getMonth();console.log("데이터 조회 시작:",{현재년월:"".concat(e,"-").concat(t+1),이전년월:"".concat(0===t?e-1:e,"-").concat(0===t?12:t)}),N(e,t),z(e,t);let s=0===t?11:t-1;C(0===t?e-1:e,s)}},[a,S]),(0,o.useEffect)(()=>{if(t){let e=new Date(t);if(!isNaN(e.getTime())){let s=new Date(e.getFullYear(),e.getMonth(),1);s.getTime()!==a.getTime()&&(console.log("\uD83D\uDD04 위쪽 날짜 선택에 따른 현황판 월 자동 변경:",{이전월:"".concat(a.getFullYear(),"-").concat(a.getMonth()+1),새월:"".concat(s.getFullYear(),"-").concat(s.getMonth()+1),선택날짜:t}),l(s))}}},[t]);let I=()=>{let e=a.getFullYear(),t=a.getMonth();console.log("\uD83D\uDD04 캘린더 데이터 새로고침:",{year:e,month:t+1}),N(e,t),z(e,t);let s=0===t?11:t-1;C(0===t?e-1:e,s)};(0,o.useEffect)(()=>(n&&(window.refreshQuizCalendar=I),()=>{window.refreshQuizCalendar&&delete window.refreshQuizCalendar}),[n,a]);let F=e=>{if(console.log("\uD83D\uDCC5 날짜 클릭:",{날짜:e.dateStr,현재월여부:e.isCurrentMonth,퀴즈여부:e.hasQuiz}),!e.isCurrentMonth){let t=new Date(e.dateStr),s=new Date(t.getFullYear(),t.getMonth(),1);console.log("\uD83D\uDD04 월 변경:",{이전월:"".concat(a.getFullYear(),"-").concat(a.getMonth()+1),새월:"".concat(s.getFullYear(),"-").concat(s.getMonth()+1)}),l(s)}s&&(console.log("\uD83D\uDCCD 날짜 선택:",e.dateStr),s(e.dateStr))},k=(()=>{let e=a.getFullYear(),s=a.getMonth(),r=new Date(e,s,1),n=new Date,o=new Date(r),l=r.getDay();o.setDate(r.getDate()-l);let c=[],d=new Date(o);for(let e=0;e<42;e++){let e="".concat(d.getFullYear(),"-").concat(String(d.getMonth()+1).padStart(2,"0"),"-").concat(String(d.getDate()).padStart(2,"0")),r=i.find(t=>t.date===e);c.push({day:d.getDate(),dateStr:e,isCurrentMonth:d.getMonth()===s,isToday:d.toDateString()===n.toDateString(),isSelected:e===t,hasQuiz:(null==r?void 0:r.has_quiz)||!1,isCorrect:(null==r?void 0:r.is_correct)||!1,isHoliday:!!f[e]}),d.setDate(d.getDate()+1)}return c})();return p?(0,r.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-6",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("div",{className:"border-4 border-black rounded-lg py-3 px-6 mb-4 inline-block",children:(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 tracking-wide",children:"급식퀴즈 챌린지"})}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-8",children:[(0,r.jsx)("button",{onClick:()=>{l(new Date(a.getFullYear(),a.getMonth()-1,1))},className:"p-2 rounded-lg hover:bg-gray-100 transition-colors text-2xl font-bold text-gray-600",children:"‹"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-green-600",children:["( ",b.correct,"/",b.total,"개 맞음 )"]}),(0,r.jsxs)("div",{className:"text-xl font-bold text-blue-700",children:[a.getMonth()+1,"월"]}),(0,r.jsx)("div",{className:"w-8 h-8 flex items-center justify-center",children:b.total>0&&b.correct===b.total&&(0,r.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFC6"})}),(0,r.jsx)("button",{onClick:()=>{l(new Date(a.getFullYear(),a.getMonth()+1,1))},className:"p-2 rounded-lg hover:bg-gray-100 transition-colors text-2xl font-bold text-gray-600",children:"›"})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-9",style:{gridTemplateColumns:"0.5fr 1fr 1fr 1fr 1fr 1fr 0.5fr 1fr"},children:["일","월","화","수","목","금","토","주장원"].map((e,t)=>(0,r.jsx)("div",{className:"text-center py-2 text-sm font-semibold ".concat(0===t||6===t?"text-red-500 text-xs":"text-gray-700"),children:e},e))}),(0,r.jsx)("div",{className:"grid gap-1",style:{gridTemplateColumns:"0.5fr 1fr 1fr 1fr 1fr 1fr 0.5fr 1fr"},children:Array.from({length:8*Math.ceil(k.length/7)},(e,t)=>{let s=7*Math.floor(t/8)+t%8,n=Math.floor(t/8);if(t%8==7){let e=u[n];return(0,r.jsx)("div",{className:"h-16 border border-yellow-300 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg flex items-center justify-center",children:(null==e?void 0:e.earned)&&(0,r.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFC6"})},"trophy-".concat(n))}if(s>=k.length)return(0,r.jsx)("div",{className:"h-16"},"empty-".concat(t));let a=k[s],o=s%7==0||s%7==6,l=["h-16 rounded-lg flex flex-col relative transition-all duration-200"];return a.isCurrentMonth?o?l.push("border border-red-300 text-red-600"):l.push("border-2 border-gray-500"):l.push("bg-gradient-to-br from-gray-50/80 to-gray-100/60","backdrop-blur-[0.5px]"),a.isToday&&a.isCurrentMonth&&l.push("ring-2 ring-blue-500 bg-blue-100 font-bold"),a.isSelected&&l.push("ring-2 ring-purple-500 bg-purple-100"),a.isCurrentMonth?l.push("cursor-pointer","hover:shadow-md hover:scale-[1.05]","hover:bg-white/90","transition-all duration-300 ease-out"):l.push("cursor-pointer","hover:shadow-sm hover:scale-[1.02]","hover:bg-gray-200/40 hover:backdrop-blur-sm","transition-all duration-200 ease-in-out"),a.hasQuiz&&a.isCurrentMonth&&l.push("hover:shadow-lg hover:scale-110"),a.isHoliday&&a.isCurrentMonth&&l.push("bg-pink-50 border-0"),(0,r.jsxs)("div",{className:l.join(" "),onClick:()=>F(a),children:[(0,r.jsx)("span",{className:"absolute top-1 left-1 font-medium ".concat("text-xs"," ").concat(a.isToday?"text-blue-700 font-bold":a.isSelected?"text-purple-700 font-semibold":a.isCurrentMonth?"text-gray-700 font-medium":"text-gray-500/80 font-normal"),children:a.day}),a.isHoliday&&a.isCurrentMonth&&(0,r.jsx)("div",{className:"flex items-center justify-center h-full w-full",children:(0,r.jsx)("div",{className:"text-xs text-red-500 font-bold",children:"공휴일"})}),a.hasQuiz&&a.isCurrentMonth&&(0,r.jsx)("div",{className:"flex items-center justify-center",children:a.isCorrect?(0,r.jsx)("span",{className:"text-blue-600 font-black text-3xl transform rotate-12 drop-shadow-sm",children:"✓"}):(0,r.jsx)("span",{className:"text-red-600 font-black text-3xl transform -rotate-12 drop-shadow-sm",children:"✕"})})]},"".concat(a.dateStr,"-").concat(s))})})]})},x=(0,d.kT)("https://izkumvvlkrkgiuuczffp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc"),g=e=>{let{currentMonth:t=new Date}=e,[s,n]=(0,o.useState)([]),[a,l]=(0,o.useState)(!0),[i,d]=(0,o.useState)(!1),{userSchool:u}=(0,c.A)(),h=(0,o.useCallback)(async()=>{if(!(null==u?void 0:u.school_code))return void console.log("❌ API 호출 차단: userSchool 정보 없음");if(i)return void console.log("❌ API 호출 차단: 이미 호출 중");console.log("\uD83D\uDD04 장원 통계 API 호출 시작:",{school:u.school_code}),d(!0),l(!0);try{let e=await x.auth.getSession();if(!e.data.session)return void console.log("❌ 세션 정보 없음");let s=e.data.session.user.id,r=[1,2,3,4].map(async e=>{try{let r=new URLSearchParams({user_id:s,school_code:u.school_code,year:t.getFullYear().toString(),month:(t.getMonth()+1).toString(),week_number:e.toString(),period_type:"weekly"}),n="/api/champion/calculate?".concat(r.toString());console.log("\uD83D\uDD0D 주 ".concat(e," API 요청:"),n);let a=await fetch(n);if(!a.ok)return console.warn("주 ".concat(e," API 응답 실패:"),a.status),{week:e,is_champion:!1,total_meal_days:0,correct_count:0};let o=await a.json();console.log("\uD83D\uDD0D 주 ".concat(e," API 응답:"),o);let l=(null==o?void 0:o.data)||{};return{week:e,is_champion:!!(null==l?void 0:l.is_champion),total_meal_days:Number(null==l?void 0:l.total_meal_days)||0,correct_count:Number(null==l?void 0:l.correct_count)||0}}catch(t){return console.warn("주 ".concat(e," 통계 조회 예외:"),t),{week:e,is_champion:!1,error:!0}}}),a=(async()=>{let e=new URLSearchParams({user_id:s,school_code:u.school_code,year:t.getFullYear().toString(),month:(t.getMonth()+1).toString(),period_type:"monthly"}),r="/api/champion/calculate?".concat(e.toString());console.log("\uD83D\uDD0D 월별 API 요청:",r);try{let e=await fetch(r);if(!e.ok)return console.warn("월별 API 응답 실패:",e.status),{is_champion:!1,total_meal_days:0,correct_count:0};let t=await e.json();console.log("\uD83D\uDD0D 월별 API 응답:",t);let s=(null==t?void 0:t.data)||{};return{is_champion:!!(null==s?void 0:s.is_champion),total_meal_days:Number(null==s?void 0:s.total_meal_days)||0,correct_count:Number(null==s?void 0:s.correct_count)||0}}catch(e){return console.warn("월별 통계 조회 예외:",e),{is_champion:!1,error:!0}}})(),[o,l]=await Promise.all([Promise.all(r),a]);console.log("\uD83D\uDCCA 주별 통계 결과:",o),console.log("\uD83D\uDCCA 월별 통계 결과:",l);let i=o.map(e=>({period_type:"weekly",period_label:"".concat(t.getFullYear(),"년 ").concat(t.getMonth()+1,"월 ").concat(e.week,"주"),my_record:e.is_champion?"주장원":"pass",me_count:+!!e.is_champion,class_count:0,grade_count:0,school_count:0,total_meal_days:e.total_meal_days||0,total_students:0})),c={period_type:"monthly",period_label:"".concat(t.getFullYear(),"년 ").concat(t.getMonth()+1,"월"),my_record:l.is_champion?"월장원":"pass",me_count:+!!l.is_champion,class_count:0,grade_count:0,school_count:0,total_meal_days:l.total_meal_days||0,total_students:0};n([...i,c])}catch(e){console.error("장원 통계 조회 오류:",e),n([])}finally{d(!1),l(!1),console.log("✅ 장원 통계 API 호출 완료")}},[t.getFullYear(),t.getMonth(),null==u?void 0:u.school_code]);return((0,o.useEffect)(()=>{(null==u?void 0:u.school_code)&&h()},[h]),a)?(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-6 mt-6",children:(0,r.jsxs)("div",{className:"flex justify-center items-center py-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,r.jsx)("span",{className:"ml-2 text-gray-600",children:"장원 히스토리 로딩중..."})]})}):0===s.length?(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-6 mt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-center mb-4 border-2 border-black rounded-lg py-2",children:"급식장원 History"}),(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDD0D"}),(0,r.jsx)("p",{children:"장원 데이터를 불러오는 중 문제가 발생했습니다."}),(0,r.jsxs)("p",{className:"text-sm",children:["API 응답: ",s.length,"개 항목"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:[t.getFullYear(),"년 ",t.getMonth()+1,"월 데이터 조회 중..."]})]})]}):(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-6 mt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-center mb-4 border-2 border-black rounded-lg py-2",children:"급식장원 History"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50",children:[(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-sm font-semibold",children:"월/주차"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-sm font-semibold",children:"나의 기록"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-sm font-semibold",children:"반"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-sm font-semibold",children:"학년"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-sm font-semibold",children:"학교"})]})}),(0,r.jsxs)("tbody",{children:[s.map((e,s)=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center",children:e.period_label.replace("".concat(t.getFullYear(),"년 "),"")}),(0,r.jsxs)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center",children:["주장원"===e.my_record&&(0,r.jsx)("span",{className:"text-yellow-600 font-bold",children:"\uD83C\uDFC6 주장원"}),"월장원"===e.my_record&&(0,r.jsx)("span",{className:"text-purple-600 font-bold",children:"\uD83D\uDC51 월장원"}),"pass"===e.my_record&&(0,r.jsx)("span",{className:"text-gray-500",children:"pass"})]}),(0,r.jsxs)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-gray-500",children:[e.class_count,"명 / ",e.total_students||0]}),(0,r.jsxs)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-gray-500",children:[e.grade_count,"명 / ",e.total_students||0]}),(0,r.jsxs)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-gray-500",children:[e.school_count,"명 / ",e.total_students||0]})]},s)),Array.from({length:Math.max(0,5-s.length)},(e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-gray-300",children:"-"}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-gray-300",children:"-"}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-gray-300",children:"-"}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-gray-300",children:"-"}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-gray-300",children:"-"})]},"empty-".concat(t)))]})]})}),(0,r.jsxs)("div",{className:"mt-4 text-xs text-gray-500 text-center",children:[(0,r.jsx)("p",{children:"\uD83C\uDFC6 주장원: 해당 주 급식일수만큼 모두 정답 | \uD83D\uDC51 월장원: 해당 월 급식일수만큼 모두 정답"}),(0,r.jsx)("p",{children:"* 반/학년/학교 통계는 추후 업데이트 예정"})]})]})};var p=s(1653);function _(){let e="\n    .quiz-container {\n      max-width: 800px;\n      margin: 0 auto;\n    }\n  ",t=(0,l.useRouter)(),s=(0,l.useSearchParams)(),[n,h]=(0,o.useState)((0,i.AV)()),[x,_]=(0,o.useState)(null),[f,y]=(0,o.useState)(!0),[b,j]=(0,o.useState)(null),[v,w]=(0,o.useState)(null),[S,N]=(0,o.useState)(!1),[D,z]=(0,o.useState)(!1),[C,I]=(0,o.useState)(!1),[F,k]=(0,o.useState)(""),{userSchool:M,loading:A,error:R}=(0,c.A)(),O=(0,d.kT)("https://izkumvvlkrkgiuuczffp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc");(0,o.useEffect)(()=>{try{let e=null==s?void 0:s.get("date");if(e&&"string"==typeof e)if(/^\d{4}-\d{2}-\d{2}$/.test(e)||/^\d{8}$/.test(e))try{if(e.includes("-")){let t=e.split("-");if(3===t.length){let s=parseInt(t[0],10),r=parseInt(t[1],10)-1,n=parseInt(t[2],10),a=new Date(s,r,n);if(!isNaN(a.getTime())&&a.getFullYear()===s&&a.getMonth()===r&&a.getDate()===n)return void h(e)}}else if(8===e.length){let t=parseInt(e.substring(0,4),10),s=parseInt(e.substring(4,6),10)-1,r=parseInt(e.substring(6,8),10),n=new Date(t,s,r);if(!isNaN(n.getTime())&&n.getFullYear()===t&&n.getMonth()===s&&n.getDate()===r)return void h(e)}console.warn("유효하지 않은 날짜 값:",e),h((0,i.AV)())}catch(e){console.error("날짜 유효성 검사 오류:",e),h((0,i.AV)())}else console.warn("유효하지 않은 날짜 형식:",e),h((0,i.AV)());else h((0,i.AV)())}catch(e){console.error("URL 파라미터 처리 오류:",e),h((0,i.AV)())}},[s]);let q=async()=>{if(M&&n){y(!0),j(null);try{let e=await O.auth.getSession();if(!e.data.session){j("로그인이 필요합니다."),y(!1);return}let t=new URLSearchParams;if(t.set("school_code",M.school_code),M.grade?t.set("grade",M.grade.toString()):t.set("grade","1"),n)t.set("date",n);else throw Error("날짜가 선택되지 않았습니다");let s=await fetch("/.netlify/functions/quiz?".concat(t.toString()),{headers:{Authorization:"Bearer ".concat(e.data.session.access_token)}}),r=await s.json();s.ok?r.noMenu?(_(null),I(!0),k(r.message||"해당 날짜에 급식 정보가 없습니다."),j(null)):(_(r.quiz),r.alreadyAnswered&&void 0!==r.selectedOption?(w(Number(r.selectedOption)),N(!0),r.quiz&&_({...r.quiz,user_answer:{selected_option:r.selectedOption,is_correct:r.isCorrect}})):(w(null),N(!1))):"Quiz not found"===r.error?(_(null),j(null)):j(r.error||"퀴즈를 불러오는데 실패했습니다.")}catch(e){console.error("퀴즈 로드 오류:",e),j("퀴즈를 불러오는데 실패했습니다.")}finally{D||y(!1)}}},J=async()=>{if(x&&null!==v)try{console.log("\uD83D\uDD0D Quiz 상태 확인:",{quiz:x,quiz_id:null==x?void 0:x.id,selectedOption:v,quiz_exists:!!x});let e=await O.auth.getSession();if(!e.data.session)return void u.oR.error("로그인이 필요합니다.");let t=Math.floor(Date.now()/1e3),s={quiz_id:x.id,selected_option:v,answer_time:t};console.log("\uD83D\uDCE4 전송할 데이터:",s),console.log("\uD83D\uDCE4 JSON 문자열:",JSON.stringify(s));let r=await fetch("/.netlify/functions/quiz/answer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.data.session.access_token)},body:JSON.stringify(s)}),n=await r.json();console.log("\uD83D\uDCE5 서버 응답:",n),r.ok&&n.success?(N(!0),_(e=>e?{...e,correct_answer:n.correctAnswer,explanation:n.explanation,user_answer:{selected_option:v,is_correct:n.isCorrect}}:null),console.log("✅ 퀴즈 상태 업데이트 완료:",{isCorrect:n.isCorrect,correctAnswer:n.correctAnswer,selectedOption:v}),"function"==typeof window.refreshQuizCalendar&&(console.log("\uD83D\uDD04 캘린더 새로고침 호출"),window.refreshQuizCalendar())):(console.error("❌ 서버 응답 오류:",n),"이미 답변한 퀴즈입니다."!==n.error&&u.oR.error(n.error||"답안 제출에 실패했습니다."))}catch(e){console.error("답안 제출 오류:",e),u.oR.error("답안 제출에 실패했습니다.")}},T=async()=>{if(M&&n){z(!0),j(null);try{let e=await O.auth.getSession();if(!e.data.session){j("로그인이 필요합니다."),z(!1);return}let t=await fetch("/.netlify/functions/quiz",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.data.session.access_token)},body:JSON.stringify({school_code:M.school_code,grade:M.grade,date:n,action:"generate"})}),s=await t.json();t.ok?s.noMenu?(I(!0),k(s.message||"해당 날짜에 급식 정보가 없습니다."),_(null)):await q():(console.error("퀴즈 생성 실패:",s),j(s.error||"퀴즈 생성에 실패했습니다."))}catch(e){console.error("퀴즈 생성 오류:",e),j("퀴즈 생성에 실패했습니다.")}finally{z(!1)}}};return(0,o.useEffect)(()=>{n&&M&&!A&&(I(!1),k(""),z(!1),_(null),w(null),N(!1),q())},[n,M,A]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a(),{id:e.__hash,children:e}),(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" max-w-4xl mx-auto",children:[M?(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" bg-gradient-to-r from-blue-50 to-indigo-50 shadow-sm rounded p-2 mb-3 border-l-2 border-blue-500 flex items-center",children:[(0,r.jsx)("span",{className:"jsx-".concat(e.__hash)+" text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 text-base font-semibold",children:M.school_name}),(M.grade||M.class)&&(0,r.jsxs)("span",{className:"jsx-".concat(e.__hash)+" ml-2 text-gray-600 text-xs bg-white px-1.5 py-0.5 rounded-full",children:[M.grade?"".concat(M.grade,"학년"):"",M.class?" ".concat(M.class,"반"):""]})]}):(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" mb-6"}),(0,r.jsx)(p.A,{selectedDate:n,onDateChange:e=>{if(e&&"string"==typeof e){h(e);let t=new URLSearchParams(window.location.search);t.set("date",e);let s="".concat(window.location.pathname,"?").concat(t.toString());window.history.replaceState({},"",s)}}}),(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" mt-6 bg-white rounded-lg shadow-sm p-6",children:f?(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" text-center py-10",children:[(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-blue-400 border-r-transparent"}),(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" mt-4 text-gray-600",children:"퀴즈를 불러오는 중..."})]}):b?(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" text-center py-10",children:[(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" text-red-600 mb-4",children:b}),(0,r.jsx)("button",{onClick:T,disabled:D,className:"jsx-".concat(e.__hash)+" "+"px-4 py-2 rounded-lg font-medium ".concat(D?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:D?"퀴즈 생성 중...":"퀴즈 생성하기"}),(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" text-sm text-gray-500 mt-4",children:"또는 다른 날짜를 선택해보세요."})]}):x?(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" quiz-container",children:[(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" mb-6",children:[(0,r.jsx)("h3",{className:"jsx-".concat(e.__hash)+" text-xl font-semibold mb-2",children:"오늘의 퀴즈"}),(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" text-gray-700",children:x.question})]}),(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" space-y-3 mb-6",children:x.options.map((t,s)=>{let n="border rounded-lg p-4 transition-colors cursor-pointer ";return S&&void 0!==x.correct_answer?s+1===x.correct_answer?n+="bg-green-50 border-green-300":s+1===v?n+="bg-red-50 border-red-300":n+="border-gray-200":n+=v===s+1?"bg-blue-50 border-blue-300":"hover:bg-gray-50 border-gray-200",(0,r.jsx)("div",{onClick:()=>{S||w(s+1)},className:"jsx-".concat(e.__hash)+" "+(n||""),children:(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" flex items-start",children:[(0,r.jsx)("span",{className:"jsx-".concat(e.__hash)+" flex items-center justify-center w-6 h-6 rounded-full bg-gray-200 text-gray-800 text-sm font-medium mr-3",children:s+1}),(0,r.jsx)("span",{className:"jsx-".concat(e.__hash),children:t}),S&&void 0!==x.correct_answer&&(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" ml-auto",children:s+1===x.correct_answer?(0,r.jsx)("span",{className:"jsx-".concat(e.__hash)+" text-green-500",children:"✓"}):s+1===v?(0,r.jsx)("span",{className:"jsx-".concat(e.__hash)+" text-red-500",children:"✗"}):null})]})},s)})}),(0,r.jsx)("div",{className:"jsx-".concat(e.__hash),children:S?(0,r.jsx)("div",{className:"jsx-".concat(e.__hash),children:(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" text-center",children:[x.user_answer&&void 0!==x.user_answer.is_correct&&(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" text-lg font-semibold mb-2",children:x.user_answer.is_correct?(0,r.jsx)("span",{className:"jsx-".concat(e.__hash)+" text-green-600",children:"정답입니다! \uD83C\uDF89"}):(0,r.jsx)("span",{className:"jsx-".concat(e.__hash)+" text-red-600",children:"틀렸습니다. 다음에 다시 도전해보세요!"})}),x.explanation&&(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" text-sm font-medium text-gray-700 mb-1",children:"\uD83D\uDCA1 설명"}),(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" text-gray-600",children:x.explanation})]})]})}):(0,r.jsx)("button",{disabled:null===v,onClick:J,className:"jsx-".concat(e.__hash)+" "+"w-full py-3 px-4 rounded-lg font-medium ".concat(null===v?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:"정답 제출"})})]}):(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" text-center py-10",children:C?(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" bg-amber-50 border-2 border-amber-200 p-6 rounded-lg shadow-md text-center",children:[(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" text-5xl mb-2",children:"\uD83C\uDFEB"}),(0,r.jsx)("h3",{className:"jsx-".concat(e.__hash)+" text-lg font-bold text-amber-700 mb-2",children:"오늘은 쉬는 날!"}),(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" text-amber-600",children:F})]}):D?(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" py-8 text-center",children:[(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" flex justify-center mb-4",children:(0,r.jsxs)("div",{className:"jsx-".concat(e.__hash)+" relative",children:[(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" w-24 h-24 bg-orange-100 rounded-full border-4 border-orange-300 animate-pulse flex items-center justify-center relative overflow-hidden",children:(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" w-16 h-16 bg-white rounded-full shadow-inner flex items-center justify-center",children:(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" w-10 h-10 border-4 border-orange-400 border-t-transparent rounded-full animate-spin"})})}),(0,r.jsx)("div",{className:"jsx-".concat(e.__hash)+" absolute -right-2 -top-2 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white animate-bounce",children:(0,r.jsx)("span",{className:"jsx-".concat(e.__hash)+" text-xs",children:"AI"})})]})}),(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" text-gray-700 font-medium mb-2",children:"급식 퀴즈 생성중..."}),(0,r.jsxs)("p",{className:"jsx-".concat(e.__hash)+" text-sm text-gray-500",children:["AI가 오늘 먹은 급식메뉴로 ",(0,r.jsx)("br",{className:"jsx-".concat(e.__hash)}),"재미있는 퀴즈를 만들고 있어요!"]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"jsx-".concat(e.__hash)+" text-gray-600 mb-4",children:"퀴즈가 없습니다."}),(0,r.jsx)("button",{onClick:T,className:"jsx-".concat(e.__hash)+" px-4 py-2 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700",children:"퀴즈 생성하기"})]})})}),(0,r.jsx)(m,{currentQuizDate:n,onDateSelect:e=>{h(e),t.push("/quiz?date=".concat(e))},onRefreshNeeded:()=>{}}),(0,r.jsx)(g,{currentMonth:new Date})]})]})}},8650:(e,t,s)=>{"use strict";var r=s(4338);s(3522);var n=s(7620),a=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(n),o=void 0!==r&&r.env&&!0,l=function(e){return"[object String]"===Object.prototype.toString.call(e)},i=function(){function e(e){var t=void 0===e?{}:e,s=t.name,r=void 0===s?"stylesheet":s,n=t.optimizeForSpeed,a=void 0===n?o:n;c(l(r),"`name` must be a string"),this._name=r,this._deletedRulePlaceholder="#"+r+"-deleted-rule____{}",c("boolean"==typeof a,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=a,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var i="undefined"!=typeof window&&document.querySelector('meta[property="csp-nonce"]');this._nonce=i?i.getAttribute("content"):null}var t,s=e.prototype;return s.setOptimizeForSpeed=function(e){c("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),c(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(c(!this._injected,"sheet already injected"),this._injected=!0,"undefined"!=typeof window&&this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(o||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(t,s){return"number"==typeof s?e._serverSheet.cssRules[s]={cssText:t}:e._serverSheet.cssRules.push({cssText:t}),s},deleteRule:function(t){e._serverSheet.cssRules[t]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,t){if(c(l(e),"`insertRule` accepts only strings"),"undefined"==typeof window)return"number"!=typeof t&&(t=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,t),this._rulesCount++;if(this._optimizeForSpeed){var s=this.getSheet();"number"!=typeof t&&(t=s.cssRules.length);try{s.insertRule(e,t)}catch(t){return o||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var r=this._tags[t];this._tags.push(this.makeStyleTag(this._name,e,r))}return this._rulesCount++},s.replaceRule=function(e,t){if(this._optimizeForSpeed||"undefined"==typeof window){var s="undefined"!=typeof window?this.getSheet():this._serverSheet;if(t.trim()||(t=this._deletedRulePlaceholder),!s.cssRules[e])return e;s.deleteRule(e);try{s.insertRule(t,e)}catch(r){o||console.warn("StyleSheet: illegal rule: \n\n"+t+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),s.insertRule(this._deletedRulePlaceholder,e)}}else{var r=this._tags[e];c(r,"old rule at index `"+e+"` not found"),r.textContent=t}return e},s.deleteRule=function(e){if("undefined"==typeof window)return void this._serverSheet.deleteRule(e);if(this._optimizeForSpeed)this.replaceRule(e,"");else{var t=this._tags[e];c(t,"rule at index `"+e+"` not found"),t.parentNode.removeChild(t),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,"undefined"!=typeof window?(this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]):this._serverSheet.cssRules=[]},s.cssRules=function(){var e=this;return"undefined"==typeof window?this._serverSheet.cssRules:this._tags.reduce(function(t,s){return s?t=t.concat(Array.prototype.map.call(e.getSheetForTag(s).cssRules,function(t){return t.cssText===e._deletedRulePlaceholder?null:t})):t.push(null),t},[])},s.makeStyleTag=function(e,t,s){t&&c(l(t),"makeStyleTag accepts only strings as second parameter");var r=document.createElement("style");this._nonce&&r.setAttribute("nonce",this._nonce),r.type="text/css",r.setAttribute("data-"+e,""),t&&r.appendChild(document.createTextNode(t));var n=document.head||document.getElementsByTagName("head")[0];return s?n.insertBefore(r,s):n.appendChild(r),r},t=[{key:"length",get:function(){return this._rulesCount}}],function(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}();function c(e,t){if(!e)throw Error("StyleSheet: "+t+".")}var d=function(e){for(var t=5381,s=e.length;s;)t=33*t^e.charCodeAt(--s);return t>>>0},u={};function h(e,t){if(!t)return"jsx-"+e;var s=String(t),r=e+s;return u[r]||(u[r]="jsx-"+d(e+"-"+s)),u[r]}function m(e,t){"undefined"==typeof window&&(t=t.replace(/\/style/gi,"\\/style"));var s=e+t;return u[s]||(u[s]=t.replace(/__jsx-style-dynamic-selector/g,e)),u[s]}var x=function(){function e(e){var t=void 0===e?{}:e,s=t.styleSheet,r=void 0===s?null:s,n=t.optimizeForSpeed,a=void 0!==n&&n;this._sheet=r||new i({name:"styled-jsx",optimizeForSpeed:a}),this._sheet.inject(),r&&"boolean"==typeof a&&(this._sheet.setOptimizeForSpeed(a),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var t=e.prototype;return t.add=function(e){var t=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),"undefined"==typeof window||this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,t){return e[t]=0,e},{}));var s=this.getIdAndRules(e),r=s.styleId,n=s.rules;if(r in this._instancesCounts){this._instancesCounts[r]+=1;return}var a=n.map(function(e){return t._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[r]=a,this._instancesCounts[r]=1},t.remove=function(e){var t=this,s=this.getIdAndRules(e).styleId;if(function(e,t){if(!e)throw Error("StyleSheetRegistry: "+t+".")}(s in this._instancesCounts,"styleId: `"+s+"` not found"),this._instancesCounts[s]-=1,this._instancesCounts[s]<1){var r=this._fromServer&&this._fromServer[s];r?(r.parentNode.removeChild(r),delete this._fromServer[s]):(this._indices[s].forEach(function(e){return t._sheet.deleteRule(e)}),delete this._indices[s]),delete this._instancesCounts[s]}},t.update=function(e,t){this.add(t),this.remove(e)},t.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},t.cssRules=function(){var e=this,t=this._fromServer?Object.keys(this._fromServer).map(function(t){return[t,e._fromServer[t]]}):[],s=this._sheet.cssRules();return t.concat(Object.keys(this._indices).map(function(t){return[t,e._indices[t].map(function(e){return s[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},t.styles=function(e){var t,s;return t=this.cssRules(),void 0===(s=e)&&(s={}),t.map(function(e){var t=e[0],r=e[1];return a.default.createElement("style",{id:"__"+t,key:"__"+t,nonce:s.nonce?s.nonce:void 0,dangerouslySetInnerHTML:{__html:r}})})},t.getIdAndRules=function(e){var t=e.children,s=e.dynamic,r=e.id;if(s){var n=h(r,s);return{styleId:n,rules:Array.isArray(t)?t.map(function(e){return m(n,e)}):[m(n,t)]}}return{styleId:h(r),rules:Array.isArray(t)?t:[t]}},t.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,t){return e[t.id.slice(2)]=t,e},{})},e}(),g=n.createContext(null);g.displayName="StyleSheetContext";var p=a.default.useInsertionEffect||a.default.useLayoutEffect,_="undefined"!=typeof window?new x:void 0;function f(e){var t=_||n.useContext(g);return t&&("undefined"==typeof window?t.add(e):p(function(){return t.add(e),function(){t.remove(e)}},[e.id,String(e.dynamic)])),null}f.dynamic=function(e){return e.map(function(e){return h(e[0],e[1])}).join(" ")},t.style=f}}]);