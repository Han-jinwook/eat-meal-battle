"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[517],{8517:(e,t,o)=>{o.r(t),o.d(t,{default:()=>p});var l=o(4568),s=o(7620),a=o(5969),i=o(6281),n=o(1775),r=o(4338);let c={apiKey:"REPLACED_IN_NETLIFY",authDomain:"eat-meal-battle-77735.firebaseapp.com",projectId:"eat-meal-battle-77735",storageBucket:"eat-meal-battle-77735.firebasestorage.app",messagingSenderId:"1066228034703",appId:"1:1066228034703:web:addfc72826e13dda76d4fa"},d=()=>{let e=(0,a.Dk)().length?(0,a.Dk)()[0]:(0,a.Wp)(c);{let t=r.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY;t&&setTimeout(()=>{try{(0,n.Ay)(e,{provider:new n._u(t),isTokenAutoRefreshEnabled:!0}),console.log("Firebase App Check가 초기화되었습니다.")}catch(e){console.error("Firebase App Check 초기화 오류:",e)}},1e3)}return e},u=async e=>{try{if("serviceWorker"in navigator){let t=d(),o=(0,i.dG)(t),l=await Notification.requestPermission();if("granted"===l){console.log("알림 권한이 허용되었습니다.");let t=await (0,i.gf)(o,{vapidKey:"BNmnim-rxsmFUs6cbETLKgknz9LdpDC5vlo1PxqHB-xJLTgth1pGWM2UsY0D6Rpf2sZW8DYKz0abDa4Ip0YPpDY"});if(t)return console.log("FCM 토큰:",t),e(t),t;console.log("FCM 토큰을 받을 수 없습니다. 알림 권한을 확인하세요.")}else console.log("알림 권한이 거부되었습니다.")}}catch(e){console.error("FCM 토큰 검색 중 오류 발생:",e)}return null},f=()=>new Promise(e=>{{let t=d(),o=(0,i.dG)(t);(0,i.xD)(o,t=>{console.log("메시지 수신:",t),e(t)})}});var m=o(7584),g=o(5317);let p=()=>{let{supabase:e,session:t}=(0,m._)(),[o,a]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(null==t?void 0:t.user)&&(async()=>{try{let e=await u(i);a(!!e)}catch(e){console.error("FCM 토큰 등록 오류:",e)}})()},[t]);let i=async o=>{var l;if((null==t||null==(l=t.user)?void 0:l.id)&&o)try{let{error:l}=await e.from("profiles").update({fcm_token:o}).eq("user_id",t.user.id);l?console.error("FCM 토큰 데이터베이스 저장 오류:",l):console.log("FCM 토큰이 성공적으로 저장되었습니다.")}catch(e){console.error("FCM 토큰 저장 중 예외 발생:",e)}};return(0,s.useEffect)(()=>{{let e=f().then(e=>{(null==e?void 0:e.notification)&&g.oR.custom(t=>{var o;return(0,l.jsxs)("div",{className:"".concat(t.visible?"animate-enter":"animate-leave"," \n              max-w-md w-full bg-white shadow-lg rounded-lg pointer-events-auto \n              flex flex-col ring-1 ring-black ring-opacity-5 p-4"),children:[(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsxs)("div",{className:"ml-3 flex-1",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.notification.title}),(0,l.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:e.notification.body})]}),(0,l.jsxs)("button",{onClick:()=>g.oR.dismiss(t.id),className:"ml-4 flex-shrink-0 bg-white rounded-md text-gray-400    hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,l.jsx)("span",{className:"sr-only",children:"닫기"}),(0,l.jsx)("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]}),(null==(o=e.data)?void 0:o.url)&&(0,l.jsx)("button",{onClick:()=>{window.location.href=e.data.url,g.oR.dismiss(t.id)},className:"mt-2 w-full bg-indigo-600 text-white py-1 px-2 rounded-md    text-sm hover:bg-indigo-700 focus:outline-none focus:ring-2    focus:ring-offset-2 focus:ring-indigo-500",children:"바로가기"})]})},{duration:6e3,position:"top-right"})});return()=>{e.catch(e=>console.error("알림 리스너 해제 오류:",e))}}},[]),null}}}]);