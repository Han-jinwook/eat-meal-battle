(()=>{var e={};e.id=149,e.ids=[149],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},55948:(e,r,t)=>{"use strict";t.d(r,{Z:()=>o});var s=t(18156);let o=()=>{let e="https://izkumvvlkrkgiuuczffp.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!r)throw Error("Supabase URL 또는 서비스 롤 키가 설정되지 않았습니다.");return(0,s.UU)(e,r,{auth:{autoRefreshToken:!1,persistSession:!1}})}},58152:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>l,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>c});var o=t(48106),a=t(48819),i=t(12050),n=t(4235),u=t(84875),p=t(55948);async function c(e){try{console.log("API 호출: /api/meal-images/create");let r=(0,u.U)(),{data:{user:t}}=await r.auth.getUser();if(!t)return console.log("인증되지 않은 요청"),n.NextResponse.json({error:"인증되지 않은 요청입니다."},{status:401});let s=(0,p.Z)(),{meal_id:o,image_url:a,user_id:i,status:c,source:l}=await e.json();if(console.log("요청 데이터:",{meal_id:o,image_url:a,user_id:i,status:c,source:l}),!o||!a||!l)return n.NextResponse.json({error:"필수 정보가 누락되었습니다. (meal_id, image_url, source)"},{status:400});if(i!==t.id)return console.log("불일치하는 사용자 ID:",{요청된_ID:i,인증된_ID:t.id}),n.NextResponse.json({error:"인증된 사용자와 일치하지 않는 사용자 ID입니다."},{status:403});try{new URL(a)}catch(e){return n.NextResponse.json({error:"잘못된 이미지 URL 형식입니다."},{status:400})}let{data:d,error:m}=await s.from("meal_images").select("id").eq("meal_id",o).eq("status","approved").limit(1);if(m)return console.error("기존 승인 이미지 조회 오류:",m),n.NextResponse.json({error:"기존 승인 이미지 조회 중 오류가 발생했습니다."},{status:500});if(d&&d.length)return n.NextResponse.json({error:"이미 승인된 급식사진이 있습니다."},{status:409});console.log("서비스 롤 키로 데이터 삽입 시도...");let{data:g,error:x}=await s.from("meal_images").upsert({meal_id:o,image_url:a,uploaded_by:i,status:c||"pending",source:l,updated_at:new Date().toISOString()},{onConflict:"meal_id,status",ignoreDuplicates:!1}).select().single();if(x)return console.error("이미지 정보 저장 오류:",x),n.NextResponse.json({error:`이미지 정보 저장 중 오류가 발생했습니다: ${x.message}`},{status:500});if(!g)return console.error("Upsert 후 반환된 데이터가 없습니다."),n.NextResponse.json({error:"이미지 정보 저장 후 데이터를 받지 못했습니다."},{status:500});console.log("이미지 정보 저장 성공:",g);let f=null;if(g.uploaded_by){let{data:e,error:r}=await s.from("users").select("nickname").eq("id",g.uploaded_by).single();r?console.error("업로더 닉네임 조회 오류:",r):e&&(f=e.nickname)}let R={...g,uploader_nickname:f};return console.log("최종 반환 데이터:",R),n.NextResponse.json(R)}catch(r){let e=r instanceof Error?r.message:"알 수 없는 서버 오류가 발생했습니다.";return console.error("API 오류 발생:",{endpoint:"/api/meal-images/create",errorType:r instanceof Error?r.name:typeof r,errorMessage:e,stack:r instanceof Error?r.stack:void 0,timestamp:new Date().toISOString()}),n.NextResponse.json({error:e,code:"INTERNAL_SERVER_ERROR"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/meal-images/create/route",pathname:"/api/meal-images/create",filename:"route",bundlePath:"app/api/meal-images/create/route"},resolvedPagePath:"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\app\\api\\meal-images\\create\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:m,serverHooks:g}=l;function x(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:m})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80408:()=>{},81630:e=>{"use strict";e.exports=require("http")},84875:(e,r,t)=>{"use strict";t.d(r,{U:()=>a});var s=t(98811),o=t(65208);function a(){let e=(0,o.UL)();return(0,s.Ri)("https://izkumvvlkrkgiuuczffp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc",{cookies:{get:r=>e.get(r)?.value,set(r,t,s){try{e.set(r,t,s)}catch(e){console.error(`Failed to set cookie ${r}`,e)}},remove(r,t){try{e.delete(r,t)}catch(e){console.error(`Failed to remove cookie ${r}`,e)}}}})}},87032:()=>{},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[50,744,156,811,208],()=>t(58152));module.exports=s})();