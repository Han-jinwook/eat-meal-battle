(()=>{var e={};e.id=974,e.ids=[974],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7723:(e,t,r)=>{Promise.resolve().then(r.bind(r,67858))},9699:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(41253);let n=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},36096:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var a=r(24332),n=r(48819),s=r(67851),i=r.n(s),l=r(97540),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c={children:["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,67858)),"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\app\\page.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,9699))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,20685)),"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,19033,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,39956,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,92341,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,9699))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\app\\page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},36729:e=>{e.exports={container:"StarRating_container__wcvPj",starRating:"StarRating_starRating__1zTCK",star:"StarRating_star__QCP0_",small:"StarRating_small__LixRz",medium:"StarRating_medium__lZz_C",large:"StarRating_large__lmltq",filled:"StarRating_filled__5rpji",halfFilled:"StarRating_halfFilled__9vrBQ",empty:"StarRating_empty__CGeAC",positive:"StarRating_positive__kbCSb",neutral:"StarRating_neutral__Ty9Xe",negative:"StarRating_negative__Xz_Do",ratingInfo:"StarRating_ratingInfo__ihrMI",ratingValue:"StarRating_ratingValue__f82Mo",ratingCount:"StarRating_ratingCount__kNgMm"}},54335:(e,t,r)=>{"use strict";let a;r.r(t),r.d(t,{default:()=>em});var n=r(13486),s=r(60159),i=r.n(s),l=r(2984),o=r(605);function c(){(0,o.U)();let[e,t]=(0,s.useState)(null),[r,a]=(0,s.useState)(null),[n,i]=(0,s.useState)(!1),[l,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(0);return{user:e,userSchool:r,loading:n,error:l,refresh:(0,s.useCallback)(()=>{u(e=>e+1)},[])}}let d=e=>{if(!e||""===e.trim())return"/images/placeholder.jpg";if(e.startsWith("/api/image-proxy")||(/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(\/|$)/.test(e)&&!e.startsWith("http")&&(e=`https://${e}`),e.startsWith("/")&&!e.startsWith("//")))return e;try{if(e.startsWith("//"))e=`https:${e}`;else if(!e.startsWith("http"))return"/images/placeholder.jpg";if(e.includes("supabase.co")&&e.includes("/storage/")||e.startsWith("http")){let t=encodeURIComponent(e);return`/api/image-proxy?url=${t}`}return"/images/placeholder.jpg"}catch(e){return console.warn("이미지 URL 처리 오류:",e),"/images/placeholder.jpg"}},u=e=>{try{let t=e.currentTarget;if(t.style.display="none",t.parentElement&&(t.parentElement.style.backgroundColor="#f3f4f6",!t.parentElement.querySelector(".image-fallback"))){let e=document.createElement("div");e.innerText="이미지를 불러올 수 없습니다",e.className="image-fallback flex items-center justify-center h-full w-full text-gray-500 text-sm",t.parentElement.appendChild(e)}e.preventDefault()}catch(e){console.warn("이미지 에러 처리 중 오류 발생",e)}},m=({src:e,alt:t,className:r="",style:a={}})=>{let s=e?.startsWith("data:")?e:d(e);return(0,n.jsx)("img",{src:s,alt:t,className:r,style:a,onError:u,loading:"lazy"})};function h({mealId:e,schoolCode:t,mealDate:r,mealType:a,onUploadSuccess:i,onUploadError:l}){let c=(0,o.U)(),[d,u]=(0,s.useState)(!1),[h,f]=(0,s.useState)(null),[g,p]=(0,s.useState)(null),[x,y]=(0,s.useState)(!1),[w,v]=(0,s.useState)(null),[b,j]=(0,s.useState)(null),[_,N]=(0,s.useState)(null),[k,S]=(0,s.useState)(!1),[C,M]=(0,s.useState)("none"),[P,W]=(0,s.useState)(!0),L=(0,s.useRef)(null);(0,s.useCallback)(async()=>{if(!e)return;console.log("승인된 이미지 조회:",e);let{data:t,error:r}=await c.from("meal_images").select("*").eq("meal_id",e).eq("status","approved").single();if(r){"PGRST116"!==r.code&&console.debug("기존 승인 이미지 조회 오류:",r);return}if(t){if(console.log("승인된 이미지 발견:",t.id),t.uploaded_by){let{data:e,error:r}=await c.from("users").select("nickname").eq("id",t.uploaded_by).single();!r&&e&&(t.uploader_nickname=e.nickname)}j(t),W(!1)}},[e,c]);let A=async()=>{try{let n;console.log("AI 이미지 생성 버튼 클릭!"),f(null),L.current&&(L.current.value=""),u(!1),p(null),y(!1),M("generating"),console.log("메뉴 정보 조회 시도:",{schoolCode:t,mealDate:r,mealType:a});let{data:s,error:o}=await c.from("meal_menus").select("id, menu_items, meal_date, meal_type, school_code").eq("school_code",t).eq("meal_date",r).eq("meal_type",a).single();if(o)throw console.error("메뉴 정보 조회 오류:",o),Error("메뉴 정보를 찾을 수 없습니다.");if(!s||!s.menu_items||0===s.menu_items.length)throw console.error("메뉴 정보가 없습니다:",s),Error("급식 메뉴 정보가 없습니다.");console.log("메뉴 정보 조회 성공:",{menuItems:s.menu_items,menuCount:s.menu_items.length,mealDate:s.meal_date,mealType:s.meal_type,schoolCode:s.school_code});let d="/.netlify/functions/generate-meal-image";console.log("AI 이미지 생성 API 요청 URL:",d);let m=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({menu_items:s.menu_items,meal_id:e,school_code:s.school_code||t,meal_date:s.meal_date||r,meal_type:s.meal_type||a,user_id:_})});console.log("AI 이미지 생성 API 응답 상태 코드:",m.status,m.statusText);let h=await m.text();console.log("AI 이미지 생성 API 응답 텍스트(처음 200자):",h.substring(0,200));try{n=JSON.parse(h),console.log("AI 이미지 생성 API 응답 파싱 결과:",n)}catch(e){throw console.error("AI 이미지 생성 API 응답 파싱 오류:",e),console.error("파싱 오류 발생한 응답의 처음 부분:",h.substring(0,50)),Error(`응답 처리 중 오류가 발생했습니다. 상태 코드: ${m.status}`)}if(!n.success)throw Error(n.error||"AI 이미지 생성에 실패했습니다.");if(console.log("AI 이미지 생성 성공:",n.image),n.image&&n.image.uploaded_by)try{let{data:e,error:t}=await c.from("users").select("nickname, profile_image").eq("id",n.image.uploaded_by).single();!t&&e?(console.log("AI 이미지 생성 - 사용자 정보 조회 성공:",e),n.image.uploader_nickname=e.nickname,n.image.users={nickname:e.nickname,profile_image:e.profile_image}):console.error("AI 이미지 생성 - 사용자 정보 조회 오류:",t)}catch(e){console.error("AI 이미지 생성 - 사용자 정보 조회 예외:",e)}j(n.image),v({isMatch:!0,matchScore:1,explanation:"AI가 생성한 이미지입니다. 메뉴에 맞게 자동 생성되었습니다."}),M("complete"),console.log("⏱️ 이미지 업로드 후 콜백 호출 대기 중..."),setTimeout(()=>{console.log("⏱️ 콜백 호출 타이머 완료, onUploadSuccess 호출"),i&&i()},4e3);let x=g&&"object"==typeof g&&g.message?g.message:"AI 이미지 생성 중 오류가 발생했습니다.";p(x),M("error"),l&&l(x)}finally{u(!1)}},I=async e=>{try{let t;y(!0);let r=/^(localhost|127\.|\/api)/.test(window.location.hostname)?"/api/meal-images/verify":"/.netlify/functions/verify-meal-image";console.log("검증 API 요청 URL:",r);let a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageId:e})}),n=await a.text();try{t=JSON.parse(n),console.log("검증 API 응답:",t)}catch(e){if(console.error("검증 API 응답 파싱 오류:",e,n),a.ok)throw Error("응답 파싱 오류: 올바른 JSON 응답이 아닙니다");throw Error(`검증 API 오류: ${a.status} ${a.statusText}`)}if(!a.ok)throw Error(t?.error||"이미지 검증 중 오류가 발생했습니다.");return v(t),t}catch(e){throw console.error("이미지 검증 오류:",e),p(e.message||"이미지 검증 중 오류가 발생했습니다."),e}finally{y(!1)}},D=async()=>{if(!L.current?.files?.[0])return void p("업로드할 이미지를 선택해주세요.");console.log("업로드 시도:",{fileName:L.current.files[0].name,fileSize:L.current.files[0].size,mealId:e||"undefined",preview:!!h}),u(!0),p(null),v(null);let n="";try{let s,l=L.current.files[0],{data:{user:o}}=await c.auth.getUser();if(!o)throw Error("로그인이 필요합니다.");let d=new FormData;d.append("file",l),d.append("meal_id",e),d.append("school_code",t),d.append("meal_date",r),d.append("meal_type",a),d.append("user_id",o.id),console.log("서버 사이드 업로드 시도...",{meal_id:e,school_code:t,meal_date:r,meal_type:a,file_name:l.name,file_size:l.size});let u=/^(localhost|127\.|\/api)/.test(window.location.hostname)?"/api/meal-images/upload":"/.netlify/functions/upload-meal-image";console.log("업로드 API 요청 URL:",u);let m=await fetch(u,{method:"POST",body:d});if(!m.ok){let e=await m.text(),t=`서버 오류: ${m.status} ${m.statusText}`;try{if(e.trim().startsWith("{")){let r=JSON.parse(e);r.error&&(t=r.error)}}catch(e){console.error("응답 파싱 오류:",e)}throw p(t),Error(t)}try{let e=await m.text();s=JSON.parse(e)}catch(e){throw console.error("성공 응답 파싱 오류:",e),p("응답 데이터 파싱 중 오류가 발생했습니다"),Error("응답 데이터 파싱 오류")}console.log("업로드 성공:",s),n=s.id;try{let e=await I(n);console.log("검증 결과:",e);let{data:t}=await c.from("meal_images").select(`
            *,
            users:uploaded_by(id, nickname, profile_image)
          `).eq("id",n).single();if(t){let r={...t,uploader_nickname:t.users?.nickname||null,status:e.isMatch?"approved":"rejected",explanation:e.explanation||null};j(r)}console.log("⏱️ 이미지 업로드 후 콜백 호출 대기 중..."),setTimeout(()=>{console.log("⏱️ 콜백 호출 타이머 완료, onUploadSuccess 호출"),i&&i()},2e3)}catch(e){console.error("검증 오류:",e);try{let{data:e}=await c.from("meal_images").select(`
              *,
              users:uploaded_by(id, nickname, profile_image)
            `).eq("id",n).single();if(e){let t={...e,uploader_nickname:e.users?.nickname||null,status:"rejected",explanation:"이미지 검증 중 오류가 발생했습니다."};j(t)}}catch(e){console.error("이미지 정보 조회 오류:",e)}i&&i()}L.current&&(L.current.value=""),f(null)}catch(e){console.error("이미지 업로드 오류:",e),p(e.message||"이미지 업로드 중 오류가 발생했습니다."),l&&l(e.message||"이미지 업로드 중 오류가 발생했습니다.")}finally{u(!1)}},E=async()=>{if(b)try{let{data:e}=await c.from("meal_images").select("*").eq("id",b.id).single();if(!e)throw Error("이미지를 찾을 수 없습니다.");if("approved"===e.status)return void p("승인되거나 공유된 이미지는 삭제할 수 없습니다.");let{error:t}=await c.from("meal_images").delete().eq("id",b.id);if(t)throw t;try{let t=new URL(e.image_url).pathname.split("/"),r=t[t.length-1];console.log("삭제할 파일 경로:",r);let{error:a}=await c.storage.from("meal-images").remove([r]);a&&console.error("스토리지 이미지 삭제 오류:",a)}catch(e){console.error("파일 경로 추출 오류:",e)}j(null),v(null),f(null),L.current&&(L.current.value=""),i&&i()}catch(e){console.error("이미지 삭제 오류:",e),p(e.message||"이미지 삭제 중 오류가 발생했습니다.")}};return(0,n.jsx)("div",{className:"p-0 mb-0 max-w-xl mx-auto",children:b?(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"overflow-hidden rounded-lg",children:[(0,n.jsx)("div",{className:"relative w-full h-auto",children:(0,n.jsx)(m,{src:b.image_url,alt:"급식 이미지",style:{width:"100%",height:"auto",maxHeight:"80vh",display:"block"}})}),(0,n.jsxs)("div",{className:"px-0 py-1 text-xs",children:[(0,n.jsxs)("div",{className:"flex justify-end items-center",children:["user_ai"===b.source&&b.uploader_nickname&&(0,n.jsxs)("span",{className:"text-xs text-gray-500 text-right",children:["AI로 생성한 이미지 (",b.uploader_nickname,")"]}),"user_ai"===b.source&&!b.uploader_nickname&&(0,n.jsx)("span",{className:"text-xs text-gray-500 text-right",children:"AI로 생성한 이미지"}),"auto_ai"===b.source&&(0,n.jsx)("span",{className:"text-xs text-gray-500 text-right",children:"AI로 생성한 이미지"}),"user"===b.source&&b.uploader_nickname&&(0,n.jsxs)("span",{className:"text-xs text-gray-500 text-right",children:["(",b.uploader_nickname,")"]})]}),"rejected"===b.status&&(0,n.jsx)("div",{className:"text-sm mb-2",children:"rejected"===b.status&&(0,n.jsx)("span",{className:"text-orange-600 ml-1",children:"(매칭실패, 업로드 불가)"})}),"rejected"===b.status&&b.explanation&&(0,n.jsxs)("div",{className:"text-sm text-gray-700 mb-2",children:[(0,n.jsx)("span",{className:"font-semibold",children:"사유:"})," ",b.explanation]}),"approved"!==b.status&&(0,n.jsx)("button",{onClick:E,className:"mt-2 text-sm text-red-600 hover:text-red-800",children:"삭제"})]})]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"오늘의 급식 사진을 공유해보세요!"}),(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:t=>{let r=t.target.files?.[0];if(!r)return;if(console.log("파일 선택됨:",{fileName:r.name,fileSize:r.size,mealId:e||"undefined",fileType:r.type}),!r.type.startsWith("image/"))return void p("이미지 파일만 업로드할 수 있습니다.");if(r.size>5242880)return void p("파일 크기는 5MB 이하여야 합니다.");S(!1),M("processing"),console.log("버튼 타이머 시작"),setTimeout(()=>{S(!0),console.log("버튼 활성화 타이머 완료")},6e3);let a=new FileReader;a.onload=e=>{f(e.target?.result)},a.readAsDataURL(r),p(null),v(null),u(!1),y(!1),console.log("파일 로드 완료, 상태:",{file:!!r,previewSet:!!t.target?.files?.[0],uploading:!1,verifying:!1,isButtonReady:!1,imageStatus:"processing"})},ref:L,className:"block w-full text-sm text-gray-500   file:mr-4 file:py-2 file:px-4   file:rounded-md file:border-0   file:text-sm file:font-semibold   file:bg-blue-50 file:text-blue-700   hover:file:bg-blue-100"})]}),h&&(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"미리보기:"}),(0,n.jsx)("div",{className:"relative w-full h-64 bg-gray-100 rounded-md overflow-hidden",children:(0,n.jsx)(m,{src:h,alt:"업로드 이미지 미리보기",style:{objectFit:"contain",position:"absolute",width:"100%",height:"100%"}})})]}),g&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-md text-sm",children:g}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,n.jsx)("button",{disabled:d||x||!h||!k,onClick:()=>{console.log("업로드 버튼 클릭, 상태:",{uploading:d,verifying:x,preview:!!h,isDisabled:d||x||!h}),D()},className:`px-4 py-2 rounded-md text-white ${d||x||!h||!k?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:d||x?(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"AI 분석 중..."]}):!k&&h?(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsxs)("svg",{className:"animate-pulse -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"AI 분석 준비 중..."]}):"업로드 및 AI 검증"}),P&&(0,n.jsx)("button",{onClick:A,disabled:"generating"===C,className:`px-4 py-2 rounded-md text-white ${"generating"===C?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} flex items-center`,children:"generating"===C?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"AI 이미지 생성 중..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"AI 이미지 생성"]})})]})]})})}var f={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},g=s.createContext&&s.createContext(f),p=["attr","size","title"];function x(){return(x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){var a,n,s;a=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in a?Object.defineProperty(a,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function v(e){return t=>s.createElement(b,x({attr:w({},e.attr)},t),function e(t){return t&&t.map((t,r)=>s.createElement(t.tag,w({key:r},t.attr),e(t.child)))}(e.child))}function b(e){var t=t=>{var r,{attr:a,size:n,title:i}=e,l=function(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;r[a]=e[a]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,p),o=n||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),s.createElement("svg",x({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,l,{className:r,style:w(w({color:e.color||t.color},t.style),e.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),i&&s.createElement("title",null,i),e.children)};return void 0!==g?s.createElement(g.Consumer,null,e=>t(e)):t(f)}function j(e){return v({tag:"svg",attr:{viewBox:"0 0 536 512"},child:[{tag:"path",attr:{d:"M508.55 171.51L362.18 150.2 296.77 17.81C290.89 5.98 279.42 0 267.95 0c-11.4 0-22.79 5.9-28.69 17.81l-65.43 132.38-146.38 21.29c-26.25 3.8-36.77 36.09-17.74 54.59l105.89 103-25.06 145.48C86.98 495.33 103.57 512 122.15 512c4.93 0 10-1.17 14.87-3.75l130.95-68.68 130.94 68.7c4.86 2.55 9.92 3.71 14.83 3.71 18.6 0 35.22-16.61 31.66-37.4l-25.03-145.49 105.91-102.98c19.04-18.5 8.52-50.8-17.73-54.6zm-121.74 123.2l-18.12 17.62 4.28 24.88 19.52 113.45-102.13-53.59-22.38-11.74.03-317.19 51.03 103.29 11.18 22.63 25.01 3.64 114.23 16.63-82.65 80.38z"},child:[]}]})(e)}function _(e){return v({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(e)}function N(e){return v({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"},child:[]}]})(e)}var k=r(36729),S=r.n(k);let C=({value:e=0,onChange:t,interactive:r=!1,size:a="medium",showValue:l=!1,ratingCount:o})=>{let c=(0,s.useRef)(!0),[d,u]=(0,s.useState)(!1),m=(0,s.useRef)(null),h=Math.round(10*e)/10,f={small:S().small,medium:S().medium,large:S().large}[a],g=h>=4?S().positive:h>=3?S().neutral:S().negative,p=e=>{let t=h>=e+1,r=h>=e+.5&&h<e+1;return t?(0,n.jsx)(_,{className:`${S().star} ${S().filled} ${g}`}):r?(0,n.jsx)(j,{className:`${S().star} ${S().halfFilled} ${g}`}):(0,n.jsx)(N,{className:`${S().star} ${S().empty}`})};(0,s.useEffect)(()=>()=>{c.current=!1,null!==m.current&&(window.clearTimeout(m.current),m.current=null)},[]);let x=(0,s.useCallback)(e=>{if(!d&&r)try{if(u(!0),!c.current)return;t&&t(e+1),null!==m.current&&clearTimeout(m.current),m.current=window.setTimeout(()=>{c.current&&u(!1)},300)}catch(e){console.error("별점 클릭 처리 중 오류:",e),c.current&&u(!1)}},[r,t,d]),y=i().useMemo(()=>[0,1,2,3,4].map(e=>(0,n.jsx)("span",{onClick:t=>{t.stopPropagation(),x(e)},style:{cursor:r&&!d?"pointer":"default",opacity:d?.7:1,transition:"opacity 0.2s ease-in-out"},role:"button","aria-label":`${e+1}점 평가하기`,children:p(e)},e)),[r,d,p,x]);return(0,n.jsxs)("div",{className:S().container,children:[(0,n.jsx)("div",{className:`${S().starRating} ${f}`,children:y}),l&&h>0&&(0,n.jsxs)("div",{className:S().ratingInfo,children:[(0,n.jsx)("span",{className:`${S().ratingValue} ${g}`,children:h.toFixed(1)}),void 0!==o&&(0,n.jsxs)("span",{className:S().ratingCount,children:["(",o,"명)"]})]})]})},M=(0,o.U)(),P=({mealId:e})=>{let[t,r]=(0,s.useState)(null),[a,i]=(0,s.useState)(null),[l,o]=(0,s.useState)(null),[c,d]=(0,s.useState)(!1),[u,m]=(0,s.useState)([]),h=(0,s.useRef)(!0),f=(0,s.useRef)(null);(0,s.useEffect)(()=>{(async()=>{let{data:e}=await M.auth.getUser();r(e?.user)})()},[]);let g=async()=>{if(!e)return[];try{console.log("급식 메뉴 아이템 조회 시작:",e);let{data:t,error:r}=await M.from("meal_menu_items").select("id").eq("meal_id",e);if(r)return console.error("메뉴 아이템 조회 오류:",r.message),[];if(!t||0===t.length)return console.log("메뉴 아이템이 없음"),[];return console.log("메뉴 아이템 조회 결과:",t.length,"개 항목"),t.map(e=>e.id)}catch(e){return console.error("메뉴 아이템 조회 중 오류 발생:",e),[]}},p=async()=>{if(e&&t)try{let e=await g();if(0===e.length){await b(null),m([]),i(null);return}console.log("내 메뉴 아이템 평점 조회 시작:",e.length,"개 항목");let{data:r,error:a}=await M.from("menu_item_ratings").select("menu_item_id, rating").eq("user_id",t.id).in("menu_item_id",e);if(a)return void console.error("메뉴 아이템 평점 조회 오류:",a.message);if(!r||0===r.length){console.log("메뉴 아이템 평점이 없음, 급식 평점 row 삭제"),m([]),i(null),await b(null);return}if(console.log("메뉴 아이템 평점 조회 결과:",r.length,"개 항목"),m(r),!h.current)return;let n=w(r);if(null!==n){if(await b(n),!h.current)return;i(n)}}catch(e){console.error("급식 평점 계산 및 저장 중 오류 발생:",e)}},x=async()=>{if(e&&t)try{d(!0),console.log("내 급식 평점 조회 시작:",e,t.id);let r=new AbortController;r.signal;let a=setTimeout(()=>r.abort(),1e4),{data:n,error:s}=await M.from("meal_ratings").select("rating").eq("meal_id",e).eq("user_id",t.id).maybeSingle();if(clearTimeout(a),!h.current)return;if(s&&"PGRST116"!==s.code)return void console.error("내 급식 평점 조회 오류:",s.message);n?(console.log("내 급식 평점 조회 결과:",n.rating),i(n.rating)):(console.log("내 급식 평점이 없음"),i(null))}catch(e){e?.name==="AbortError"?console.log("급식 평점 조회 요청 타임아웃"):console.error("내 급식 평점 조회 중 오류 발생:",e)}finally{h.current&&d(!1)}},y=async()=>{if(e)try{d(!0),console.log("급식 평점 통계 조회 시작:",e);let t=new AbortController;t.signal;let r=setTimeout(()=>t.abort(),1e4),{data:a,error:n}=await M.from("meal_ratings").select("rating").eq("meal_id",e);if(clearTimeout(r),!h.current)return;if(n)return void console.error("급식 평점 통계 조회 오류:",n.message);if(a&&a.length>0){let e=a.reduce((e,t)=>e+t.rating,0)/a.length;console.log("급식 평점 통계 조회 결과:",e),o(e)}else console.log("급식 평점 통계가 없음"),o(null)}catch(e){e?.name==="AbortError"?console.log("급식 평점 통계 조회 요청 타임아웃"):console.error("급식 평점 통계 조회 중 오류 발생:",e)}finally{h.current&&d(!1)}},w=e=>e&&0!==e.length?e.reduce((e,t)=>e+t.rating,0)/e.length:null,v=async r=>{if(!e||!t)return console.log("급식 ID 또는 사용자 정보가 없음"),!1;try{d(!0),console.log("급식 평점 저장 시작:",e,t.id,r);let a=new AbortController;a.signal;let n=setTimeout(()=>a.abort(),1e4),{error:s}=await M.from("meal_ratings").upsert({user_id:t.id,meal_id:e,rating:r,updated_at:new Date().toISOString()},{onConflict:"user_id,meal_id"});if(clearTimeout(n),!h.current)return!1;if(s)return console.error("급식 평점 저장 오류:",s.message),!1;console.log("급식 평점 저장 성공!");try{let a=new CustomEvent("meal-rating-change",{detail:{mealId:e,userId:t.id,rating:r}});window.dispatchEvent(a)}catch(e){console.error("이벤트 발생 중 오류:",e)}return!0}catch(e){return e?.name==="AbortError"?console.log("급식 평점 저장 요청 타임아웃"):console.error("급식 평점 저장 중 오류 발생:",e),!1}finally{h.current&&d(!1)}},b=async r=>{if(!e||!t||c)return!1;try{if(null!==r&&(r<1||r>5)){console.log("유효하지 않은 평점. 평점 삭제:",r);let{error:a}=await M.from("meal_ratings").delete().eq("user_id",t.id).eq("meal_id",e);if(a)return console.error("평점 삭제 오류:",a.message),!1;return h.current&&i(null),!0}return v(r)}catch(e){return console.error("평점 저장 또는 삭제 중 오류 발생:",e),!1}finally{h.current&&d(!1)}};(0,s.useEffect)(()=>(window.addEventListener("menu-item-rating-change",j),window.addEventListener("focus",_),()=>{h.current=!1,window.removeEventListener("menu-item-rating-change",j),window.removeEventListener("focus",_),null!==f.current&&(clearTimeout(f.current),f.current=null)}),[e,t]);let j=e=>{if(!("detail"in e)||!e.detail)return;let t=e.detail;if(t.menuItemId){if(!h.current)return void console.log("언마운트된 컴포넌트의 이벤트 처리 무시");if(console.log("메뉴 아이템 평점 변경 감지:",t),t.deleted&&a)u.length<=1&&i(null);else if(t.newRating&&!a)i(t.newRating);else if(t.newRating&&a){let e=[...u],r=e.findIndex(e=>e.menu_item_id===t.menuItemId);r>=0?e[r]={...e[r],rating:t.newRating}:e.push({menu_item_id:t.menuItemId,rating:t.newRating}),i(w(e))}null!==f.current&&(clearTimeout(f.current),f.current=null),f.current=window.setTimeout(async()=>{h.current&&(await p(),h.current&&y())},500)}},_=()=>{h.current&&(console.log("윈도우 포커스 감지 - 평점 정보 갱신"),x(),y())};return(0,s.useEffect)(()=>{t&&e&&(console.log("데이터 로드 시작:",e,"유저 ID:",t?.id),x(),p(),y(),console.log("DEBUG: 현재 사용자 상태:",t?"로그인됨":"미로그인","유저 객체:",t),console.log("DEBUG: 현재 myRating 값:",a))},[t,e]),(0,n.jsx)("div",{className:"my-4",children:(0,n.jsxs)("div",{className:"text-lg font-medium",children:["오늘 나의 평가는?",t&&null!==a&&(0,n.jsxs)("span",{className:"ml-1",children:["(",a.toFixed(1),")"]})]})})};function W({schoolCode:e,mealId:t,className:r=""}){let[a,i]=(0,s.useState)(null),[l,c]=(0,s.useState)(0),[d,u]=(0,s.useState)(""),[m,h]=(0,s.useState)(null);return((0,o.U)(),a)?(0,n.jsxs)("div",{className:`flex flex-col py-1.5 px-1 ${r} bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg`,children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"bg-indigo-100 rounded-full p-1 mr-2",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-indigo-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{d:"M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"})})}),(0,n.jsx)("span",{className:"font-medium text-sm text-gray-700",children:"전교생 평균"}),(0,n.jsx)("span",{className:"ml-2 text-lg font-bold text-indigo-700",children:a}),(0,n.jsx)("div",{className:"flex items-center ml-1 space-x-0.5",children:(t=>{let r=[],a=Math.floor(t),s=t%1>=.5;for(let e=0;e<a;e++)r.push((0,n.jsx)("svg",{className:"w-4 h-4 text-yellow-500 fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})},`full-${e}`));if(s){let t=`half-gradient-${e}`;r.push((0,n.jsxs)("svg",{className:"w-4 h-4 text-yellow-500",viewBox:"0 0 24 24",children:[(0,n.jsx)("defs",{children:(0,n.jsxs)("linearGradient",{id:t,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,n.jsx)("stop",{offset:"50%",stopColor:"currentColor",stopOpacity:"1"}),(0,n.jsx)("stop",{offset:"50%",stopColor:"currentColor",stopOpacity:"0.3"})]})}),(0,n.jsx)("path",{fill:`url(#${t})`,d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})]},"half"))}let i=5-a-!!s;for(let e=0;e<i;e++)r.push((0,n.jsx)("svg",{className:"w-4 h-4 text-gray-300 fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})},`empty-${e}`));return r})(a||0)}),(0,n.jsxs)("span",{className:"ml-1 text-xs text-gray-500",children:["(",l,"명)"]})]})}),m&&(0,n.jsx)("div",{className:"flex items-center justify-start mt-1 overflow-x-auto space-x-2 text-xs pb-1",children:[1,2,3,4,5,6].map(e=>{let t=m[`grade${e}_avg`],r=m[`grade${e}_count`];return t&&r>0?(0,n.jsxs)("div",{className:"flex items-center bg-white rounded-full px-1.5 py-0.5 border border-indigo-100",children:[(0,n.jsxs)("span",{className:"font-medium text-gray-600",children:["[",e,"학년]"]}),(0,n.jsx)("span",{className:"ml-1 font-bold text-indigo-600",children:t.toFixed(1)}),(0,n.jsxs)("span",{className:"ml-1 text-gray-400",children:["(",r,")"]})]},e):null})})]}):null}let L=(0,o.U)();function A({item:e}){let[t,r]=(0,s.useState)(null),[a,i]=(0,s.useState)(e.user_rating||null),[l,o]=(0,s.useState)(e.avg_rating||null),[c,d]=(0,s.useState)(e.rating_count||null),[u,m]=(0,s.useState)(!1),h=async(e,r)=>{try{if(!t||!t.id)return console.error("❌ 사용자 로그인 상태가 아닙니다"),alert("별점을 남기려면 로그인해주세요!"),!1;if(!e)return console.error("❌ 메뉴 아이템 ID가 없습니다"),!1;console.log("\uD83D\uDCBE 별점 저장 시도:",e,r);let{error:a}=await L.from("menu_item_ratings").upsert({user_id:t.id,menu_item_id:e,rating:r,updated_at:new Date().toISOString()},{onConflict:"user_id,menu_item_id"});if(a)return console.error("❌ 저장 오류:",a.message),!1;return console.log("✅ 별점 저장 성공!"),!0}catch(e){return console.error("❌ 별점 저장 중 오류:",e),!1}},f=async e=>{try{if(!t||!t.id)return console.error("❌ 사용자 로그인 상태가 아닙니다"),alert("별점을 남기려면 로그인해주세요!"),!1;if(!e)return console.error("❌ 메뉴 아이템 ID가 없습니다"),!1;console.log("\uD83D\uDDD1️ 별점 삭제 시도:",e);let{error:r}=await L.from("menu_item_ratings").delete().eq("user_id",t.id).eq("menu_item_id",e);if(r)return console.error("❌ 삭제 오류:",r.message),!1;console.log("\uD83D\uDD04 메뉴 아이템 별점 삭제 성공, 급식 평점 재계산 필요");let a=new CustomEvent("menu-item-rating-change",{detail:{menuItemId:e,deleted:!0}});return window.dispatchEvent(a),console.log("✅ 별점 삭제 성공!"),!0}catch(e){return console.error("❌ 별점 삭제 중 오류:",e),!1}},g=async e=>{try{if(console.log("➡️ 별점 정보 조회 시도 - 메뉴아이템 ID:",e),!e)return console.error("메뉴아이템 ID가 없습니다."),null;let{data:r,error:a}=await L.from("menu_item_ratings").select("rating").eq("menu_item_id",e);if(a)return console.error("평점 데이터 조회 오류:",a.message),null;let n=r||[],s=0;if(n.length>0){let e=n.reduce((e,t)=>e+t.rating,0)/n.length;s=Math.round(10*e)/10}let i=n.length;console.log("계산된 통계:",{avgRating:s,ratingCount:i});let l=null;if(t&&t.id){let{data:r,error:a}=await L.from("menu_item_ratings").select("rating").eq("menu_item_id",e).eq("user_id",t.id).limit(1);a?console.error("❌ 사용자 별점 조회 오류:",a.message):r&&r.length>0?(l=r[0].rating,console.log("✅ 사용자 별점 조회 성공:",l)):console.log("ℹ️ 사용자 별점 기록 없음")}else console.log("로그인되지 않아 사용자 별점을 조회하지 않습니다.");let o={avg_rating:s,rating_count:i,user_rating:l};return console.log("✅ 최종 별점 조회 결과:",o),o}catch(e){return console.error("별점 정보 조회 오류:",e),{avg_rating:0,rating_count:0,user_rating:null}}},p=async r=>{try{if(!t)return void alert("별점을 남기려면 로그인해주세요!");if(!e.id)return void console.error("메뉴 아이템 ID가 없습니다");if(console.log("⭐ 별점 선택:",r),m(!0),a===r){i(null),await f(e.id),console.log("클릭한 별점이 이미 저장된 별점과 같음, 별점 삭제 시도");let t=new CustomEvent("menu-item-rating-change",{detail:{menuItemId:e.id,deleted:!0,previousRating:a}});window.dispatchEvent(t),await f(e.id)?(console.log("별점 삭제 성공, UI 이미 업데이트됨"),setTimeout(async()=>{await g(e.id)},500)):(console.warn("별점 삭제 실패, 이전 상태 유지"),i(a),await g(e.id))}else{if(i(r),l&&c){let e=l*c,t=null===a?c+1:c,n=(null===a?e+r:e-a+r)/t;o(Math.round(10*n)/10),d(t)}else o(r),d(1);console.log("새로운 별점 저장 시도:",r);let t=new CustomEvent("menu-item-rating-change",{detail:{menuItemId:e.id,newRating:r,previousRating:a}});window.dispatchEvent(t),await h(e.id,r)?(console.log("별점 저장 성공, UI 이미 업데이트됨"),setTimeout(async()=>{await g(e.id)},500)):(console.warn("별점 저장 실패, 이전 상태로 복원"),i(a),await g(e.id))}}catch(e){console.error("별점 처리 중 오류:",e)}finally{m(!1)}};return(0,n.jsxs)("li",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"rating-container mr-3",children:(0,n.jsx)(C,{value:a||0,onChange:p,interactive:!0,showValue:!1,size:"medium"})}),(0,n.jsx)("div",{className:"text-gray-700",children:e.item_name})]}),l&&c?(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:[l.toFixed(1)," (",c,"명)"]}):null]})}function I({meal:e,onShowOrigin:t,onShowNutrition:r,onUploadSuccess:a,onUploadError:i}){let l=(0,s.useCallback)(()=>{console.log("\uD83D\uDCE3 이미지 변경 알림 받음"),a&&a()},[a]);return(0,n.jsx)("div",{className:"bg-white overflow-hidden",children:(0,n.jsxs)("div",{className:"p-2",children:[(0,n.jsx)(W,{schoolCode:e.school_code,mealId:e.id,className:"mb-2"}),(0,n.jsx)(h,{mealId:e.id,schoolCode:e.school_code,mealDate:e.meal_date,mealType:e.meal_type,onUploadSuccess:l,onUploadError:i},`uploader-${e.id}-${e.meal_date}`),(0,n.jsxs)("div",{className:"flex justify-between items-center my-2 text-xs",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[e.origin_info&&(0,n.jsx)("button",{onClick:()=>t(e.origin_info),className:"text-xs px-1 py-0.5 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:"원산지"}),(e.kcal||e.ntr_info)&&(0,n.jsx)("button",{onClick:()=>r(e),className:"text-xs px-1 py-0.5 bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors",children:"영양정보"})]}),e.kcal&&(0,n.jsxs)("div",{className:"bg-orange-100 text-orange-800 text-xs px-1.5 py-0.5 rounded",children:[e.kcal,"kcal"]})]}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)(P,{mealId:e.id})}),(0,n.jsx)("div",{className:"mb-2",children:(0,n.jsx)("ul",{className:"space-y-2",children:e.menuItems&&e.menuItems.length>0?e.menuItems.map(e=>(0,n.jsx)(A,{item:e},e.id)):e.menu_items.map((e,t)=>(0,n.jsx)("li",{className:"text-gray-700",children:e},t))})})]})})}console.log("MealCard 컴포넌트 로드됨, Supabase 클라이언트 초기화");let D=e=>{if(!e)return e;let t=e;8!==e.length||e.includes("-")||(t=`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`);let r=new Date(t);if(isNaN(r.getTime()))return t;let a=["일","월","화","수","목","금","토"][r.getDay()];return`${t} (${a})`},E=e=>e?8!==e.length||e.includes("-")?e.replace(/-/g,""):(console.log(`이미 API 형식인 날짜: ${e}`),e):"";async function q(e,t={}){let r=void 0!==a?a:fetch;try{if((e.includes("/rest/v1/")||e.includes("izkumvvlkrkgiuuczffp.supabase.co/rest/v1/"))&&!e.includes("apikey="))if(["/meal_images","/profiles","/menu_item_ratings"].some(t=>e.includes(t)))console.debug("예외 처리 엔드포인트 요청 허용 (fetchWithAuth):",e);else{let r=!1;if(t.headers&&(r=t.headers instanceof Headers?t.headers.has("apikey")||t.headers.has("authorization"):Object.entries(t.headers).some(([e,t])=>"string"==typeof e&&("apikey"===e.toLowerCase()||"authorization"===e.toLowerCase()))),!r)return console.warn("API 키 없는 요청 차단 (fetchWithAuth):",e,t.headers),new Response(JSON.stringify({error:"No API key found in request",message:"API 키가 필요한 요청입니다. 인증 정보를 확인하세요. (Generated by fetchWithAuth)"}),{status:401})}let a=await r(e,t);if((404===a.status||406===a.status)&&(e.includes("/meal_images")||e.includes("/comment_likes")))return console.debug(`${a.status} 오류 정상 처리 - ${e.includes("/meal_images")?"이미지":"좋아요"} 요청:`,e),new Response(JSON.stringify({data:e.includes("select=id")?null:[]}),{status:200,headers:{"Content-Type":"application/json"}});if(406===a.status&&"undefined"!=typeof navigator&&navigator.userAgent&&(navigator.userAgent.includes("Whale")||navigator.userAgent.includes("NAVER")))return console.debug("웨일 브라우저 특수 406 오류 정상 처리:",e),new Response(JSON.stringify({data:[]}),{status:200,headers:{"Content-Type":"application/json"}});return a}catch(e){return console.error("API 요청 오류:",e),new Response(JSON.stringify({error:"API request failed",message:"네트워크 오류가 발생했습니다. 잠시 후 다시 시도해주세요."}),{status:500})}}let T={MEALS:"/api/meals"};function O({onSubmit:e,placeholder:t="댓글 추가...",buttonText:r="댓글"}){let[a,i]=(0,s.useState)(""),[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),m=(0,s.useRef)(null),[h,f]=(0,s.useState)(null),[g,p]=(0,s.useState)("?");(0,o.U)();let x=async t=>{if(t.preventDefault(),a.trim()&&!l)try{c(!0),await e(a)&&(i(""),u(!1),m.current&&(m.current.style.height="auto"))}finally{c(!1)}};return(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0 w-8 h-8 overflow-hidden rounded-full",children:h?(0,n.jsx)("img",{src:h,alt:"프로필",className:"w-full h-full object-cover",onError:e=>{e.target.src="/default-avatar.png"}}):(0,n.jsx)("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center text-gray-500",children:g})}),(0,n.jsxs)("form",{onSubmit:x,className:"flex-grow",children:[(0,n.jsx)("div",{className:`border-b ${d?"border-black":"border-gray-300"} transition-all duration-200`,children:(0,n.jsx)("textarea",{ref:m,value:a,onChange:e=>i(e.target.value),onFocus:()=>u(!0),placeholder:t,className:"w-full p-2 focus:outline-none resize-none overflow-hidden min-h-[36px]",rows:1})}),d&&(0,n.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{i(""),u(!1),m.current&&(m.current.blur(),m.current.style.height="auto")},className:"px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-full",children:"취소"}),(0,n.jsx)("button",{type:"submit",disabled:!a.trim()||l,className:`px-3 py-1.5 text-sm font-medium rounded-full ${!a.trim()||l?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:l?"게시 중...":r})]})]})]})}let z=Symbol.for("constructDateFrom");function R(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&z in e?e[z](t):e instanceof Date?new e.constructor(t):new Date(t)}let $={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function F(e){return (t={})=>{let r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}let U={date:F({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:F({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:F({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},B={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function X(e){return(t,r)=>{let a;if("formatting"===(r?.context?String(r.context):"standalone")&&e.formattingValues){let t=e.defaultFormattingWidth||e.defaultWidth,n=r?.width?String(r.width):t;a=e.formattingValues[n]||e.formattingValues[t]}else{let t=e.defaultWidth,n=r?.width?String(r.width):e.defaultWidth;a=e.values[n]||e.values[t]}return a[e.argumentCallback?e.argumentCallback(t):t]}}function H(e){return(t,r={})=>{let a,n=r.width,s=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],i=t.match(s);if(!i)return null;let l=i[0],o=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(o)?function(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}(o,e=>e.test(l)):function(e,t){for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}(o,e=>e.test(l));return a=e.valueCallback?e.valueCallback(c):c,{value:a=r.valueCallback?r.valueCallback(a):a,rest:t.slice(l.length)}}}let J={code:"en-US",formatDistance:(e,t,r)=>{let a,n=$[e];if(a="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",t.toString()),r?.addSuffix)if(r.comparison&&r.comparison>0)return"in "+a;else return a+" ago";return a},formatLong:U,formatRelative:(e,t,r,a)=>B[e],localize:{ordinalNumber:(e,t)=>{let r=Number(e),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},era:X({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:X({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:X({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:X({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:X({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:function(e){return(t,r={})=>{let a=t.match(e.matchPattern);if(!a)return null;let n=a[0],s=t.match(e.parsePattern);if(!s)return null;let i=e.valueCallback?e.valueCallback(s[0]):s[0];return{value:i=r.valueCallback?r.valueCallback(i):i,rest:t.slice(n.length)}}}({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:H({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:H({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:H({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:H({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:H({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},V={};function Y(e,t){return R(t||e,e)}function G(e){let t=Y(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),e-r}function Q(e,...t){let r=R.bind(null,e||t.find(e=>"object"==typeof e));return t.map(r)}function Z(e,t){let r=Y(e)-Y(t);return r<0?-1:r>0?1:r}function K(e,t){return function(e,t,r){let a,n=r?.locale??V.locale??J,s=Z(e,t);if(isNaN(s))throw RangeError("Invalid time value");let i=Object.assign({},r,{addSuffix:r?.addSuffix,comparison:s}),[l,o]=Q(r?.in,...s>0?[t,e]:[e,t]),c=function(e,t,r){var a;return(a=void 0,e=>{let t=(a?Math[a]:Math.trunc)(e);return 0===t?0:t})((Y(e)-Y(t))/1e3)}(o,l),d=Math.round((c-(G(o)-G(l))/1e3)/60);if(d<2)if(r?.includeSeconds)if(c<5)return n.formatDistance("lessThanXSeconds",5,i);else if(c<10)return n.formatDistance("lessThanXSeconds",10,i);else if(c<20)return n.formatDistance("lessThanXSeconds",20,i);else if(c<40)return n.formatDistance("halfAMinute",0,i);else if(c<60)return n.formatDistance("lessThanXMinutes",1,i);else return n.formatDistance("xMinutes",1,i);else if(0===d)return n.formatDistance("lessThanXMinutes",1,i);else return n.formatDistance("xMinutes",d,i);if(d<45)return n.formatDistance("xMinutes",d,i);if(d<90)return n.formatDistance("aboutXHours",1,i);if(d<1440){let e=Math.round(d/60);return n.formatDistance("aboutXHours",e,i)}if(d<2520)return n.formatDistance("xDays",1,i);else if(d<43200){let e=Math.round(d/1440);return n.formatDistance("xDays",e,i)}else if(d<86400)return a=Math.round(d/43200),n.formatDistance("aboutXMonths",a,i);if((a=function(e,t,r){let[a,n,s]=Q(void 0,e,e,t),i=Z(n,s),l=Math.abs(function(e,t,r){let[a,n]=Q(void 0,e,t);return 12*(a.getFullYear()-n.getFullYear())+(a.getMonth()-n.getMonth())}(n,s));if(l<1)return 0;1===n.getMonth()&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-i*l);let o=Z(n,s)===-i;(function(e,t){let r=Y(e,void 0);return+function(e,t){let r=Y(e,t?.in);return r.setHours(23,59,59,999),r}(r,void 0)==+function(e,t){let r=Y(e,t?.in),a=r.getMonth();return r.setFullYear(r.getFullYear(),a+1,0),r.setHours(23,59,59,999),r}(r,t)})(a)&&1===l&&1===Z(a,s)&&(o=!1);let c=i*(l-o);return 0===c?0:c}(o,l))<12){let e=Math.round(d/43200);return n.formatDistance("xMonths",e,i)}{let e=a%12,t=Math.trunc(a/12);return e<3?n.formatDistance("aboutXYears",t,i):e<9?n.formatDistance("overXYears",t,i):n.formatDistance("almostXYears",t+1,i)}}(e,R(e,Date.now()),t)}var ee={lessThanXSeconds:{one:"1초 미만",other:"{{count}}초 미만"},xSeconds:{one:"1초",other:"{{count}}초"},halfAMinute:"30초",lessThanXMinutes:{one:"1분 미만",other:"{{count}}분 미만"},xMinutes:{one:"1분",other:"{{count}}분"},aboutXHours:{one:"약 1시간",other:"약 {{count}}시간"},xHours:{one:"1시간",other:"{{count}}시간"},xDays:{one:"1일",other:"{{count}}일"},aboutXWeeks:{one:"약 1주",other:"약 {{count}}주"},xWeeks:{one:"1주",other:"{{count}}주"},aboutXMonths:{one:"약 1개월",other:"약 {{count}}개월"},xMonths:{one:"1개월",other:"{{count}}개월"},aboutXYears:{one:"약 1년",other:"약 {{count}}년"},xYears:{one:"1년",other:"{{count}}년"},overXYears:{one:"1년 이상",other:"{{count}}년 이상"},almostXYears:{one:"거의 1년",other:"거의 {{count}}년"}};function et(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}var er={date:et({formats:{full:"y년 M월 d일 EEEE",long:"y년 M월 d일",medium:"y.MM.dd",short:"y.MM.dd"},defaultWidth:"full"}),time:et({formats:{full:"a H시 mm분 ss초 zzzz",long:"a H:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:et({formats:{full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},defaultWidth:"full"})},ea={lastWeek:"'지난' eeee p",yesterday:"'어제' p",today:"'오늘' p",tomorrow:"'내일' p",nextWeek:"'다음' eeee p",other:"P"};function en(e){return function(t,r){var a;if("formatting"===(null!=r&&r.context?String(r.context):"standalone")&&e.formattingValues){var n=e.defaultFormattingWidth||e.defaultWidth,s=null!=r&&r.width?String(r.width):n;a=e.formattingValues[s]||e.formattingValues[n]}else{var i=e.defaultWidth,l=null!=r&&r.width?String(r.width):e.defaultWidth;a=e.values[l]||e.values[i]}return a[e.argumentCallback?e.argumentCallback(t):t]}}function es(e){return function(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.width,s=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],i=t.match(s);if(!i)return null;var l=i[0],o=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(o)?function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return r}(o,function(e){return e.test(l)}):function(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return r}(o,function(e){return e.test(l)});return r=e.valueCallback?e.valueCallback(c):c,{value:r=a.valueCallback?a.valueCallback(r):r,rest:t.slice(l.length)}}}let ei={code:"ko",formatDistance:function(e,t,r){var a,n=ee[e];if(a="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",t.toString()),null!=r&&r.addSuffix)if(r.comparison&&r.comparison>0)return a+" 후";else return a+" 전";return a},formatLong:er,formatRelative:function(e,t,r,a){return ea[e]},localize:{ordinalNumber:function(e,t){var r=Number(e);switch(String(null==t?void 0:t.unit)){case"minute":case"second":return String(r);case"date":return r+"일";default:return r+"번째"}},era:en({values:{narrow:["BC","AD"],abbreviated:["BC","AD"],wide:["기원전","서기"]},defaultWidth:"wide"}),quarter:en({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1분기","2분기","3분기","4분기"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:en({values:{narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],wide:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"]},defaultWidth:"wide"}),day:en({values:{narrow:["일","월","화","수","목","금","토"],short:["일","월","화","수","목","금","토"],abbreviated:["일","월","화","수","목","금","토"],wide:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"]},defaultWidth:"wide"}),dayPeriod:en({values:{narrow:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"},abbreviated:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"},wide:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"}},defaultWidth:"wide",formattingValues:{narrow:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"},abbreviated:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"},wide:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:function(e){return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.match(e.matchPattern);if(!a)return null;var n=a[0],s=t.match(e.parsePattern);if(!s)return null;var i=e.valueCallback?e.valueCallback(s[0]):s[0];return{value:i=r.valueCallback?r.valueCallback(i):i,rest:t.slice(n.length)}}}({matchPattern:/^(\d+)(일|번째)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:es({matchPatterns:{narrow:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(기원전|서기)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^(bc|기원전)/i,/^(ad|서기)/i]},defaultParseWidth:"any"}),quarter:es({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234]사?분기/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:es({matchPatterns:{narrow:/^(1[012]|[123456789])/,abbreviated:/^(1[012]|[123456789])월/i,wide:/^(1[012]|[123456789])월/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^1월?$/,/^2/,/^3/,/^4/,/^5/,/^6/,/^7/,/^8/,/^9/,/^10/,/^11/,/^12/]},defaultParseWidth:"any"}),day:es({matchPatterns:{narrow:/^[일월화수목금토]/,short:/^[일월화수목금토]/,abbreviated:/^[일월화수목금토]/,wide:/^[일월화수목금토]요일/},defaultMatchWidth:"wide",parsePatterns:{any:[/^일/,/^월/,/^화/,/^수/,/^목/,/^금/,/^토/]},defaultParseWidth:"any"}),dayPeriod:es({matchPatterns:{any:/^(am|pm|오전|오후|자정|정오|아침|저녁|밤)/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^(am|오전)/i,pm:/^(pm|오후)/i,midnight:/^자정/i,noon:/^정오/i,morning:/^아침/i,afternoon:/^오후/i,evening:/^저녁/i,night:/^밤/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function el({count:e,isLiked:t,onToggle:r,disabled:a=!1}){return(0,n.jsxs)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},disabled:a,className:`flex items-center ${a?"opacity-50 cursor-not-allowed":""}`,"aria-label":t?"좋아요 취소":"좋아요",children:[(0,n.jsx)("span",{className:"mr-1 flex items-center justify-center w-5 h-5",children:t?(0,n.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 fill-blue-600",children:(0,n.jsx)("path",{d:"M7,22 L3,22 L3,10 L7,10 L7,22 Z M19.7507342,10.4137392 L14.2618608,10.4137392 L14.9110375,6.35765469 C15.1310205,4.93928291 14.06216,3.66896766 12.7595814,3.18316087 C12.5176311,3.09761964 12.2590594,3.04519397 12,3.04519397 C11.3357497,3.04519397 10.738532,3.43708398 10.4594998,4.02922829 L7.1282278,10 L10,10 L10,19.5 C10.8370479,19.5 11.5426519,19.5 12.0000108,19.5 C12.5624172,19.5 13.1374733,19.4344721 13.7251792,19.3033241 C14.5511793,19.1178695 21,17.9572276 21,17.9572276 L21,12.0643062 C21,12.0643062 20.7096832,10.7093823 19.7507342,10.4137392 Z"})}):(0,n.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 stroke-gray-500 fill-none",strokeWidth:"1.5",children:(0,n.jsx)("path",{d:"M7,22 L3,22 L3,10 L7,10 L7,22 Z M19.7507342,10.4137392 L14.2618608,10.4137392 L14.9110375,6.35765469 C15.1310205,4.93928291 14.06216,3.66896766 12.7595814,3.18316087 C12.5176311,3.09761964 12.2590594,3.04519397 12,3.04519397 C11.3357497,3.04519397 10.738532,3.43708398 10.4594998,4.02922829 L7.1282278,10 L10,10 L10,19.5 C10.8370479,19.5 11.5426519,19.5 12.0000108,19.5 C12.5624172,19.5 13.1374733,19.4344721 13.7251792,19.3033241 C14.5511793,19.1178695 21,17.9572276 21,17.9572276 L21,12.0643062 C21,12.0643062 20.7096832,10.7093823 19.7507342,10.4137392 Z"})})}),(0,n.jsx)("span",{className:"text-xs text-gray-700",children:e})]})}function eo({onSubmit:e,autoFocus:t=!0,placeholder:r="답글 추가...",buttonText:a="답글"}){let[i,l]=(0,s.useState)(""),[d,u]=(0,s.useState)(!1),[m,h]=(0,s.useState)(!1),f=(0,s.useRef)(null),{user:g}=c();(0,o.U)();let[p,x]=(0,s.useState)({}),y=async t=>{if(t.preventDefault(),i.trim()&&!d)try{u(!0),await e(i)&&(l(""),h(!1),f.current&&(f.current.style.height="auto"))}finally{u(!1)}};return(0,n.jsxs)("div",{className:"flex items-start gap-2 mt-2",children:[(0,n.jsx)("div",{className:"flex-shrink-0 w-6 h-6 overflow-hidden rounded-full",children:p.avatarUrl?(0,n.jsx)("img",{src:p.avatarUrl,alt:"프로필",className:"w-full h-full object-cover",onError:e=>{e.target.src="/default-avatar.png"}}):(0,n.jsx)("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center text-gray-500 text-xs",children:p.name?.[0]||p.email?.[0]?.toUpperCase()||"?"})}),(0,n.jsxs)("form",{onSubmit:y,className:"flex-grow",children:[(0,n.jsx)("div",{className:`border-b ${m?"border-black":"border-gray-300"} transition-all duration-200`,children:(0,n.jsx)("textarea",{ref:f,value:i,onChange:e=>l(e.target.value),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),y(e))},onFocus:()=>h(!0),placeholder:r,className:"w-full p-2 focus:outline-none resize-none overflow-hidden min-h-[36px] text-sm",rows:1})}),m&&(0,n.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{l(""),h(!1),f.current&&(f.current.blur(),f.current.style.height="auto")},className:"px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-full",children:"취소"}),(0,n.jsx)("button",{type:"submit",disabled:!i.trim()||d,className:`px-3 py-1 text-sm font-medium rounded-full ${!i.trim()||d?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:d?"게시 중...":a})]})]})]})}function ec({reply:e,onReplyChange:t,schoolCode:r}){let[a,i]=(0,s.useState)(!1),[l,d]=(0,s.useState)(e.content),[u,m]=(0,s.useState)(e.user_has_liked),[h,f]=(0,s.useState)(e.likes_count),[g,p]=(0,s.useState)(!1),[x,y]=(0,s.useState)(!1),[w,v]=(0,s.useState)(!1),{user:b,userSchool:j}=c(),_=(0,o.U)(),N=j&&r&&j.school_code===r,k=b&&b.id===e.user_id,S=K(new Date(e.created_at),{addSuffix:!0,locale:ei}),C=async r=>{if(r.preventDefault(),l.trim()&&b&&k)try{let{error:r}=await _.from("comment_replies").update({content:l.trim(),updated_at:new Date().toISOString()}).eq("id",e.id);if(r)throw r;i(!1),t()}catch(e){console.error("답글 수정 중 오류:",e)}},M=async()=>{if(b&&k&&window.confirm("정말로 이 답글을 삭제하시겠습니까?"))try{let{error:r}=await _.from("comment_replies").delete().eq("id",e.id);if(r)throw r;t()}catch(e){console.error("답글 삭제 중 오류:",e)}},P=async()=>{if(b&&b.id&&!g){p(!0);try{let t=!u;if(m(t),f(e=>t?e+1:e-1),u){let{error:r}=await _.from("reply_likes").delete().eq("reply_id",e.id).eq("user_id",b.id);if(r)throw m(!t),f(e=>t?e-1:e+1),r}else{let{error:r}=await _.from("reply_likes").insert({reply_id:e.id,user_id:b.id});if(r)throw m(!t),f(e=>t?e-1:e+1),r}}catch(e){console.error("좋아요 처리 중 오류:",e)}finally{p(!1)}}},W=async r=>{if(!b||!r.trim())return!1;try{let{data:a,error:n}=await _.from("comment_replies").insert({comment_id:e.comment_id,user_id:b.id,content:r.trim(),parent_id:e.id});if(n)throw n;return t(),v(!1),!0}catch(e){return console.error("답글 작성 중 오류:",e),!1}};return(0,n.jsx)("div",{className:"py-2 pl-8 border-l border-gray-200",children:a?(0,n.jsxs)("form",{onSubmit:C,className:"mt-2",children:[(0,n.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),className:"w-full p-2 border border-gray-300 rounded",autoFocus:!0}),(0,n.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,n.jsx)("button",{type:"submit",className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600",children:"저장"}),(0,n.jsx)("button",{type:"button",onClick:()=>{i(!1),d(e.content)},className:"px-3 py-1 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300",children:"취소"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("div",{className:"mr-2",children:e.user.user_metadata?.avatar_url?(0,n.jsx)("img",{src:e.user.user_metadata.avatar_url,alt:"프로필",className:"w-5 h-5 rounded-full"}):(0,n.jsx)("div",{className:"w-5 h-5 bg-gray-200 rounded-full flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-xs text-gray-500",children:e.user.user_metadata?.name?.[0]||e.user.email[0]?.toUpperCase()||"?"})})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-xs text-gray-700",children:e.user.user_metadata?.name||e.user.email?.split("@")[0]||"사용자"}),(0,n.jsx)("span",{className:"ml-2 text-xs text-gray-400",children:S})]}),k&&!a&&(0,n.jsxs)("div",{className:"relative reply-menu",children:[(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),y(!x)},className:"text-gray-500 hover:text-gray-700 p-1",children:(0,n.jsx)("span",{className:"text-xl leading-none",children:"⋮"})}),x&&(0,n.jsxs)("div",{className:"absolute right-0 top-6 bg-white shadow-md rounded-md py-1 z-10 w-20",children:[(0,n.jsx)("button",{onClick:()=>{i(!0),y(!1)},className:"w-full text-left px-3 py-1 text-xs hover:bg-gray-100 text-gray-700",children:"수정"}),(0,n.jsx)("button",{onClick:()=>{M(),y(!1)},className:"w-full text-left px-3 py-1 text-xs hover:bg-gray-100 text-red-500",children:"삭제"})]})]})]}),(0,n.jsx)("p",{className:"mt-1 text-sm font-medium break-words whitespace-pre-wrap",children:e.content}),(0,n.jsxs)("div",{className:"mt-1 flex items-center gap-3",children:[(0,n.jsx)(el,{count:h,isLiked:u,onToggle:b&&N?P:()=>{alert("해당 학교 학생만 좋아요를 할 수 있습니다.")},disabled:g}),b&&N&&(0,n.jsxs)("button",{onClick:()=>v(!w),className:"text-gray-500 hover:text-gray-700 flex items-center gap-1",title:"답글 작성",children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 fill-current",children:(0,n.jsx)("path",{d:"M3,17.25 L3,21 L6.75,21 L17.81,9.94 L14.06,6.19 L3,17.25 Z M21.41,6.34 L17.66,2.59 C17.2706655,2.20798298 16.6593396,2.20857968 16.27,2.59 L13.13,5.73 L16.88,9.48 L20.02,6.34 C20.4,5.96 20.4,5.34 20.02,4.96 L21.41,6.34 Z"})}),(0,n.jsx)("span",{className:"text-xs",children:w?"취소":"답글"})]})]})]})]}),w&&b&&N&&(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(eo,{onSubmit:W,placeholder:"답글 추가...",buttonText:"답글"})})]})})}function ed({comment:e,onCommentChange:t,schoolCode:r}){let[a,i]=(0,s.useState)(!1),[l,d]=(0,s.useState)(e.content),[u,m]=(0,s.useState)(!1),[h,f]=(0,s.useState)(!1),[g,p]=(0,s.useState)(e.user_has_liked),[x,y]=(0,s.useState)(e.likes_count),[w,v]=(0,s.useState)(!1),[b,j]=(0,s.useState)([]),[_,N]=(0,s.useState)(e.replies_count),[k,S]=(0,s.useState)(!1),{user:C,userSchool:M}=c(),P=(0,o.U)(),W=M&&r&&M.school_code===r,L=C&&C.id===e.user_id,A=K(new Date(e.created_at),{addSuffix:!0,locale:ei}),I=async()=>{try{let{count:t,error:r}=await P.from("comment_likes").select("*",{count:"exact",head:!0}).eq("comment_id",e.id);if(r)throw r;y(t||0)}catch(e){console.error("댓글 좋아요 개수 가져오기 오류:",e)}},D=async()=>{if(C&&C.id&&!w){v(!0);try{let t=!g;if(p(t),y(e=>t?e+1:Math.max(0,e-1)),t){let{error:t}=await P.from("comment_likes").insert({comment_id:e.id,user_id:C.id});t&&(console.error("좋아요 추가 오류:",t),p(!1),y(e=>Math.max(0,e-1)))}else{let{error:t}=await P.from("comment_likes").delete().eq("comment_id",e.id).eq("user_id",C.id);t&&(console.error("좋아요 취소 오류:",t),p(!0),y(e=>e+1))}I()}catch(e){console.error("좋아요 처리 중 오류:",e)}finally{v(!1)}}},E=async()=>{if(L&&l.trim())try{let{error:r}=await P.from("comments").update({content:l.trim(),updated_at:new Date().toISOString()}).eq("id",e.id);if(r)throw r;i(!1),t()}catch(e){console.error("댓글 수정 중 오류:",e)}},q=async()=>{if(C&&L&&window.confirm("정말로 이 댓글을 삭제하시겠습니까?"))try{let{error:r}=await P.from("comments").delete().eq("id",e.id);if(r)throw r;t()}catch(e){console.error("댓글 삭제 중 오류:",e)}},T=async()=>{if(e.id&&!k)try{S(!0);let{data:t,error:r}=await P.from("comment_replies").select("id, content, created_at, user_id, comment_id").eq("comment_id",e.id).eq("is_deleted",!1).order("created_at",{ascending:!0});if(r)throw r;let a=[];if(t&&t.length>0){let e=t.map(e=>e.user_id),{data:r,error:n}=await P.from("users").select("id, email, nickname, profile_image").in("id",e);n?console.error("사용자 정보 가져오기 오류:",n):a=r||[]}let n=t.map(e=>e.id),s={};if(n.length>0){let{data:e,error:t}=await P.from("reply_likes").select("reply_id").in("reply_id",n);if(t)throw t;s=e.reduce((e,t)=>(e[t.reply_id]=(e[t.reply_id]||0)+1,e),{})}let i={};if(C&&C.id&&n.length>0){let{data:e,error:t}=await P.from("reply_likes").select("reply_id").in("reply_id",n).eq("user_id",C.id);if(t)throw t;i=(e||[]).reduce((e,t)=>(e[t.reply_id]=!0,e),{})}let l=t.map(e=>{let t=a.find(t=>t.id===e.user_id)||null;return{id:e.id,content:e.content,created_at:e.created_at,user_id:e.user_id,comment_id:e.comment_id,user:{id:t?.id||e.user_id||"",email:t?.email||"",user_metadata:{name:t?.nickname||"",avatar_url:t?.profile_image||""}},likes_count:s[e.id]||0,user_has_liked:!!i[e.id]}});j(l),N(l.length)}catch(e){console.error("답글 불러오기 오류:",e)}finally{S(!1)}},O=async r=>{if(!C||!C.id||!e.id||!r.trim())return!1;try{let{error:a}=await P.from("comment_replies").insert({comment_id:e.id,user_id:C.id,content:r.trim()});if(a)throw a;return await T(),N(e=>e+1),t(),!0}catch(e){return console.error("답글 추가 중 오류:",e),!1}},z=()=>{T()},[R,$]=(0,s.useState)(!1);return(0,n.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100",children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:e.user?.user_metadata?.avatar_url?(0,n.jsx)("img",{src:e.user.user_metadata.avatar_url,alt:"프로필",className:"h-6 w-6 rounded-full"}):(0,n.jsx)("div",{className:"h-6 w-6 rounded-full bg-gray-200 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-gray-500 text-xs",children:e.user?.user_metadata?.name?.charAt(0)||"?"})})}),(0,n.jsxs)("div",{className:"ml-2",children:[(0,n.jsx)("span",{className:"text-xs text-gray-700",children:e.user?.user_metadata?.name||"익명"}),(0,n.jsx)("span",{className:"ml-2 text-xs text-gray-400",children:A})]})]}),L&&!a&&(0,n.jsxs)("div",{className:"relative comment-menu",children:[(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),$(!R)},className:"text-gray-500 hover:text-gray-700 p-1",children:(0,n.jsx)("span",{className:"text-xl leading-none",children:"⋮"})}),R&&(0,n.jsxs)("div",{className:"absolute right-0 top-6 bg-white shadow-md rounded-md py-1 z-10 w-20",children:[(0,n.jsx)("button",{onClick:()=>{i(!0),$(!1)},className:"w-full text-left px-3 py-1 text-xs hover:bg-gray-100 text-gray-700",children:"수정"}),(0,n.jsx)("button",{onClick:()=>{q(),$(!1)},className:"w-full text-left px-3 py-1 text-xs hover:bg-gray-100 text-red-500",children:"삭제"})]})]})]}),a?(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("textarea",{value:l,onChange:e=>d(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3}),(0,n.jsxs)("div",{className:"mt-2 flex justify-end space-x-2",children:[(0,n.jsx)("button",{onClick:()=>i(!1),className:"px-3 py-1 text-xs text-gray-600 hover:text-gray-900",children:"취소"}),(0,n.jsx)("button",{onClick:E,className:"px-3 py-1 text-xs bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"저장"})]})]}):(0,n.jsx)("p",{className:"mt-2 text-sm font-medium text-gray-800 whitespace-pre-wrap break-words",children:e.content}),(0,n.jsx)("div",{className:"mt-2 flex items-center",children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(el,{count:x,isLiked:g,onToggle:C&&W?D:()=>{alert("해당 학교 학생만 좋아요를 할 수 있습니다.")},disabled:w}),_>0?(0,n.jsx)("button",{onClick:()=>{u||0!==b.length||T(),m(!u)},className:"text-sm text-gray-600 hover:text-gray-900 flex items-center",children:(0,n.jsxs)("span",{children:["답글 ",_,"개>"]})}):(0,n.jsx)("button",{onClick:()=>{u||0!==b.length||T(),m(!u)},className:"text-sm text-gray-600 hover:text-gray-900 flex items-center opacity-0 hover:opacity-50",children:(0,n.jsx)("span",{children:"답글 >"})}),C&&W&&(0,n.jsxs)("button",{className:"text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1",onClick:()=>{f(!h),u||(m(!0),0===b.length&&T())},title:"답글 작성",children:[(0,n.jsx)("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 fill-current",children:(0,n.jsx)("path",{d:"M3,17.25 L3,21 L6.75,21 L17.81,9.94 L14.06,6.19 L3,17.25 Z M21.41,6.34 L17.66,2.59 C17.2706655,2.20798298 16.6593396,2.20857968 16.27,2.59 L13.13,5.73 L16.88,9.48 L20.02,6.34 C20.4,5.96 20.4,5.34 20.02,4.96 L21.41,6.34 Z"})}),(0,n.jsxs)("span",{className:"text-xs",children:["답글 ",h?"접기":"작성"]})]})]})}),u&&(0,n.jsxs)("div",{className:"mt-1 ml-5 pl-3 relative",children:[(0,n.jsx)("div",{className:"absolute left-0 top-0 h-full",style:{width:"16px"},children:(0,n.jsx)("svg",{width:"16",height:"100%",className:"overflow-visible",children:(0,n.jsx)("path",{d:"M1,0 L1,100% Q1,100% 9,100%",stroke:"#e5e7eb",strokeWidth:"1.5",fill:"none"})})}),h&&C&&W&&(0,n.jsx)(eo,{onSubmit:O}),k?(0,n.jsx)("p",{className:"text-sm text-gray-500 py-2",children:"답글을 불러오는 중..."}):b.length>0?(0,n.jsx)("div",{className:"space-y-2 my-2",children:b.map(e=>(0,n.jsx)(ec,{reply:e,onReplyChange:z,schoolCode:r},e.id))}):null]})]})})}function eu({mealId:e,className:t="",schoolCode:r}){let[a,i]=(0,s.useState)([]),[l,d]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null),[h,f]=(0,s.useState)(0),[g,p]=(0,s.useState)(!0),{user:x,userSchool:y}=c(),w=y&&r&&y.school_code===r,v=(0,o.U)(),b=async(t=!1)=>{if(e)try{d(!0);let r=t?0:h,{data:a,error:n}=await v.from("comments").select("id, content, created_at, user_id").eq("meal_id",e).eq("is_deleted",!1).order("created_at",{ascending:!1}).range(10*r,(r+1)*10-1),s=[];if(a&&a.length>0){let e=a.map(e=>e.user_id),{data:t,error:r}=await v.from("users").select("id, email, nickname, profile_image").in("id",e);r?console.error("사용자 정보 가져오기 오류:",r):s=t||[]}if(n)throw n;let l=a.map(e=>e.id),o={};if(l.length>0){let{data:e,error:t}=await v.from("comment_likes").select("comment_id").in("comment_id",l);if(t)throw t;o=e.reduce((e,t)=>(e[t.comment_id]=(e[t.comment_id]||0)+1,e),{})}let c={};if(x&&x.id&&l.length>0){let{data:e,error:t}=await v.from("comment_likes").select("comment_id").in("comment_id",l).eq("user_id",x.id);if(t)throw t;c=(e||[]).reduce((e,t)=>(e[t.comment_id]=!0,e),{})}let u={};if(l.length>0){let{data:e,error:t}=await v.from("comment_replies").select("comment_id").in("comment_id",l).eq("is_deleted",!1);if(t)throw t;u=e.reduce((e,t)=>(e[t.comment_id]=(e[t.comment_id]||0)+1,e),{})}let m=a.map(e=>{let t=s.find(t=>t.id===e.user_id)||null;return{id:e.id,content:e.content,created_at:e.created_at,user_id:e.user_id,user:{id:t?.id||e.user_id||"",email:t?.email||"",user_metadata:{name:t?.nickname||"",avatar_url:t?.profile_image||""}},likes_count:o[e.id]||0,user_has_liked:!!c[e.id],replies_count:u[e.id]||0}});t?i(m):i(e=>[...e,...m]),p(10===m.length),f(t?1:r+1)}catch(e){console.error("댓글 로드 중 오류:",e),m("댓글을 불러오는 중 문제가 발생했습니다.")}finally{d(!1)}},j=async t=>{if(!x||!x.id||!e||!t.trim())return!1;try{console.log("댓글 추가 시도:",{mealId:e,userId:x.id,content:t.trim()});let{error:r}=await v.from("comments").insert({meal_id:e,user_id:x.id,content:t.trim()});if(r)throw console.error("댓글 추가 SQL 오류:",r),r;return console.log("댓글 추가 성공, 새로고침 시도"),await b(!0),!0}catch(e){return console.error("댓글 추가 중 오류:",e),m("댓글을 추가하는 중 문제가 발생했습니다."),!1}};return(0,n.jsxs)("div",{className:`mt-4 ${t}`,children:[(0,n.jsx)("h3",{className:"text-lg font-bold mb-4",children:"댓글"}),l?(0,n.jsx)("p",{className:"text-gray-500 mb-4",children:"로딩 중..."}):x&&w?(0,n.jsx)(O,{onSubmit:j}):x&&!w?(0,n.jsx)("p",{className:"text-gray-500 mb-4",children:"해당 학교 학생만 댓글을 작성할 수 있습니다."}):(0,n.jsx)("p",{className:"text-gray-500 mb-4",children:"댓글을 작성하려면 로그인하세요."}),(0,n.jsx)("div",{className:"mt-4 space-y-4",children:a.length>0?a.map(e=>(0,n.jsx)(ed,{comment:e,onCommentChange:()=>b(!0),schoolCode:r},e.id)):l?(0,n.jsx)("p",{className:"text-gray-500",children:"댓글을 불러오는 중..."}):(0,n.jsx)("p",{className:"text-gray-500",children:"아직 댓글이 없습니다. 첫 댓글을 남겨보세요!"})}),g&&(0,n.jsx)("button",{className:"w-full py-2 mt-4 text-sm text-gray-600 hover:text-gray-900",onClick:()=>b(),disabled:l,children:l?"불러오는 중...":"더 보기"}),u&&(0,n.jsx)("p",{className:"text-red-500 mt-2",children:u})]})}function em(){(0,l.useRouter)(),(0,o.U)();let{user:e,userSchool:t,loading:r,error:a}=c(),[i,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(""),h=e=>{m(e)},[f,g]=(0,s.useState)(0),[p,x]=(0,s.useState)(!1),[y,w]=(0,s.useState)(""),{meals:v,isLoading:b,error:j,dataSource:_,fetchMealInfo:N}=function(){let[e,t]=(0,s.useState)([]),[r,a]=(0,s.useState)(!1),[n,i]=(0,s.useState)(""),[l,o]=(0,s.useState)("");return{meals:e,isLoading:r,error:n,dataSource:l,fetchMealInfo:(0,s.useCallback)(async(e,r,n="E10")=>{if(!e||!r)return void i("학교 코드와 날짜가 필요합니다.");try{a(!0),i("");let s=E(r),l=await q(`${T.MEALS}?school_code=${e}&office_code=${n}&date=${s}`);if(404===l.status){t([]),o("database"),i("해당 날짜의 급식 정보가 없습니다.");return}if(!l.ok)throw Error(`API 호출 실패: ${l.statusText}`);let c=await l.json();o(c.source||"unknown"),c.meals&&c.meals.length>0?t(c.meals):(t([]),i("해당 날짜의 급식 정보가 없습니다."))}catch(e){console.error("급식 정보 조회 오류:",e),t([]),i(`급식 정보를 가져오는 중 오류가 발생했습니다: ${e.message}`)}finally{a(!1)}},[])}}(),k=e=>{for(let[t,r]of Object.entries({서울:"B10",부산:"C10",대구:"D10",인천:"E10",광주:"F10",대전:"G10",울산:"H10",세종:"I10",경기:"J10",강원:"K10",충북:"M10",충남:"N10",전북:"P10",전남:"Q10",경북:"R10",경남:"S10",제주:"T10"}))if(e&&e.includes(t))return r;return"B10"},S=()=>{let e="E10";return t&&(t.office_code?e=t.office_code:t.region&&(e=k(t.region))),e},{isOpen:C,title:M,content:P,openModal:W,closeModal:L}=function(){let[e,t]=(0,s.useState)(!1),[r,a]=(0,s.useState)(""),[n,i]=(0,s.useState)("");return{isOpen:e,title:r,content:n,openModal:(0,s.useCallback)((e,r)=>{a(e),i(r),t(!0)},[]),closeModal:(0,s.useCallback)(()=>{t(!1)},[])}}(),A=e=>{if(!e||!e.ntr_info)return"영양 정보가 없습니다.";try{let t=e.ntr_info.replace(/<br\s*\/?>/gi,"\n").split(/\n/).map(e=>e.trim()).filter(Boolean);if(0===t.length)return"영양 정보가 없습니다.";let r=[];for(let e=0;e<t.length;e++)r.push(t[e]),t[e].includes("지방")&&e<t.length-1&&r.push("");return r.join("\n").trim()}catch(e){return console.error("영양소 정보 파싱 오류:",e),"영양 정보 표시 중 오류가 발생했습니다."}},O=e=>!e||Array.isArray(e)&&0===e.length||"[]"===e?"상세 원산지 정보가 없습니다.":("string"==typeof e?e:JSON.stringify(e)).replace(/<br\s*\/?>/gi,"\n");return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8",children:[C&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6 max-h-[80vh] overflow-y-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-center",children:M}),(0,n.jsx)("button",{onClick:L,className:"text-gray-500 hover:text-gray-800",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsx)("div",{className:"whitespace-pre-wrap break-words text-left",children:P})]})}),(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[t?(0,n.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 shadow-sm rounded p-2 mb-3 border-l-2 border-blue-500 flex items-center",children:[(0,n.jsx)("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 text-base font-semibold",children:t.school_name}),(0,n.jsx)("span",{className:"ml-2 text-gray-600 text-xs bg-white px-1.5 py-0.5 rounded-full",children:t.region})]}):(0,n.jsx)("div",{className:"mb-6"}),(0,n.jsxs)("div",{className:"mb-2 mt-1",children:[(0,n.jsx)("input",{type:"date",id:"date",value:u,onChange:e=>{let r=e.target.value;h(r),w(""),t?.school_code&&(N(t.school_code,r,S()),setTimeout(()=>{g(e=>e+1)},300))},className:"sr-only"}),(0,n.jsx)("button",{onClick:()=>{let e=document.getElementById("date");e?.showPicker?.()},className:"w-full flex items-center justify-between px-2 py-1.5 bg-blue-50 rounded border border-blue-100 shadow-sm",children:u&&(()=>{let e=new Date(u);if(!isNaN(e.getTime())){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),s=["일","월","화","수","목","금","토"][e.getDay()];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-blue-600 mr-1",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,n.jsx)("span",{className:"text-sm font-medium text-gray-700",children:`${t}-${r}-${a}`}),(0,n.jsx)("span",{className:"ml-1 text-xs font-medium px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded",children:s})]}),(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}return u})()})]}),(j||y||a)&&!v.length&&(0,n.jsx)("div",{className:"mt-4 p-3 bg-red-50 text-red-700 rounded-md",children:j||y||a}),!b&&!p&&!r&&(0,n.jsx)(n.Fragment,{children:v.length>0?(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[v.map(e=>(0,n.jsxs)("div",{className:"meal-wrapper",children:[(0,n.jsx)(I,{meal:e,onShowOrigin:e=>{W("원산지 정보",O(e))},onShowNutrition:e=>{W("영양 정보",A(e))},onUploadSuccess:()=>g(e=>e+1),onUploadError:e=>{w(e),setTimeout(()=>w(""),3e3)}}),(0,n.jsx)(eu,{mealId:e.id,className:"mt-4",schoolCode:e.school_code})]},e.id)),_&&(0,n.jsx)("div",{className:"col-span-1 md:col-span-2 mt-2 text-right",children:(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["데이터 소스: ",(0,n.jsx)("span",{className:"font-medium",children:_})]})})]}):(0,n.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:[(0,n.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,n.jsx)("div",{className:"bg-yellow-100 rounded-full p-3",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),(0,n.jsxs)("h3",{className:"text-lg font-medium text-center mb-2",children:[t?.school_name||"학교"," ",D(u)," 급식 정보"]}),(0,n.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md text-center",children:[(0,n.jsx)("p",{className:"text-gray-700 font-medium",children:j||y||a||"해당 날짜의 급식 정보가 없습니다."}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"다른 날짜를 선택해보세요."}),_&&(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-4",children:["데이터 소스: ",(0,n.jsx)("span",{className:"font-medium",children:_})]})]})]})})]})]})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67858:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(33952).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Windsurf\\\\eat-meal-battle\\\\apps\\\\app\\\\src\\\\app\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\app\\page.tsx","default")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83747:(e,t,r)=>{Promise.resolve().then(r.bind(r,54335))},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[50,901,253,195],()=>r(36096));module.exports=a})();