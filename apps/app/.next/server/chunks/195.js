exports.id=195,exports.ids=[195],exports.modules={324:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,69355,23)),Promise.resolve().then(s.t.bind(s,54439,23)),Promise.resolve().then(s.t.bind(s,67851,23)),Promise.resolve().then(s.t.bind(s,94730,23)),Promise.resolve().then(s.t.bind(s,19774,23)),Promise.resolve().then(s.t.bind(s,53170,23)),Promise.resolve().then(s.t.bind(s,20968,23)),Promise.resolve().then(s.t.bind(s,78298,23))},605:(e,t,s)=>{"use strict";s.d(t,{U:()=>o});var r=s(79997);let a=null,n=()=>!1,o=()=>{if(a)return a;if(!n())return console.debug("서버 환경에서 Supabase 클라이언트 호출 - 제한된 기능"),{auth:{getSession:()=>({data:{session:null}}),getUser:()=>({data:{user:null}}),signOut:()=>Promise.resolve({error:null})},from:()=>({select:()=>({eq:()=>({single:()=>Promise.resolve({data:null,error:null}),data:[],error:null})})})};let e="https://izkumvvlkrkgiuuczffp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc";try{return a=(0,r.kT)(e,t,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",localStorage:n()?window.localStorage:void 0},global:{fetch:(...e)=>{let s=String(e[0]instanceof URL?e[0].toString():e[0]),r=["/meal_images","/profiles","/menu_item_ratings","/school_infos","/quiz","/comment_likes"].some(e=>s.includes(e)||s.includes("school_infos")||s.includes("/quiz"));if(s.includes("/rest/v1/")){let s=e[1]?.headers||{};e[1]={...e[1],headers:{...s,apikey:t,Authorization:`Bearer ${t}`,Accept:"application/json"}}}return!s.includes("/rest/v1/")||r||e[1]?.headers&&Object.entries(e[1]?.headers||{}).some(([e,t])=>"apikey"===e.toLowerCase()||"authorization"===e.toLowerCase())?s.includes("/comment_likes")?(e[1]||(e[1]={}),e[1].headers||(e[1].headers={}),e[1].headers.Accept="application/json",e[1].headers["Content-Type"]="application/json",fetch(...e).then(e=>200!==e.status?(console.debug(`comment_likes 요청 응답 코드 ${e.status} 수정 처리`),new Response(JSON.stringify({data:[]}),{status:200,headers:{"Content-Type":"application/json"}})):e).catch(e=>(console.debug("좋아요 요청 처리 오류 포착:",e),new Response(JSON.stringify({data:[]}),{status:200})))):fetch(...e).catch(e=>{if(404===e.status)return new Response(JSON.stringify({error:"Not found",quiet:!0}),{status:404});throw e}):(console.debug("권한 없는 Supabase REST API 요청 차단:",s),Promise.resolve(new Response(JSON.stringify({message:"No API key found in request",hint:"No 'apikey' request header or url param was found."}),{status:401})))}}})}catch(s){return console.debug("Supabase 클라이언트 초기화 중 오류 발생 (무시됨)"),a=(0,r.kT)(e,t)}}},5606:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var r=s(13486),a=s(60159),n=s(79997);let o=(0,a.createContext)({supabase:(0,n.kT)("https://izkumvvlkrkgiuuczffp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc"),session:null});function i({children:e,session:t}){let[s]=(0,a.useState)(()=>(0,n.kT)("https://izkumvvlkrkgiuuczffp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc"));return(0,r.jsx)(o.Provider,{value:{supabase:s,session:t},children:e})}},14276:()=>{},20685:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m,metadata:()=>h});var r=s(38828),a=s(88935),n=s.n(a),o=s(81579),i=s.n(o);s(14276);var l=s(2058),c=s(47808),d=s(92426),u=s(76084);let h={title:"급식 배틀 - 학교 급식 평가 및 경쟁 서비스",description:"학생들이 매일 급식을 평가\xb7경쟁하며 올바른 식습관을 형성하도록 돕는 서비스입니다.",manifest:"/manifest.json"};function m({children:e}){return(0,r.jsxs)("html",{lang:"ko",children:[(0,r.jsxs)("head",{children:[(0,r.jsx)("meta",{name:"theme-color",content:"#4F46E5"}),(0,r.jsx)("link",{rel:"apple-touch-icon",href:"/icons/icon-192x192.png"})]}),(0,r.jsx)("body",{className:`${n().variable} ${i().variable} antialiased`,children:(0,r.jsxs)(c.default,{children:[(0,r.jsx)(u.default,{}),e,(0,r.jsx)(d.default,{}),(0,r.jsx)(l.Toaster,{})]})})]})}},21188:(e,t,s)=>{"use strict";s.d(t,{default:()=>n});var r=s(13486);let a=(0,s(18187).default)(async()=>{},{loadableGenerated:{modules:["components\\firebase\\FirebaseMessagingWrapper.tsx -> ./FirebaseMessaging"]},ssr:!1});function n(){return(0,r.jsx)(a,{})}},37124:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,30385,23)),Promise.resolve().then(s.t.bind(s,33737,23)),Promise.resolve().then(s.t.bind(s,86081,23)),Promise.resolve().then(s.t.bind(s,1904,23)),Promise.resolve().then(s.t.bind(s,35856,23)),Promise.resolve().then(s.t.bind(s,55492,23)),Promise.resolve().then(s.t.bind(s,89082,23)),Promise.resolve().then(s.t.bind(s,45812,23))},38210:(e,t,s)=>{Promise.resolve().then(s.bind(s,92426)),Promise.resolve().then(s.bind(s,76084)),Promise.resolve().then(s.bind(s,47808)),Promise.resolve().then(s.bind(s,2058))},47808:(e,t,s)=>{"use strict";s.d(t,{default:()=>a});var r=s(33952);let a=(0,r.registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Windsurf\\\\eat-meal-battle\\\\apps\\\\app\\\\src\\\\lib\\\\supabase\\\\supabase-provider.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\lib\\supabase\\supabase-provider.tsx","default");(0,r.registerClientReference)(function(){throw Error("Attempted to call useSupabase() from the server but useSupabase is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\lib\\supabase\\supabase-provider.tsx","useSupabase")},56362:(e,t,s)=>{Promise.resolve().then(s.bind(s,21188)),Promise.resolve().then(s.bind(s,95361)),Promise.resolve().then(s.bind(s,5606)),Promise.resolve().then(s.bind(s,85499))},76084:(e,t,s)=>{"use strict";s.d(t,{default:()=>r});let r=(0,s(33952).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Windsurf\\\\eat-meal-battle\\\\apps\\\\app\\\\src\\\\components\\\\MainHeader.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\components\\MainHeader.tsx","default")},92426:(e,t,s)=>{"use strict";s.d(t,{default:()=>r});let r=(0,s(33952).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Windsurf\\\\eat-meal-battle\\\\apps\\\\app\\\\src\\\\components\\\\firebase\\\\FirebaseMessagingWrapper.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\components\\firebase\\FirebaseMessagingWrapper.tsx","default")},95361:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var r=s(13486),a=s(49989),n=s.n(a),o=s(2984),i=s(605),l=s(60159);function c(){let[e,t]=(0,l.useState)(!1),[s,a]=(0,l.useState)(0),[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)(!1),h=(0,i.U)(),m=(0,l.useRef)(null),p=async e=>{try{if(console.log("알림 읽음 처리 시도:",{notificationId:e}),!o.find(t=>t.notification_id===e))return void console.warn("읽음 처리할 알림을 찾을 수 없습니다.");c(t=>t.map(t=>t.notification_id===e?{...t,is_read:!0}:t)),a(e=>Math.max(0,e-1));let{data:{session:t}}=await h.auth.getSession(),s={"Content-Type":"application/json"};t?.access_token&&(s.Authorization=`Bearer ${t.access_token}`);let r=async(t=0,a=2)=>{try{let n=new AbortController,o=setTimeout(()=>n.abort(),5e3);try{let i=await fetch("/.netlify/functions/notifications-read",{method:"POST",headers:s,body:JSON.stringify({notificationId:e}),signal:n.signal});if(clearTimeout(o),i.ok){let e=await i.json();console.log("알림 읽음 처리 API 성공:",e);return}if(i.status>=500&&t<a)return console.warn(`API 호출 실패 (${i.status}), ${t+1}번째 재시도...`),await new Promise(e=>setTimeout(e,1e3)),r(t+1,a);console.warn("API 호출 실패지만 UI는 업데이트됨:",i.status)}catch(e){if(clearTimeout(o),("AbortError"===e.name||"TypeError"===e.name)&&t<a)return console.warn(`API 호출 시간 초과, ${t+1}번째 재시도...`),await new Promise(e=>setTimeout(e,1e3)),r(t+1,a);throw e}}catch(e){console.error("알림 읽음 시도 중 오류:",e)}};await r()}catch(e){console.error("알림 상태 업데이트 오류:",e)}},f=async()=>{try{let{data:{session:e}}=await h.auth.getSession();if(!e?.user?.id)return void console.error("사용자 세션을 찾을 수 없습니다.");let t=o.filter(e=>!e.is_read);if(0===t.length)return;let{error:s}=await h.from("notification_recipients").update({is_read:!0,read_at:new Date().toISOString()}).eq("recipient_id",e.user.id).eq("is_read",!1);if(s)throw console.error("모든 알림 읽음 처리 실패:",s),Error("모든 알림 읽음 처리 실패");c(e=>e.map(e=>({...e,is_read:!0}))),a(0)}catch(e){console.error("알림 일괄 업데이트 오류:",e)}},x=e=>{let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/1e3);return s<60?"방금 전":s<3600?`${Math.floor(s/60)}분 전`:s<86400?`${Math.floor(s/3600)}시간 전`:s<604800?`${Math.floor(s/86400)}일 전`:`${t.getFullYear()}.${String(t.getMonth()+1).padStart(2,"0")}.${String(t.getDate()).padStart(2,"0")}`},b=e=>{switch(e){case"meal_image":return(0,r.jsx)("svg",{className:"w-5 h-5 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})});case"comment":return(0,r.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})});default:return(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}};return(0,r.jsxs)("div",{className:"relative",ref:m,children:[(0,r.jsxs)("button",{onClick:()=>t(!e),className:"relative p-1 rounded-full text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500","aria-label":"알림",children:[(0,r.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),s>0&&(0,r.jsx)("span",{className:"absolute top-0 right-0 block h-4 w-4 rounded-full bg-red-500 text-white text-xs font-bold flex items-center justify-center transform translate-x-1/2 -translate-y-1/4",children:s>9?"9+":s})]}),e&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-80 sm:w-96 bg-white rounded-md shadow-lg z-50 overflow-hidden",children:[(0,r.jsxs)("div",{className:"border-b px-4 py-2 flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"알림"}),s>0&&(0,r.jsx)("button",{onClick:f,className:"text-xs text-blue-600 hover:text-blue-800 cursor-pointer",children:"모두 읽음 표시"})]}),(0,r.jsx)("div",{className:"max-h-96 overflow-y-auto",children:d?(0,r.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-400 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"알림을 불러오는 중..."]}):o.length>0?o.map(e=>(0,r.jsx)("div",{className:`p-4 border-b ${e.is_read?"bg-white":"bg-blue-50"} hover:bg-gray-50`,children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mr-3",children:b(e.related_type)}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)(n(),{href:`/?notification=${e.related_id}`,onClick:()=>{e.is_read||p(e.notification_id),t(!1)},className:"block",children:[(0,r.jsx)("p",{className:`text-sm ${e.is_read?"font-normal":"font-medium"} text-gray-900`,children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-500 truncate",children:e.message}),(0,r.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:x(e.created_at)})]})}),!e.is_read&&(0,r.jsx)("button",{onClick:()=>p(e.notification_id),className:"ml-2 text-gray-400 hover:text-gray-600","aria-label":"읽음 표시",children:(0,r.jsx)("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})},e.id)):(0,r.jsx)("div",{className:"p-4 text-center text-gray-500",children:"새로운 알림이 없습니다."})})]})]})}let d=[{label:"급식",href:"/"},{label:"퀴즈",href:"/quiz"},{label:"배틀",href:"/battle"},{label:"랭킹",href:"/ranking"}];function u(){let e=(0,i.U)(),t=(0,o.usePathname)(),s=(0,o.useRouter)(),[a,u]=(0,l.useState)(!1),[h,m]=(0,l.useState)(null),p=(0,l.useRef)(null),f=async()=>{await e.auth.signOut(),s.refresh()};return(0,r.jsx)("header",{className:"sticky top-0 z-40 border-b bg-white/70 backdrop-blur supports-[backdrop-filter]:bg-white/40",children:(0,r.jsxs)("div",{className:"mx-auto flex max-w-screen-xl items-center justify-between px-4 py-2 sm:px-6 lg:px-8",children:[(0,r.jsxs)(n(),{href:"/",className:"flex items-center text-lg font-bold text-indigo-600",children:[(0,r.jsx)("span",{className:"mr-2 hidden sm:inline",children:"\uD83C\uDF71"})," 급식배틀"]}),(0,r.jsx)("nav",{className:"flex overflow-x-auto gap-3 sm:gap-6 px-1 py-1 -mx-1 scrollbar-hide",children:d.map(e=>(0,r.jsx)(n(),{href:e.href,className:`text-xs sm:text-sm font-medium whitespace-nowrap px-2 py-1 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition-colors ${"/"===e.href?"/"===t?"bg-indigo-50 text-indigo-600":"text-gray-700":t.startsWith(e.href)?"bg-indigo-50 text-indigo-600":"text-gray-700"}`,children:e.label},e.href))}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[h&&(0,r.jsx)(c,{}),(0,r.jsxs)("div",{className:"relative",ref:p,children:[h?(0,r.jsx)("button",{onClick:()=>u(e=>!e),className:"h-8 w-8 overflow-hidden rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:(()=>{let e=h.user_metadata?.avatar_url;e&&e.startsWith("http://")&&console.log("Profile image URL changed to HTTPS:",e=e.replace("http://","https://"));let t=h.user_metadata?.name;if(e)return(0,r.jsx)("img",{src:e,alt:t||"User Avatar",className:"h-full w-full object-cover",onError:e=>{e.currentTarget.style.display="none";let s=e.currentTarget.parentElement;s&&t&&(s.classList.add("flex","items-center","justify-center","bg-slate-300"),s.textContent=t.charAt(0).toUpperCase())}});if(!t)return(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-gray-200",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})});{let e=t.charAt(0).toUpperCase();return(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-slate-300 text-slate-700 text-sm font-semibold",children:e})}})()}):(0,r.jsxs)(n(),{href:"/login",className:"flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})}),"로그인"]}),h&&a&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-40 origin-top-right rounded-md border bg-white shadow-lg",children:[(0,r.jsx)(n(),{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>u(!1),children:"프로필"}),(0,r.jsx)(n(),{href:"/school-search",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>u(!1),children:"학교설정"}),(0,r.jsx)("button",{onClick:f,className:"block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100",children:"로그아웃"})]})]})]})]})})}}};