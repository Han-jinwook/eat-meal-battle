(()=>{var e={};e.id=62,e.ids=[62],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71789:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>c,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>p});var o=t(48106),a=t(48819),i=t(12050),u=t(4235),n=t(84875),l=t(18156);async function p(e){console.log("API 호출: /api/meal-images/upload");try{let r=await e.formData(),t=r.get("file"),s=r.get("meal_id"),o=r.get("school_code"),a=r.get("meal_date"),i=r.get("meal_type"),p=r.get("user_id");if("undefined"===s)return console.error('mealId가 문자열 "undefined"로 전달됨'),u.NextResponse.json({error:"급식 정보가 없습니다. 다른 날짜를 선택해주세요."},{status:400});if(console.log("요청 데이터:",{mealId:s,schoolCode:o,mealDate:a,mealType:i,fileName:t?.name,fileSize:t?.size,userId:p}),!t||!p)return u.NextResponse.json({error:"파일과 사용자 정보는 필수입니다."},{status:400});if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s||""))return console.error("유효하지 않은 mealId 형식:",s),u.NextResponse.json({error:"급식 정보가 올바르지 않습니다. 날짜를 다시 선택해주세요."},{status:400});let c=(0,l.UU)("https://izkumvvlkrkgiuuczffp.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"");(0,n.U)();let d=t.name.split(".").pop(),m=a.replace(/-/g,""),g=`${o}_${m}_${Date.now()}.${d}`;console.log("파일 업로드 시도:",{filePath:g,fileSize:t.size});let f=await t.arrayBuffer(),x=new Uint8Array(f),{data:v,error:I}=await c.storage.from("meal-images").upload(g,x,{cacheControl:"3600",upsert:!1,contentType:t.type});if(I)return console.error("파일 업로드 오류:",I),u.NextResponse.json({error:`파일 업로드 중 오류가 발생했습니다: ${I.message}`},{status:500});console.log("파일 업로드 성공:",v);let{data:h}=c.storage.from("meal-images").getPublicUrl(g);console.log("이미지 URL:",h.publicUrl),console.log("데이터베이스 저장 시도:",{meal_id:s,image_url:h.publicUrl,user_id:p});let{data:_,error:k}=await c.from("meal_images").insert({meal_id:s,image_url:h.publicUrl,uploaded_by:p,status:"pending"}).select().single();if(k)return console.error("데이터베이스 저장 오류:",k),u.NextResponse.json({error:`이미지 정보 저장 중 오류가 발생했습니다: ${k.message}`},{status:500});return console.log("데이터베이스 저장 성공:",_),u.NextResponse.json(_)}catch(e){return console.error("API 오류:",e),u.NextResponse.json({error:e.message||"서버 오류가 발생했습니다."},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/meal-images/upload/route",pathname:"/api/meal-images/upload",filename:"route",bundlePath:"app/api/meal-images/upload/route"},resolvedPagePath:"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\app\\api\\meal-images\\upload\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:m,serverHooks:g}=c;function f(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:m})}},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80408:()=>{},81630:e=>{"use strict";e.exports=require("http")},84875:(e,r,t)=>{"use strict";t.d(r,{U:()=>a});var s=t(98811),o=t(65208);let a=()=>{let e=(0,o.UL)();return(0,s.Ri)("https://izkumvvlkrkgiuuczffp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc",{cookies:{get:r=>e.get(r)?.value,set(r,t,s){try{e.set({name:r,value:t,...s})}catch(e){console.error("쿠키 설정 오류:",e)}},remove(r,t){try{e.set({name:r,value:"",...t})}catch(e){console.error("쿠키 삭제 오류:",e)}}},auth:{detectSessionInUrl:!0,persistSession:!0,autoRefreshToken:!0}})}},87032:()=>{},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[50,744,156,811,208],()=>t(71789));module.exports=s})();