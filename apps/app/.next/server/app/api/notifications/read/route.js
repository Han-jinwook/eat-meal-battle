(()=>{var e={};e.id=485,e.ids=[485],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31086:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>_,routeModule:()=>m,serverHooks:()=>S,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{POST:()=>h});var i=r(48106),a=r(48819),o=r(12050),n=r(4235),u=r(98811);let p=null,c=()=>!1,l=()=>{if(p)return p;if(!c())return console.debug("서버 환경에서 Supabase 클라이언트 호출 - 제한된 기능"),{auth:{getSession:()=>({data:{session:null}}),getUser:()=>({data:{user:null}}),signOut:()=>Promise.resolve({error:null})},from:()=>({select:()=>({eq:()=>({single:()=>Promise.resolve({data:null,error:null}),data:[],error:null})})})};let e="https://izkumvvlkrkgiuuczffp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a3VtdnZsa3JrZ2l1dWN6ZmZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0MTI3NzksImV4cCI6MjA2MDk4ODc3OX0.pQH_znuBuBfLBJdnMagX4_HE37Z8uraCp1_MaJFtEfc";try{return p=(0,u.kT)(e,t,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",localStorage:c()?window.localStorage:void 0},global:{fetch:(...e)=>{let r=String(e[0]instanceof URL?e[0].toString():e[0]),s=["/meal_images","/profiles","/menu_item_ratings","/school_infos","/quiz","/comment_likes"].some(e=>r.includes(e)||r.includes("school_infos")||r.includes("/quiz"));if(r.includes("/rest/v1/")){let r=e[1]?.headers||{};e[1]={...e[1],headers:{...r,apikey:t,Authorization:`Bearer ${t}`,Accept:"application/json"}}}return!r.includes("/rest/v1/")||s||e[1]?.headers&&Object.entries(e[1]?.headers||{}).some(([e,t])=>"apikey"===e.toLowerCase()||"authorization"===e.toLowerCase())?r.includes("/comment_likes")?(e[1]||(e[1]={}),e[1].headers||(e[1].headers={}),e[1].headers.Accept="application/json",e[1].headers["Content-Type"]="application/json",fetch(...e).then(e=>200!==e.status?(console.debug(`comment_likes 요청 응답 코드 ${e.status} 수정 처리`),new Response(JSON.stringify({data:[]}),{status:200,headers:{"Content-Type":"application/json"}})):e).catch(e=>(console.debug("좋아요 요청 처리 오류 포착:",e),new Response(JSON.stringify({data:[]}),{status:200})))):fetch(...e).catch(e=>{if(404===e.status)return new Response(JSON.stringify({error:"Not found",quiet:!0}),{status:404});throw e}):(console.debug("권한 없는 Supabase REST API 요청 차단:",r),Promise.resolve(new Response(JSON.stringify({message:"No API key found in request",hint:"No 'apikey' request header or url param was found."}),{status:401})))}}})}catch(r){return console.debug("Supabase 클라이언트 초기화 중 오류 발생 (무시됨)"),p=(0,u.kT)(e,t)}};var d=r(55948);let f=(...e)=>{};async function h(e){let t=l(),r=(0,d.Z)(),s=e.headers.get("Authorization"),i=null;if(s?.startsWith("Bearer ")){let e=s.split(" ")[1],{data:{user:r},error:a}=await t.auth.getUser(e);a&&f("토큰 기반 사용자 조회 오류:",a),i=r?.id??null}if(!i){let{data:{session:e}}=await t.auth.getSession();i=e?.user?.id??null}if(!i)return n.NextResponse.json({error:"인증이 필요합니다."},{status:401});try{let{notificationId:t}=await e.json();f("알림 읽음 처리 API 호출:",{userId:i,notificationId:t,requestTime:new Date().toISOString()});let s=new Date().toISOString();if(t){f("수신자 레코드 ID로 직접 업데이트 시도:",t);let{data:e,error:a}=await r.from("notification_recipients").update({is_read:!0,read_at:s}).eq("notification_id",t).eq("recipient_id",i).select();if(f("업데이트 결과:",e,"오류:",a),a)return f("알림 업데이트 오류 발생! 디버깅 정보:",{error:a,query:`UPDATE notification_recipients SET is_read = true, read_at = '${s}' WHERE notification_id = '${t}' AND recipient_id = '${i}'`}),n.NextResponse.json({error:"알림 업데이트 실패",details:a},{status:500});return n.NextResponse.json({success:!0,message:"알림이 읽음 처리되었습니다.",updated:e})}{f("사용자의 모든 알림 읽음 처리 시도:",i);let{data:e,error:t,count:a}=await r.from("notification_recipients").update({is_read:!0,read_at:s}).eq("recipient_id",i).eq("is_read",!1);if(f("모든 알림 읽음 처리 결과:",{count:a,error:t}),t)return f("모든 알림 읽음 처리 오류:",t),n.NextResponse.json({error:"알림 상태 업데이트 중 오류가 발생했습니다."},{status:500});return n.NextResponse.json({success:!0,message:"모든 알림이 읽음 처리되었습니다.",count:a||0})}}catch(e){return f("알림 읽음 처리 API 오류:",e),n.NextResponse.json({error:`알림 처리 중 오류가 발생했습니다: ${e instanceof Error?e.message:"알 수 없는 오류"}`},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/notifications/read/route",pathname:"/api/notifications/read",filename:"route",bundlePath:"app/api/notifications/read/route"},resolvedPagePath:"D:\\Windsurf\\eat-meal-battle\\apps\\app\\src\\app\\api\\notifications\\read\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:x,serverHooks:S}=m;function _(){return(0,o.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:x})}},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},55948:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var s=r(18156);let i=()=>{let e="https://izkumvvlkrkgiuuczffp.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase URL 또는 서비스 롤 키가 설정되지 않았습니다.");return(0,s.UU)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80408:()=>{},81630:e=>{"use strict";e.exports=require("http")},87032:()=>{},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[50,744,156,811],()=>r(31086));module.exports=s})();